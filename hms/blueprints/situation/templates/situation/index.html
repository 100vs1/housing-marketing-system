{% extends 'layouts/app.html' %}

{% block title %}Housing Marketing System{% endblock %}
{% block meta_description %}Compete against yourself and others by guessing the
outcome of a dice roll. Win points and dominate the leaderboard.{% endblock %}

{% block body %}
<style type="text/css">
    .ol-custom-overviewmap,
    .ol-custom-overviewmap.ol-uncollapsible {
        bottom: 0;
        left: auto;
        right: 0;
        top: auto;
    }

    .ol-custom-overviewmap:not(.ol-collapsed) {
        border: 1px solid black;
    }

    .ol-custom-overviewmap .ol-overviewmap-map {
        border: none;
        width: 300px;
    }

    .ol-custom-overviewmap .ol-overviewmap-box {
        border: 2px solid red;
    }

    .ol-custom-overviewmap:not(.ol-collapsed) button {
        bottom: 1px;
        left: auto;
        right: 1px;
        top: auto;
    }

    .map:-moz-full-screen {
        height: 100%;
    }

    .map:-webkit-full-screen {
        height: 100%;
    }

    .map:-ms-fullscreen {
        height: 100%;
    }

    .map:fullscreen {
        height: 100%;
    }

    .ol-rotate {
        top: 3em;
    }

    /* 팝업 */
    .ol-popup {
        position: absolute;
        background-color: white;
        -webkit-filter: drop-shadow(0 1px 4px rgba(0, 0, 0, 0.2));
        filter: drop-shadow(0 1px 4px rgba(0, 0, 0, 0.2));
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #cccccc;
        bottom: 12px;
        left: -50px;
        min-width: 280px;
    }

    .ol-popup:after, .ol-popup:before {
        top: 100%;
        border: solid transparent;
        content: " ";
        height: 0;
        width: 0;
        position: absolute;
        pointer-events: none;
    }

    .ol-popup:after {
        border-top-color: white;
        border-width: 10px;
        left: 48px;
        margin-left: -10px;
    }

    .ol-popup:before {
        border-top-color: #cccccc;
        border-width: 11px;
        left: 48px;
        margin-left: -11px;
    }

    .ol-popup-closer {
        text-decoration: none;
        position: absolute;
        top: 2px;
        right: 8px;
    }

    .ol-popup-closer:after {
        content: "✖";
    }

    /**** hms ****/
    .ol-zoom {
        left : 18.5%;
    }

    .ol-zoomslider {
        left : 18.5%;
    }

    .ol-scale-line {
        left : 18.5%;
    }

    .ol-full-screen {
        right : 18.5%;
    }

    .layer-switcher {
        right : 18.5%;
    }

    .ol-overviewmap {
        right : 18.5%;
        bottom : 0.5em;
    }

    .md-margin-top {
        margin-top: 0;
    }

    .footer {
        border-top: 0px;
    }

    .text-primary-bookmark {
        color: #545454;
    }

    .btn-bookmark {
        padding : 0 4px 0 4px;
        border : 0;
        margin-right: 2px;
    }

    .modal-chart-bar .modal-chart-horizontalBar .modal-chart-area .modal-chart-line {
        width: 80%;
    }

    .modal-chart-radar .modal-chart-pie {
        width: 50%;
    }

    /**** hms ****/
</style>
{# 공통 지역선택 모달 #}
<div id="mdl-area" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-area-label">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-area-label">지역선택</h4>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="list-group">
                                <a href="#" class="list-group-item active">시도</a>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="list-group">
                                <a href="#" class="list-group-item active">시군구</a>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="list-group">
                                <a href="#" class="list-group-item active">읍면동</a>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div id="div-sid-area" class="col-sm-4 pre-scrollable">
                        </div>
                        <div id="div-sgg-area" class="col-sm-4 pre-scrollable">
                        </div>
                        <div id="div-emd-area" class="col-sm-4 pre-scrollable">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-area" type="button" class="btn btn-default" data-dismiss="modal">확인</button>
            </div>
        </div>
    </div>
</div>
{# 즐겨찾기 모달 #}
<div id="mdl-bookmark" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-bookmark-label">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-bookmark-label">즐겨찾기</h4>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>
{# 차트 모달 #}
<div id="mdl-chart-radar" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-chart-radar-label">
    <div class="modal-dialog modal-chart-radar" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-chart-radar-label">차트</h4>
            </div>
            <div id="div-chart-radar" class="modal-body">
                <canvas id="cnv-chart-radar"></canvas>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>
<div id="mdl-chart-bar" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-chart-bar-label">
    <div class="modal-dialog modal-chart-bar" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-chart-bar-label">차트</h4>
            </div>
            <div id="div-chart-bar" class="modal-body">
                <canvas id="cnv-chart-bar"></canvas>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>
<div id="mdl-chart-horizontalBar" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-chart-horizontalBar-label">
    <div class="modal-dialog modal-chart-horizontalBar" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-chart-horizontalBar-label">차트</h4>
            </div>
            <div id="div-chart-horizontalBar" class="modal-body">
                <canvas id="cnv-chart-horizontalBar"></canvas>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>
<div id="mdl-chart-area" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-chart-area-label">
    <div class="modal-dialog modal-chart-area" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-chart-area-label">차트</h4>
            </div>
            <div id="div-chart-area" class="modal-body">
                <canvas id="cnv-chart-area"></canvas>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>
<div id="mdl-chart-line" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-chart-line-label">
    <div class="modal-dialog modal-chart-line" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-chart-line-label">차트</h4>
            </div>
            <div id="div-chart-line" class="modal-body">
                <canvas id="cnv-chart-line"></canvas>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>
<div id="mdl-chart-pie" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-chart-pie-label">
    <div class="modal-dialog modal-chart-pie" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-chart-pie-label">차트</h4>
            </div>
            <div id="div-chart-pie" class="modal-body">
                <canvas id="cnv-chart-pie"></canvas>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>

<script>
//    var ctx = document.getElementById("cnv-chart").getContext("2d");

    // TODO : 차트 모듈은 차트별로 우선 모든 기능을 분류하고 나중에 리펙토링을 통해서 하나의 통합 모듈로 바꾸도록 한다.
    var codeStyle;
    var gridData = [];
    var config = {
        type: '',
        data: {
            labels: ['서울특별시', '부산광역시', '종로구', '서구', '남동'],
            datasets: [{
                label: '남자',
                backgroundColor: ['#9AD0F5','#9AD0F5','#9AD0F5','#9AD0F5','#9AD0F5'],
                borderWidth: 1,
                data: [2478,526,734,784,433]
            }, {
                label: '여자',
                backgroundColor: ['#FFB1C1','#FFB1C1','#FFB1C1','#FFB1C1','#FFB1C1'],
                borderWidth: 1,
                data: [247,5263,7355,1823,1333]
            }, {
                label: '합계',
                backgroundColor: ['#FFE6AA','#FFE6AA','#FFE6AA','#FFE6AA','#FFE6AA'],
                borderWidth: 1,
                data: [247,5263,7355,1823,1333]
            }]
        },
        options: {
            legend: {
                display: true
            },
            title: {
                display: false,
                text: '인구통계'
            }
        }
    };

    var canAppened = {
        radar: true,
        bar: true,
        horizontalBar: true,
        area: true,
        line: true,
        pie: true
    };

    var radarConfig = {
        type: 'radar',
        data: {
            labels: [["Eating", "Dinner"], ["Drinking", "Water"], "Sleeping", ["Designing", "Graphics"], "Coding", "Cycling", "Running"],
            datasets: [{
                label: 'My First dataset',
                backgroundColor: '#9AD0F5',
                borderWidth: 1,
                data: [2478,526,734,784,433]
            }, {
                label: 'My Second dataset',
                backgroundColor: '#FFB1C1',
                borderWidth: 1,
                data: [247,5263,7355,1823,1333]
            }]
        },
        options: {
            legend: {
                position: 'top'
            },
            title: {
                display: true,
                text: 'Chart.js Radar Chart'
            },
            scale: {
                ticks: {
                    beginAtZero: true
                }
            }
        }
    };

    var barConfig = {
        type: 'bar',
        data: {
            labels: [],
            datasets: []
        },
        options: {
            legend: {
                display: true
            },
            title: {
                display: true,
                text: ''
            }
        }
    };

    var horizontalBarConfig = {
        type: 'horizontalBar',
        data: {
            labels: [],
            datasets: []
        },
        options: {
            legend: {
                display: true
            },
            title: {
                display: false,
                text: '인구통계'
            }
        }
    };

    var areaConfig = {
        type: 'area',
        data: {
            labels: ['서울특별시', '부산광역시', '종로구', '서구', '남동'],
            datasets: [{
                label: '남자',
                backgroundColor: ['#9AD0F5','#9AD0F5','#9AD0F5','#9AD0F5','#9AD0F5'],
                borderWidth: 1,
                data: [2478,526,734,784,433]
            }, {
                label: '여자',
                backgroundColor: ['#FFB1C1','#FFB1C1','#FFB1C1','#FFB1C1','#FFB1C1'],
                borderWidth: 1,
                data: [247,5263,7355,1823,1333]
            }, {
                label: '합계',
                backgroundColor: ['#FFE6AA','#FFE6AA','#FFE6AA','#FFE6AA','#FFE6AA'],
                borderWidth: 1,
                data: [247,5263,7355,1823,1333]
            }]
        },
        options: {
            legend: {
                display: true
            },
            title: {
                display: false,
                text: '인구통계'
            }
        }
    };
    var lineConfig = {
        type: 'line',
        data: {
            labels: [],
            datasets: []
        },
        options: {
            responsive : true,
            title: {
                display: true,
                text: ''
            },
            tooltips: {
                mode: 'index',
                intersect: false
            },
            hover: {
                mode: 'nearest',
                intersect: false
            },
            scales: {
                xAxes:[{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: ''
                    }
                }],
                yAxes:[{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: ''
                    }
                }]
            }
        }
    };

    var pieConfig = {
        type: 'pie',
        data: {
            labels: [],
            datasets: []
        },
        options: {
            responsive: true,
            legend: {
                display: true,
                position: 'top'
            },
            title: {
                display: true,
                position: 'top',
                text: ''
            }
        }
    };

    var radarChart;
    var barChart;
    var horizontalBarChart;
    var areaChart;
    var lineChart;
    var pieChart;

    //TODO : 데이터 타입을 좀 변경하고 싶긴한데...
    // ex) radar isUeable : [코드 배열]

    var acceptableTarget = {
        radar : {
            popltn_stats : false,
            hshold_stats : false,
            popltn_mvmt : true,
            trnstn_situtn : false,
            idnfln_bldng : true,
            busins_situtn : false
        },
        bar : {
            popltn_stats : true,
            hshold_stats : true,
            popltn_mvmt : false,
            trnstn_situtn : false,
            idnfln_bldng : true,
            busins_situtn : true
        },
        area : {
            popltn_stats : false,
            hshold_stats : false,
            popltn_mvmt : false,
            trnstn_situtn : false,
            idnfln_bldng : false,
            busins_situtn : false
        },
        line : {
            popltn_stats : true,
            hshold_stats : true,
            popltn_mvmt : true,
            trnstn_situtn : true,
            idnfln_bldng : true,
            busins_situtn : true
        },
        pie : {
            popltn_stats : true,
            hshold_stats : true,
            popltn_mvmt : false,
            trnstn_situtn : true,
            idnfln_bldng : false,
            busins_situtn : false
        }
    };

//    function initChart() {
//        if($('#cnv-chart') !== undefined || $('#cnv-chart') !== null) {
//            $('#cnv-chart').remove();
//            $('#chart_div').html("<canvas id=\"cnv-chart\"></canvas>");
//        }
//    }

    <!--레이더 차트-->
    function createChartForRadar() {
        var ctx = document.getElementById("cnv-chart-radar").getContext("2d");

        if(typeof(codeStyle) !== 'undefined' && !acceptableTarget.radar[codeStyle]) {
            alert("본 검색 결과에서는 레이더 그래프를 지원하지 않습니다.");
        } else {
            if(dataParseForRadar()){
                radarChart = new Chart(ctx, radarConfig);
                radarChart.update();
            }
        }
    }

    function dataParseForRadar() {
        if(gridData.length === 0) {
            alert("데이터 검색을 먼저해주세요.");
            return false
        } else {
            if (canAppened.radar) {

            }
            console.dir(gridData);

            canAppened.radar = false;
            return true;
        }
    }
    <!--레이더 차트-->

    <!--세로막대 차트-->
    function createChartForBar() {
        var ctx = document.getElementById("cnv-chart-bar").getContext("2d");

        if(typeof(codeStyle) !== 'undefined' && !acceptableTarget.bar[codeStyle]) {
            alert("본 검색 결과에서는 세로 막대 그래프를 지원하지 않습니다.");
        } else {
            if(dataParseForBar()){
                barChart = new Chart(ctx, barConfig);
                barChart.update();
            }
        }
    }

    function dataParseForBar() {
        var label = [];
        var data = [];
        var backgroundColor = [];
        console.dir(gridData);
        if(gridData.length === 0) {
            alert("데이터 검색을 먼저해주세요.");
            return false
        } else {
            if (canAppened.bar) {
                if (codeStyle === 'popltn_stats') {
                    alert('타긴 함?');
                    $.each(gridData, function(k, v){
                        var locationStr = '';
                        // TODO : 년도별로 쪼개야함
                        if (!isNull(v['sid'])) {locationStr += v['sid'] + '';}
                        if (!isNull(v['sgg'])) {locationStr += v['sgg'] + '';}
                        if (!isNull(v['emd'])) {locationStr += v['emd'] + '';}

                        label.push(locationStr);
                        data.push(v['total_num']);
                        backgroundColor.push(getRandomHexColor());
                    });
                    var datasets = {
                        label: '인구수',
                        backgroundColor: backgroundColor,
                        data: data
                    };

                    barConfig.options.title.text = "인구통계 세로막대 차트";
                    barConfig.data.labels = label;
                    barConfig.data.datasets.push(datasets);
                    console.log(barConfig);
                }

                if (codeStyle === 'hshold_stats') {
                    $.each(gridData, function(k, v){
                        var locationStr = '';
                        // TODO : 년도별로 쪼개야함
                        if (!isNull(v['sid'])) {locationStr += v['sid'] + '';}
                        if (!isNull(v['sgg'])) {locationStr += v['sgg'] + '';}
                        if (!isNull(v['emd'])) {locationStr += v['emd'] + '';}

                        label.push(locationStr);
                        data.push(v['hshold_num']);
                        backgroundColor.push(getRandomHexColor());
                    });
                    var datasets = {
                        label: '인구수',
                        backgroundColor: backgroundColor,
                        data: data
                    };

                    barConfig.options.title.text = "세대통계 세로막대 차트";
                    barConfig.data.labels = label;
                    barConfig.data.datasets.push(datasets);
                }
            }
            canAppened.bar = false;
            return true
        }
    }
    <!--세로막대 차트-->

    <!--가로막대 차트-->
    function createChartForHorizontalBar() {
        var ctx = document.getElementById("cnv-chart-horizontalBar").getContext("2d");
        if(typeof(codeStyle) !== 'undefined' && !acceptableTarget.bar[codeStyle]) {
            alert("본 검색 결과에서는 가로 막대 그래프를 지원하지 않습니다.");
        } else {
            if(dataParseForHorizontalBar()){
                horizontalBarChart = new Chart(ctx, horizontalBarConfig);
                horizontalBarChart.update();
            }
        }
    }

    function dataParseForHorizontalBar() {
        var label = [];
        var data = [];
        var backgroundColor = [];

        if(gridData.length === 0) {
            alert("데이터 검색을 먼저해주세요.");
            return false
        } else {
            if (canAppened.horizontalBar) {
                if (codeStyle === 'popltn_stats') {
                    $.each(gridData, function (k, v) {
                        var locationStr = '';
                        if (!isNull(v['sid'])) {
                            locationStr += v['sid'] + '';
                        }
                        if (!isNull(v['sgg'])) {
                            locationStr += v['sgg'] + '';
                        }
                        if (!isNull(v['emd'])) {
                            locationStr += v['emd'] + '';
                        }

                        label.push(locationStr);
                        data.push(v['total_num']);
                        backgroundColor.push(getRandomHexColor);
                    });

                    var datasets = {
                        label: '인구수',
                        backgroundColor: backgroundColor,
                        data: data
                    };

                    barConfig.options.title.text = "인구통계 가로막대 차트";
                    horizontalBarConfig.data.labels = label;
                    horizontalBarConfig.data.datasets.push(datasets);
                }
                alert(codeStyle);
                if (codeStyle === 'hshold_stats') {
                    console.dir(gridData);
                    $.each(gridData, function (k, v) {
                        var locationStr = '';
                        if (!isNull(v['sid'])) {
                            locationStr += v['sid'] + '';
                        }
                        if (!isNull(v['sgg'])) {
                            locationStr += v['sgg'] + '';
                        }
                        if (!isNull(v['emd'])) {
                            locationStr += v['emd'] + '';
                        }

                        label.push(locationStr);
                        data.push(v['hshold_num']);
                        backgroundColor.push(getRandomHexColor);
                    });

                    var datasets = {
                        label: '인구수',
                        backgroundColor: backgroundColor,
                        data: data
                    };

                    barConfig.options.title.text = "세대통계 가로막대 차트";
                    horizontalBarConfig.data.labels = label;
                    horizontalBarConfig.data.datasets.push(datasets);
                }
            }

            canAppened.horizontalBar = false;
            return true
        }
    }
    <!--가로막대 차트-->

    <!--영역 차트-->
    function createChartForArea() {
        var ctx = document.getElementById("cnv-chart-area").getContext("2d");

        if(typeof(codeStyle) !== 'undefined' && !acceptableTarget.area[codeStyle]) {
            alert("본 검색 결과에서는 영역 그래프를 지원하지 않습니다.");
        } else {
            areaChart = new Chart(ctx, areaConfig);
            areaChart.update();
        }
    }
    <!--영역 차트-->

    <!--라인 차트-->
    function createChartForLine() {
        var ctx = document.getElementById("cnv-chart-line").getContext("2d");

        if(typeof(codeStyle) !== 'undefined' && !acceptableTarget.line[codeStyle]){
            alert("본 검색 결과에서는 라인 그래프를 지원하지 않습니다.");
        } else {
            dataParseForLine();
            lineChart = new Chart(ctx, lineConfig);
            lineChart.update();
        }
    }

    function dataParseForLine() {
        var label = [];
        var data = [];

        if(gridData.length === 0) {
            alert("데이터 검색을 먼저해주세요.");
            console.log(lineConfig);
            return false;
        } else {
            if (canAppened.line) {
                if (codeStyle === 'poptln_stats') {
                    console.dir(gridData);
                    $.each(gridData, function (k, v) {
                        label.push(v['sgg']);
                        data.push(v['total_num']);
                    });

                    var datasets = {
                        backgroundColor: getRandomHexColor(),
                        data: data,
                        fill: false
                    };

                    lineConfig.options.title = "인구통계 라인 차트";
                    lineConfig.options.scales.xAxes.scaleLabel = 'Year';
                    lineConfig.options.scales.yAxes.scaleLabel = '인구수';
//                lineConfig.data.labels = label;
                    lineConfig.data.datasets.push(datasets);
                }

                if (codeStyle === 'hshold_stats') {
                    console.dir(gridData);
                    $.each(gridData, function (k, v) {
                        var locationStr = '';
                        if (!isNull(v['sid'])) {
                            locationStr += v['sid'] + '';
                        }
                        if (!isNull(v['sgg'])) {
                            locationStr += v['sgg'] + '';
                        }
                        if (!isNull(v['emd'])) {
                            locationStr += v['emd'] + '';
                        }

                        label.push(locationStr);
                        data.push(v['hshold_num']);
                    });

                    console.dir(label);
                    console.dir(data);

                    var datasets = {
                        backgroundColor: getRandomHexColor(),
                        data: data,
                        fill: false
                    };

                    lineConfig.options.title = "세대통계 파이 차트";
                    lineConfig.options.scales.xAxes.scaleLabel = 'Year';
                    lineConfig.options.scales.yAxes.scaleLabel = '세대수';
                    lineConfig.data.labels = label;
                    lineConfig.data.datasets.push(datasets);
                }
            }
        }

        canAppened.line = false;
        return true;
    }
    <!--라인 차트-->

    <!--파이 차트-->
    function createChartForPie() {
        var ctx = document.getElementById("cnv-chart-pie").getContext("2d");
        if(typeof(codeStyle) !== 'undefined' && !acceptableTarget.pie[codeStyle]) {
            alert("본 검색 결과에서는 파이 그래프를 지원하지 않습니다.");
        } else {
            if(dataParseForPie()) {
                pieChart = new Chart(ctx, pieConfig);
                pieChart.update();
            }
        }
    }

    function dataParseForPie() {
        var label = [];
        var data = [];
        var backgroundColor = [];

        console.dir(gridData);
        if(gridData.length === 0) {
            alert("데이터 검색을 먼저해주세요.");
            return false;
        } else {
            if(canAppened.pie){
                if (codeStyle === 'popltn_stats') {
                    var chartData = {};
                    $.each(gridData, function(k, v){
                        var locationStr = '';
                        if (!isNull(v['sid'])) {locationStr += v['sid'] + '';}
                        if (!isNull(v['sgg'])) {locationStr += v['sgg'] + '';}
                        if (!isNull(v['emd'])) {locationStr += v['emd'] + '';}

                        var year = v['srvy_yyyymm'].substring(v['srvy_yyyymm'].length, v['srvy_yyyymm'].length-2);
                        chartData.depth = {
                            key : {
                                year : year,
                                age_grp : '5~9세',
                            }
                        };

                        data.push(v['total_num']);
                        backgroundColor.push(getRandomHexColor());
                    });

                    var datasets = {
                        backgroundColor: backgroundColor,
                        data: data
                    };

                    console.dir(pieConfig);
                    pieConfig.options.title = "인구통계 파이 차트";
                    pieConfig.data.labels = label;
                    pieConfig.data.datasets.push(datasets);
                }

                if (codeStyle === 'hshold_stats') {
                    console.dir(gridData);
                    $.each(gridData, function(k, v){
                        var locationStr = '';
                        if (!isNull(v['sid'])) {locationStr += v['sid'] + '';}
                        if (!isNull(v['sgg'])) {locationStr += v['sgg'] + '';}
                        if (!isNull(v['emd'])) {locationStr += v['emd'] + '';}

                        data.push(v['hshold_num']);
                        backgroundColor.push(getRandomHexColor());
                    });

                    var datasets = {
                        backgroundColor: backgroundColor,
                        data: data
                    };

                    pieConfig.options.title = "세대통계 파이 차트";
                    pieConfig.data.labels = label;
                    pieConfig.data.datasets.push(datasets);
                }
            }
        }
        canAppened.pie = false;
        return true;
    }
    <!--파이 차트-->

    function getRandomHexColor() {
        var letters = '0123456789ABCDEF';
        var color = '#';
        for (var i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }

    function isNull(obj) {
        return !(typeof obj !== "undefined" && obj !== null && obj !== "");
    }

    function setAppendedAll(bool) {
        canAppened.radar = bool;
        canAppened.bar = bool;
        canAppened.horizontalBar = bool;
        canAppened.area = bool;
        canAppened.line = bool;
        canAppened.pie = bool;
    }
</script>
<div class="ui-layout-center">
    <!--<div>빈값</div>-->
</div>
<div id="map" class="map"></div>
<div id="popup" class="ol-popup">
    <a href="#" id="popup-closer" class="ol-popup-closer"></a>
    <div id="popup-content"></div>
</div>
<div class="ui-layout-west">
    <div id="west-accordion">
        <h3><a href="#">인구통계</a></h3>
        <div>
            <form id="frm-west-0" class="form-horizontal">
                <!--templates/macros/form.html에 form의 action이 정의되어 있음. -->
                <div class="form-group">
                    <button id="btn-ps-area" type="button" class="btn btn-default" data-toggle="modal"
                            data-target="#mdl-area">지역선택 +
                    </button>
                    <p><span id="spn-ps-area"></span></p>
                </div>
                <div class="form-group">
                    <select id="age_grp" name="age_grp_cd" class="selectpicker" multiple title="연령대"
                            data-size="5" data-actions-box="true">
                        <!--{% for i in range(5, 95, 5) %}-->
                        <!--<option value="{{i}}">{{i}}세</option>-->
                        <!--{% endfor %}-->
                    </select>
                </div>
                <!--<div class="form-group">-->
                <!--<select required id="ps-sex" name="ps-sex" class="selectpicker" multiple title="성별" data-actions-box="true">-->
                <!--<option value="1">남자</option>-->
                <!--<option value="2">여자</option>-->
                <!--</select>-->
                <!--</div>-->
                <div class="form-group">
                    <select id="ps_syear" name="ps_syear" class="selectpicker" title="시작년" data-size="5" data-actions-box="true" data-width="fit">
                        {% for year in range(now.year, 2012, -1) %}
                        <option value="{{year}}">{{year}}</option>
                        {% endfor %}
                    </select>
                    <select id="ps_smonth" name="ps_smonth" class="selectpicker" title="시작월" data-size="5" data-actions-box="true" data-width="fit">
                        {% for month in range(1, 13) %}
                        <option value="{{(month|string).rjust(2, '0')}}">{{(month|string).rjust(2, '0')}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <select id="ps_eyear" name="ps_eyear" class="selectpicker" title="종료년" data-size="5" data-actions-box="true"
                            data-width="fit">
                        {% for year in range(now.year, 2012, -1) %}
                        <option value="{{year}}">{{year}}</option>
                        {% endfor %}
                    </select>
                    <select id="ps_emonth" name="ps_emonth" class="selectpicker" title="종료월" data-size="5" data-actions-box="true"
                            data-width="fit">
                        {% for month in range(1, 13) %}
                        <option value="{{(month|string).rjust(2, '0')}}">{{(month|string).rjust(2, '0')}}</option>
                        {% endfor %}
                    </select>
                </div>

                <div id="div-west-2" class="form-group"></div>
                <button id="btn-ps-search" class="btn btn-default pull-right" type="button" onclick="srch_popltn_stats();">
                    검색
                </button>
            </form>
        </div>
        <h3><a href="#">세대통계</a></h3>
        <div>
            <form id="frm-west-1" class="form-horizontal">
                <div class="form-group">
                    <button id="btn-hs-a" type="button" class="btn btn-default" data-toggle="modal"
                            data-target="#mdl-area">지역선택 +
                    </button>
                    <p><span id="spn-hs-a"></span></p>
                </div>
                <div class="form-group">
                    <select id="fmly_num" name="fmly_num_cd" class="selectpicker" multiple title="가구원수"
                            data-actions-box="true">
                    </select>
                </div>
                <div class="form-group">
                    <select id="rsdnc_clsftn" name="rsdnc_clsftn_cd" class="selectpicker" multiple title="주거유형"
                            data-actions-box="true">
                    </select>
                </div>
                <div class="form-group">
                    <select id="room_num" name="room_num_cd" class="selectpicker" multiple title="방개수"
                            data-actions-box="true">
                    </select>
                </div>
                <div class="form-group">
                    <select id="st_year" name="st_year" class="selectpicker" title="시작년" data-size="5" data-actions-box="true" data-width="fit">
                        {% for year in range(2010, 1999, -5) %}
                        <option value="{{year}}">{{year}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <select id="ed_year" name="ed_year" class="selectpicker" title="종료년" data-size="5" data-actions-box="true" data-width="fit">
                        {% for year in range(2010, 1999, -5) %}
                        <option value="{{year}}">{{year}}</option>
                        {% endfor %}
                    </select>
                </div>
            </form>
            <button id="btn-hs-search" class="btn btn-default pull-right" type="button" onclick="srch_hshold_stats();">
                검색
            </button>
        </div>
        <h3><a href="#">인구이동</a></h3>
        <div>
            <form id="frm-west-2" class="form-horizontal">
                <div class="form-group">
                    <button id="btn-pm-oa" type="button" class="btn btn-default" data-toggle="modal"
                            data-target="#mdl-area">전출지 선택 +
                    </button>
                    <p><span id="spn-pm-oa"></span></p>
                </div>
                <div class="form-group">
                    <button id="btn-pm-ia" type="button" class="btn btn-default" data-toggle="modal"
                            data-target="#mdl-area">전입지 선택 +
                    </button>
                    <p><span id="spn-pm-ia"></span></p>
                </div>
                <div class="form-group">
                    <select id='aplcnt_age' name="aplcnt_age_cd" class="selectpicker" multiple title="연령대"
                            data-size="5" data-actions-box="true">
                    </select>
                </div>
                <div class="form-group">
                    <select id="aplcnt_sex" name="aplcnt_sex_cd" class="selectpicker" multiple title="성별"
                            data-actions-box="true">
                    </select>
                </div>
                <div class="form-group">
                    <select id="mv_reasn" name="mv_reasn_cd" class="selectpicker" multiple title="이동사유"
                            data-actions-box="true">
                    </select>
                </div>
                <div class="form-group">
                    <select name="fmly_num" class="selectpicker" multiple title="세대원수" data-size="5" data-actions-box="true">
                        {% for i in range(1, 11) %}
                        <option value="{{i}}">{{i}}명</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <select name="st_year" class="selectpicker" title="시작년" data-size="5" data-actions-box="true" data-width="fit">
                        {% for year in range(now.year, 2001, -1) %}
                        <option value="{{year}}">{{year}}</option>
                        {% endfor %}
                    </select>
                    <select name="st_month" class="selectpicker" title="시작월" data-size="5" data-actions-box="true" data-width="fit">
                        {% for month in range(1, 13) %}
                        <option value="{{(month|string).rjust(2, '0')}}">{{(month|string).rjust(2, '0')}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <select name="ed_year" class="selectpicker" title="종료년" data-size="5" data-actions-box="true" data-width="fit">
                        {% for year in range(now.year, 2001, -1) %}
                        <option value="{{year}}">{{year}}</option>
                        {% endfor %}
                    </select>
                    <select name="ed_month" class="selectpicker" title="종료월" data-size="5" data-actions-box="true" data-width="fit">
                        {% for month in range(1, 13) %}
                        <option value="{{(month|string).rjust(2, '0')}}">{{(month|string).rjust(2, '0')}}</option>
                        {% endfor %}
                    </select>
                </div>
            </form>
            <button class="btn btn-default pull-right" type="button" onclick="srch_popltn_mvmt();">검색</button>
        </div>
        <h3><a href="#">실거래가</a></h3>
        <div>
            <form id="frm-west-3" class="form-horizontal">
                <div class="form-group">
                    <button id="btn-mp-area" type="button" class="btn btn-default" data-toggle="modal"
                            data-target="#mdl-area">지역선택 +
                    </button>
                    <p><span id="spn-mp-area"></span></p>
                </div>
                <div class="form-group">
                    <input id="sale" type="radio" name="mp-trans-type" value="1" checked="checked"> 매매
                    <input id="rent" type="radio" name="mp-trans-type" value="2"> 전월세

                </div>

                <div class="form-group">
                    <input type="radio" name="mp-house-kind" value="1" checked="checked"> 아파트
                    <input type="radio" name="mp-house-kind" value="2"> 오피스텔
                    <br>
                    <input type="radio" name="mp-house-kind" value="3"> 연립/다세대
                    <input type="radio" name="mp-house-kind" value="4"> 단독/다가구
                </div>

                <div id="sale_form" class="form-group">
                    <select id="mp-ss" name="mp-ss" class="selectpicker" title="매매가" data-size="5" data-actions-box="true">
                        {% for p in range(0, 195000, 5000) %}
                        <option value="{{p}}">{{p}}만원</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="mp-ssale" value="">
                    ~
                    <select id="mp-es" name="mp-es" class="selectpicker" title="매매가" data-size="5" data-actions-box="true">
                        {% for p in range(5000, 200000, 5000) %}
                        <option value="{{p}}">{{p}}만원</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="mp-esale" value=""> 만원
                </div>

                <div id="rent_form" style="display: none">
                    <div class="form-group">
                        <select id="mp-sdep" name="mp-sdep" class="selectpicker" title="보증금" data-actions-box="true">
                            {% for p in range(0, 145000, 5000) %}
                            <option value="{{p}}">{{p}}만원</option>
                            {% endfor %}
                        </select>
                        <input type="text" name="mp-sdeposit">
                        ~
                        <select id="mp-edep" name="mp-edep" class="selectpicker" title="보증금" data-actions-box="true">
                            {% for p in range(5000, 150000, 5000) %}
                            <option value="{{p}}">{{p}}만원</option>
                            {% endfor %}
                        </select>
                        <input type="text" name="mp-edeposit"> 만원
                    </div>
                    <div class="form-group">
                        <select id="mp-sre" name="mp-sre" class="selectpicker" title="월세" data-actions-box="true">
                            {% for p in range(0, 800, 100) %}
                            <option value="{{p}}">{{p}}만원</option>
                            {% endfor %}
                        </select>
                        <input type="text" name="mp-srent">
                        ~
                        <select id="mp-ere" name="mp-ere" class="selectpicker" title="월세" data-actions-box="true">
                            {% for p in range(100, 900, 100) %}
                            <option value="{{p}}">{{p}}만원</option>
                            {% endfor %}
                        </select>
                        <input type="text" name="mp-erent"> 만원
                    </div>
                </div>
                <div class="form-group">
                    <select id="mp-sarea" name="mp-sarea" class="selectpicker" title="면적" data-size="5" data-actions-box="true">
                        {% for p in range(0, 450, 50) %}
                        <option value="{{p}}">{{p}}㎡</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="mp-sexarea">
                    ~
                    <select id="mp-earea" name="mp-earea" class="selectpicker" title="면적" data-size="5" data-actions-box="true">
                        {% for p in range(50, 500, 50) %}
                        <option value="{{p}}">{{p}}㎡</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="mp-eexarea"> ㎡
                </div>
                <div class="form-group">
                    <select id="mp-sdec" name="mp-sdec" class="selectpicker" title="노후도" data-size="5" data-actions-box="true">
                        {% for p in range(0, 45, 5) %}
                        <option value="{{p}}">{{p}}년</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="mp-sdecrepit">
                    ~
                    <select id="mp-edec" name="mp-edec" class="selectpicker" title="노후도" data-size="5" data-actions-box="true">
                        {% for p in range(5, 50, 5) %}
                        <option value="{{p}}">{{p}}년</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="mp-edecrepit"> 년
                </div>
                <div class="form-group">
                    <select name="mp-syear" class="selectpicker" title="시작년" data-size="5" data-actions-box="true" data-width="fit">
                        {% for year in range(now.year, 2005, -1) %}
                        <option value="{{year}}">{{year}}</option>
                        {% endfor %}
                    </select>
                    <select name="mp-smonth" class="selectpicker" title="시작월" data-size="5" data-actions-box="true" data-width="fit">
                        {% for month in range(1, 13) %}
                        <option value="{{(month|string).rjust(2, '0')}}">{{(month|string).rjust(2, '0')}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <select name="mp-eyear" class="selectpicker" title="종료년" data-size="5" data-actions-box="true" data-width="fit">
                        {% for year in range(now.year, 2005, -1) %}
                        <option value="{{year}}">{{year}}</option>
                        {% endfor %}
                    </select>
                    <select name="mp-emonth" class="selectpicker" title="종료월" data-size="5" data-actions-box="true" data-width="fit">
                        {% for month in range(1, 13) %}
                        <option value="{{(month|string).rjust(2, '0')}}">{{(month|string).rjust(2, '0')}}</option>
                        {% endfor %}
                    </select>
                </div>
                <button id="btn-mp-search" class="btn btn-default pull-right" type="button"
                        onclick="srch_trnstn_situtn()">검색
                </button>
            </form>
            <script type="text/javascript">
                $('#frm-west-3 .selectpicker').on('change', function () {
                    var slecteditem = $(this).find("option:selected").val();
                    if (slecteditem != "") {
                        $(this).parent().next().val(slecteditem);
                    }
                });

            </script>
            <script type="text/javascript">
                $('input:radio[name="mp-trans-type"]').change(
                    function () {
                        if ($(this).val() == '1') {
                            $('#sale_form').css("display", "block");
                            $('#rent_form').css("display", "none");
                        } else {
                            $('#sale_form').css("display", "none");
                            $('#rent_form').css("display", "block");
                        }
                    });

            </script>
        </div>
        <h3><a href="#">건물현황</a></h3>
        <div>
            <form id="frm-west-4" class="form-horizontal">
                <div class="form-group">
                    <button id="btn-ib-area" type="button" class="btn btn-default" data-toggle="modal"
                            data-target="#mdl-area"> 지역선택 +
                    </button>
                    <p><span id="spn-ib-area"></span></p>
                </div>
                <div class="form-group">
                    <select id="ib-use" name="ib-use" class="selectpicker" multiple title="건물용도"
                            data-actions-box="true">
                        <option value="단독주택">단독주택</option>
                        <option value="창고시설">창고시설</option>
                        <option value="제2종근린생활시설">제2종근린생활시설</option>
                        <option value="업무시설">업무시설</option>
                    </select>
                    <select id="ib-common" name="ib-common" class="selectpicker" multiple title="전유/공용"
                            data-actions-box="true">
                        <option value="전유">전유</option>
                        <option value="공용">공용</option>
                    </select>
                </div>
                <div class="form-group">
                    <select id="ib-sarea" name="ib-sarea" class="selectpicker" title="면적" data-size="5" data-actions-box="true">
                        {% for p in range(0, 450, 50) %}
                        <option value="{{p}}">{{p}}㎡</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="ib-sexarea">
                    ~
                    <select id="ib-earea" name="ib-earea" class="selectpicker" title="면적" data-size="5" data-actions-box="true">
                        {% for p in range(50, 500, 50) %}
                        <option value="{{p}}">{{p}}㎡</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="ib-eexarea"> ㎡
                </div>
                <div class="form-group">
                    <select id="ib-sdec" name="ib-sdec" class="selectpicker" title="노후도" data-size="5" data-actions-box="true">
                        {% for p in range(0, 45, 5) %}
                        <option value="{{p}}">{{p}}년</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="ib-sdecrepit">
                    ~
                    <select id="ib-edec" name="ib-edec" class="selectpicker" title="노후도" data-size="5" data-actions-box="true">
                        {% for p in range(5, 50, 5) %}
                        <option value="{{p}}">{{p}}년</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="ib-edecrepit"> 년
                    <script type="text/javascript">
                        $('#frm-west-4 .selectpicker').on('change', function () {
                            var slecteditem = $(this).find("option:selected").val();
                            if (slecteditem != "") {
                                $(this).parent().next().val(slecteditem);
                            }
                        });

                    </script>
                </div>
                <div class="form-group">
                    <select name="ib-syear" class="selectpicker" title="시작년" data-size="5" data-actions-box="true" data-width="fit">
                        {% for year in range(now.year, 2001, -1) %}
                        <option value="{{year}}">{{year}}</option>
                        {% endfor %}
                    </select>
                    <select name="ib-smonth" class="selectpicker" title="시작월" data-size="5" data-actions-box="true" data-width="fit">
                        {% for month in range(1, 13) %}
                        <option value="{{(month|string).rjust(2, '0')}}">{{(month|string).rjust(2, '0')}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <select name="ib-eyear" class="selectpicker" title="종료년" data-size="5" data-actions-box="true" data-width="fit">
                        {% for year in range(now.year, 2001, -1) %}
                        <option value="{{year}}">{{year}}</option>
                        {% endfor %}
                    </select>
                    <select name="ib-emonth" class="selectpicker" title="종료월" data-size="5" data-actions-box="true" data-width="fit">
                        {% for month in range(1, 13) %}
                        <option value="{{(month|string).rjust(2, '0')}}">{{(month|string).rjust(2, '0')}}</option>
                        {% endfor %}
                    </select>
                </div>
            </form>
            <button id="btn-ib-search" class="btn btn-default pull-right" type="button" onclick="srch_idnfln_bldng()">검색</button>
        </div>
        <h3><a href="#">업종현황</a></h3>
        <div>
            <form id="frm-west-5" class="form-horizontal">
                <div class="form-group">
                    <button id="btn-bs-area" type="button" class="btn btn-default" data-toggle="modal"
                            data-target="#mdl-area"> 지역선택 +
                    </button>
                    <p><span id="spn-bs-area"></span></p>
                </div>
                <div class="form-group">
                    <select name="busins_clsftn_cd" class="selectpicker" multiple title="업종선택"
                            data-size="5" data-actions-box="true">
                        {% for i in range(5, 95, 5) %}
                        <option value="{{i}}">{{i}}</option>
                        {% endfor %}
                    </select>
                </div>
            </form>
            <button id="btn-bs-search" class="btn btn-default pull-right" type="button" onclick="srch_busins_situtn()">
                검색
            </button>
        </div>
    </div>
</div>
<div class="ui-layout-east">
    <div id="east-accordion">
        <h3>
            <a href="#">즐겨찾기</a>
        </h3>
        <div>
            <script>
                $(document).ready(find_bookmarks);

                function set_bookmark_name($this) {
                    $('input:text[name=txt-bookmark-name]').val($this.is(':checked') ? $this.next().text() : '');
                    $('input:checkbox[name=cbx-bookmark]').not($this).prop('checked', false);
                }

                function find_bookmarks() {
                    $.ajax({
                        method: 'POST',
                        url: '{{url_for("bookmark.bookmarks")}}',
                        data: {},
                        dataType: 'json'
                    }).done(function (data) {
                        var results = [];
                        $.each(data.items, function (i, item) {
                            results.push('<tr><td>');
                            results.push('<input type="checkbox" name="cbx-bookmark" value="' + item.id + '" onclick="set_bookmark_name($(this));"> ');
                            results.push('<a href="#" onclick="execute_bookmark(' + item.target + ',\'' + item.parameter + '\');">' + item.name + '</a>');
                            results.push('</td></tr>');
                        });
                        $('#tbl-bookmark tbody').empty().append(results.join(''));
                        $('input:text[name=txt-bookmark-name]').val('');
                    });
                }

                function execute_bookmark(target, parameter) {
                    $('#west-accordion').accordion('option', 'active', target);
                    var $parameter = decodeURIComponent(parameter);

                    $.each($parameter.split('&'), function (i, param) {
                        $pairs = param.split('=');
                        $('input[name=' + $pairs[0] + ']').val($pairs[1]);
                    });
                }

                function add_bookmark() {
                    var $name_obj = $('input[name=txt-bookmark-name]');
                    var $target = $('#west-accordion').accordion('option', 'active');
                    var $parameter = $('#frm-west-' + $target).serialize();
                    alert($parameter);
                    if ($name_obj.val() == '') {
                        alert('검색 명칭을 입력해주세요.');
                        $name_obj.focus();
                        return;
                    }
                    $.ajax({
                        method: 'POST',
                        url: '{{url_for("bookmark.insert_bookmark")}}',
                        data: {name: $name_obj.val(), target: $target, parameter: encodeURIComponent($parameter)},
                        dataType: 'json'
                    }).done(function (data) {
                        alert(data.msg);
                        find_bookmarks();
                    });
                }

                function delete_bookmark() {
                    var $this = $('input:checkbox[name=cbx-bookmark]');
                    if ($this.is(':checked') == false) {
                        alert('삭제할 검색 명칭을 체크해주세요.');
                        return;
                    }
                    var $id;
                    $this.each(function () {
                        if ($(this).is(':checked') == true) {
                            $id = $(this).val();
                        }
                    });
                    $.ajax({
                        method: 'POST',
                        url: '{{url_for("bookmark.delete_bookmark")}}',
                        data: {id: $id},
                        dataType: 'json'
                    }).done(function (data) {
                        alert(data.msg);
                        find_bookmarks();
                    });
                }

                function edit_bookmark() {
                    var $this = $('input:checkbox[name=cbx-bookmark]');
                    if ($this.is(':checked') == false) {
                        alert('수정할 검색 명칭을 체크해주세요.');
                        return;
                    }
                    var $id;
                    $this.each(function () {
                        if ($(this).is(':checked') == true) {
                            $id = $(this).val();
                        }
                    });
                    $.ajax({
                        method: 'POST',
                        url: '{{url_for("bookmark.update_bookmark")}}',
                        data: {id: $id, name: $('input:text[name=txt-bookmark-name]').val()},
                        dataType: 'json'
                    }).done(function (data) {
                        alert(data.msg);
                        find_bookmarks();
                    });
                }
            </script>
            <table id="tbl-bookmark" class="table">
                <thead>
                <tr>
                    <td>
                        <button id="btn-bookmark-edit" class="btn btn-default btn-xs pull-right btn-bookmark" type="button"
                                onclick="edit_bookmark();" title="즐겨찾기 수정">
                            <i class="fa fa-pencil text-primary text-primary-bookmark" aria-hidden="true"></i>
                        </button>
                        <button id="btn-bookmark-delete" class="btn btn-default btn-xs pull-right btn-bookmark" type="button"
                                onclick="delete_bookmark();" title="즐겨찾기 삭제">
                            <i class="fa fa-trash text-primary text-primary-bookmark" aria-hidden="true"></i>
                        </button>
                        <button id="btn-bookmark-add" class="btn btn-default btn-xs pull-right btn-bookmark" type="button"
                                onclick="add_bookmark();" data-toggle="modal" data-target="#mdl-bookmark" title="즐겨찾기 추가">
                            <i class="fa fa-file-text text-primary text-primary-bookmark" aria-hidden="true"></i>
                        </button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <form class="form-inline">
                            <input type="text" class="form-control input-sm pull-right" name="txt-bookmark-name"
                                   maxlength="100">
                        </form>
                    </td>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <h3><a href="#">차트</a></h3>
        <div>
            <a class="btn btn-default btn-block" data-toggle="modal" data-target="#mdl-chart-radar" onclick="createChartForRadar();">
                <i class="fa fa-area-chart fa-lg text-info"></i> 레이더
            </a>
            <br>
            <a class="btn btn-default btn-block" data-toggle="modal" data-target="#mdl-chart-bar" onclick="createChartForBar()">
                <i class="fa fa-bar-chart fa-lg text-info"></i> 세로막대
            </a>
            <br>
            <a class="btn btn-default btn-block" data-toggle="modal" data-target="#mdl-chart-horizontalBar" onclick="createChartForHorizontalBar();">
                <i class="fa fa-bar-chart fa-lg text-info"></i> 가로막대
            </a>
            <br>
            <a class="btn btn-default btn-block" data-toggle="modal" data-target="#mdl-chart-area" onclick="createChartForArea()">
                <i class="fa fa-area-chart fa-lg text-info"></i> 영역
            </a>
            <br>
            <a class="btn btn-default btn-block" data-toggle="modal" data-target="#mdl-chart-line" onclick="createChartForLine();">
                <i class="fa fa-line-chart fa-lg text-info"></i> 라인
            </a>
            <br>
            <a class="btn btn-default btn-block" data-toggle="modal" data-target="#mdl-chart-pie" onclick="createChartForPie();">
                <i class="fa fa-pie-chart fa-lg text-info"></i> 파이
            </a>
        </div>
        <h3><a href="#">설정</a></h3>
        <div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">전체 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-all" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-all" value="false"> 숨기기
                    </label>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">줌 버튼 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-zbutton" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-zbutton" value="false"> 숨기기
                    </label>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">줌 슬라이더 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-zslider" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-zslider" value="false"> 숨기기
                    </label>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">스케일 라인 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-sline" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-sline" value="false"> 숨기기
                    </label>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">풀 스크린 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-fscreen" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-fscreen" value="false"> 숨기기
                    </label>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">레이어 스위처 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-lswitcher" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-lswitcher" value="false"> 숨기기
                    </label>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">오버뷰 맵 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-ovmap" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-ovmap" value="false"> 숨기기
                    </label>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="ui-layout-south">
    <table id="jqGrid"></table>
    <div id="jqGridPager"></div>
</div>

<script type="text/javascript">
    function resizeMap() {
        var mapHeight = $('#main').height() - (6 + $('.ui-layout-south').outerHeight());
        $('#map').css('height', mapHeight);
    }

    $(window).resize(function(){
        resizeMap();
    });

    $(document).ready(function () {
        resizeMap();
//        {# 지역현황 > 인구통계 > 지역선택 #}
        $('#btn-ps-area').button().on('click', function () {
            set_law_sid_areas('radio');
            $('#btn-area').button().on('click', function () {
                set_areas('', 'spn-ps-area');
            });
        });
//        {# 지역현황 > 세대통계 > 지역선택 #}
        $('#btn-hs-a').button().on('click', function () {
            set_law_sid_areas('checkbox');
            $('#btn-area').button().on('click', function () {
                set_areas('', 'spn-hs-a');
            });
        });
//        {# 지역현황 > 인구이동 > 전출지 선택 #}
        $("#btn-pm-oa").button().on('click', function () {
            set_law_sid_areas('checkbox');
            $('#btn-area').button().on('click', function () {
                set_areas('out_', 'spn-pm-oa');
            });
        });
//        {# 지역현황 > 인구이동 > 전입지 선택 #}
        $('#btn-pm-ia').button().on('click', function () {
            set_law_sid_areas('radio');
            $('#btn-area').button().on('click', function () {
                set_areas('in_', 'spn-pm-ia');
            });
        });
//        {# 지역현황 > 실거래가 > 지역선택 #}
        $('#btn-mp-area').button().on('click', function () {
            set_law_sid_areas('radio');
            $('#btn-area').button().on('click', function () {
                set_areas('', 'spn-mp-area');
            });
        });
//        {# 지역현황 > 건물현황 > 지역선택 #}
        $('#btn-ib-area').button().on('click', function () {
            set_law_sid_areas('radio');
            $('#btn-area').button().on('click', function () {
                set_areas('', 'spn-ib-area');
            });
        });
//        {# 지역현황 > 업종현황 > 지역선택 #}
        $('#btn-bs-area').button().on('click', function () {
            set_law_sid_areas('radio');
            $('#btn-area').button().on('click', function () {
                set_areas('', 'spn-bs-area');
            });
        });

//        {# 각 아코디언 탭에 들어가는 검색조건인 셀렉트박스에 코드를 로딩 시 세팅 #}
//        {# 지역현황 > 인구이동 #}
        set_codes_for_selectpicker('aplcnt_age', 'aplcnt_age');
        set_codes_for_selectpicker('aplcnt_sex', 'aplcnt_sex');
        set_codes_for_selectpicker('mv_reasn', 'mv_reasn');

//        {# 지역현황 > 세대통계 #}
        set_codes_for_selectpicker('rsdnc_clsftn', 'rsdnc_clsftn');
        set_codes_for_selectpicker('fmly_num', 'fmly_num');
        set_codes_for_selectpicker('room_num', 'room_num');

//        {# 지역현황 > 인구통계 #}
        set_codes_for_selectpicker('age_grp', 'age_grp');

//        {# begin of 지도 컨트롤 설정 #}
        $('input:radio[name=rdo-control-all]').click(function () {
            if ($(this).val() === 'true') {
                map.addControl(overviewMapControl);
                map.addControl(fullScreenControl);
                map.addControl(zoomSliderControl);
                map.addControl(scaleLineControl);
                $('.layer-switcher').show();
                $('.ol-zoom').show();

                $('input:radio[name=rdo-control-zbutton][value=true]').prop('checked', true);
                $('input:radio[name=rdo-control-zslider][value=true]').prop('checked', true);
                $('input:radio[name=rdo-control-sline][value=true]').prop('checked', true);
                $('input:radio[name=rdo-control-fscreen][value=true]').prop('checked', true);
                $('input:radio[name=rdo-control-lswitcher][value=true]').prop('checked', true);
                $('input:radio[name=rdo-control-ovmap][value=true]').prop('checked', true);
            } else {
                map.removeControl(overviewMapControl);
                map.removeControl(fullScreenControl);
                map.removeControl(zoomSliderControl);
                map.removeControl(scaleLineControl);
                $('.layer-switcher').hide();
                $('.ol-zoom').hide();

                $('input:radio[name=rdo-control-zbutton][value=false]').prop('checked', true);
                $('input:radio[name=rdo-control-zslider][value=false]').prop('checked', true);
                $('input:radio[name=rdo-control-sline][value=false]').prop('checked', true);
                $('input:radio[name=rdo-control-fscreen][value=false]').prop('checked', true);
                $('input:radio[name=rdo-control-lswitcher][value=false]').prop('checked', true);
                $('input:radio[name=rdo-control-ovmap][value=false]').prop('checked', true);
            }
        });

        $('input:radio[name=rdo-control-zbutton]').click(function () {
            $(this).val() === 'true' ? $('.ol-zoom').show() : $('.ol-zoom').hide();
        });
        $('input:radio[name=rdo-control-zslider]').click(function () {
            $(this).val() === 'true' ? map.addControl(zoomSliderControl) : map.removeControl(zoomSliderControl);
        });
        $('input:radio[name=rdo-control-sline]').click(function () {
            $(this).val() === 'true' ? map.addControl(scaleLineControl) : map.removeControl(scaleLineControl);
        });
        $('input:radio[name=rdo-control-fscreen]').click(function () {
            $(this).val() === 'true' ? map.addControl(fullScreenControl) : map.removeControl(fullScreenControl);
        });
        $('input:radio[name=rdo-control-lswitcher]').click(function () {
            $(this).val() === 'true' ? $('.layer-switcher').show() : $('.layer-switcher').hide();
        });
        $('input:radio[name=rdo-control-ovmap]').click(function () {
            $(this).val() === 'ture' ? map.addControl(overviewMapControl) : map.removeControl(overviewMapControl);
        });
//        {# end of 지도 컨트롤 설정 #}
    });
//    {# end of document.ready #}

//    {# Initialize JQuery UI Layout plug - in #}
    $('html').css('height', '100%');
    $('body').css('height', '100%');
    $('#main').css('height', '100%');
    $('#main').layout({
        west__size: '18%',
        west__resizable : false,
        west__onclose_start : function(){
            resetControl('ol-zoom', 'left', '0.5%');
            resetControl('ol-zoomslider', 'left', '0.5%');
            resetControl('ol-scale-line', 'left', '0.5%');
        },
//        west__minSize: '18%',
//        west__maxSize: '48%',
        east__size: '18%',
        east__resizable : false,
        east__onclose_start : function(){
            resetControl('ol-full-screen', 'right', '0.5%');
            resetControl('layer-switcher', 'right', '0.5%');
            resetControl('ol-overviewmap', 'right', '0.5%');
        },
//        east__minSize: '18%',
//        east__maxSize: '48%',
        south__size: '1%',
        south__minSize: '5%',
        south__maxSize: '100%',
        south__zIndex: 99,

        west__onresize: function(){
            $.layout.callbacks.resizePaneAccordions;
            resetControl('ol-zoom', 'left', '18.5%');
            resetControl('ol-zoomslider', 'left', '18.5%');
            resetControl('ol-scale-line', 'left', '18.5%');
        },
        east__onresize: function(){
            $.layout.callbacks.resizePaneAccordions
            resetControl('ol-full-screen', 'right', '18.5%');
            resetControl('layer-switcher', 'right', '18.5%');
            resetControl('ol-overviewmap', 'right', '18.5%');
        },
        south__onclose_start: function () {
            if (this.isClosed) {
                this.isClosed = false;
                $('#main').layout().sizePane('south', '1%');
                $('.ui-layout-toggler-south-closed').removeClass('ui-layout-toggler-south-closed').addClass('ui-layout-toggler-south-open');
            } else {
                this.isClosed = true;
                $('#main').layout().sizePane('south', '95%');
                $('.ui-layout-toggler-south-open').removeClass('ui-layout-toggler-south-open').addClass('ui-layout-toggler-south-closed');
            }
            return false;
        },
    });
    $('#west-accordion').accordion({heightStyle: 'fill'});
    $('#east-accordion').accordion({heightStyle: 'fill', active: 0});

    var layers = [];

    function resetControl(class_name, target_css, value) {
        $('.' + class_name).css(target_css, value);
    }

    layers[0] = new ol.layer.Tile({
        title: '위성 지도',
        type: 'base',
        source: new ol.source.XYZ({
            url: 'http://xdworld.vworld.kr:8080/2d/Satellite/201612/{z}/{x}/{y}.jpeg'
        })
    });

    layers[1] = new ol.layer.Tile({
        title: '기본 지도',
        type: 'base',
        source: new ol.source.XYZ({
            url: 'http://xdworld.vworld.kr:8080/2d/Base/201612/{z}/{x}/{y}.png'
        })
    });

    var overviewMapControl = new ol.control.OverviewMap({
        className: 'ol-overviewmap ol-custom-overviewmap',
        layers: layers,
        collapseLabel: '\u00BB',
        label: '\u00AB',
        collapsed: false
    });
    var fullScreenControl = new ol.control.FullScreen();

    fullScreenControl.on('change', function(evt){
        alert(evt);
    });

    fullScreenControl.on('propertychange', function(evt){
        alert(evt);
    });

    var zoomSliderControl = new ol.control.ZoomSlider();
    var scaleLineControl = new ol.control.ScaleLine();
    var layerSwitcherControl = new ol.control.LayerSwitcher();

    var view = new ol.View({
        center: ol.proj.fromLonLat([126.991823835784, 37.5519181289032]),
        zoom: 8,
        minZoom: 7,
        maxZoom: 18
    });
//    {# 오픈레이어스 팝업 #}
    var container = document.getElementById('popup');
    var content = document.getElementById('popup-content');
    var closer = document.getElementById('popup-closer');

    var overlay = new ol.Overlay(({
        element: container,
        autoPan: true,
        autoPanAnimation: {
            duration: 250
        }
    }));

    closer.onclick = function () {
        overlay.setPosition(undefined);
        closer.blur();
        return false;
    };
//    {# 동적으로 레이어를 생성하기 위해 오버레이 그룹을 별도로 만듦 #}
    var overlayGroup = new ol.layer.Group({
        title: 'Overlays',
        layers: []
    });
//    {# 베이스 맵 그룹을 포함한 맵 객체를 생성 #}
    var map = new ol.Map({
        controls: ol.control.defaults().extend([
            overviewMapControl,
            fullScreenControl,
            zoomSliderControl,
            scaleLineControl,
            layerSwitcherControl
        ]),
        interactions: ol.interaction.defaults().extend([
            new ol.interaction.DragRotateAndZoom()
        ]),
        layers: [
            new ol.layer.Group({
                title: 'Base maps',
                layers: layers
            }),
            overlayGroup
        ],
        logo: false,
        overlays: [overlay],
        target: 'map',
        view: view
    });
//    {# geoserver url은 설정(settings.py) 에서 가져오도록 수정해야 함 #}
    var url = 'http://183.109.124.94:9090/geoserver/hms/wms';
    var mvmt_layer = new ol.layer.Tile({
        title: '',//오버레이 그룹에 나오지 않도록 하기 위해 타이틀 없앰
        source: new ol.source.TileWMS({
            url: url,
            serverType: 'geoserver',
            crossOrigin: 'anonymous'
        })
    });
    var update_params = function (layers, featureid) {
        console.log(layers);
        console.log(featureid);
        mvmt_layer.getSource().updateParams({
            'layers': layers,
            'featureid': featureid
            // TODO : featureID  여러개 넣어서 테스트 해볼 것
            // TODO : 'featureid': featureid
        });
    };

    overlayGroup.getLayers().push(mvmt_layer);
    //layerSwitcherControl.showPanel();//자꾸 떠서 걸리적거림...ㅡㅡ;


//    {# 지도 좌표 이동 애니메이션 #}
    var do_bounce = function (location, view, done, location_type) {
        var duration = 1000;
        var zoom = view.getZoom();
        var parts = 2;
        var called = false;

        function callback(complete) {
            --parts;
            if (called) {
                return;
            }
            if (parts === 0 || !complete) {
                called = true;
                done(complete);
            }
        }

        var bounceAfterZoom = {
            sid : 11,
            sgg : 13,
            emd : 15
        };

        view.animate({
            center: location,
            duration: duration
        }, callback);
        view.animate({
            zoom: zoom - 3,
            duration: duration / 2
        }, {
            zoom: bounceAfterZoom[location_type],
            duration: duration / 2
        }, callback);
    };
    /*
            map.on('singleclick', function(e) {
                var coordinate = e.coordinate;
                var url = overlayGroup.getLayers().item(0).getSource().getGetFeatureInfoUrl(
                    coordinate,
                    view.getResolution(),
                    view.getProjection(),
                    {
                        'INFO_FORMAT': 'text/html',
                        'FEATURE_COUNT': 50,
                        'QUERY_LAYERS': 'hms:law_sid_area'
                    }
                );
                content.innerHTML = '<iframe seamless src="' + url + '"></iframe>';
                overlay.setPosition(coordinate);
            });
    */
    /*
            var highlight;
            var displayFeatureInfo = function(pixel) {

                var feature = map.forEachFeatureAtPixel(pixel, function(feature) {
                    return feature;
                });

                var info = document.getElementById('info');
                if (feature) {
                  info.innerHTML = feature.getId() + ': ' + feature.get('name');
                } else {
                  info.innerHTML = '&nbsp;';
                }

                if (feature !== highlight) {
                    if (highlight) {
                        featureOverlay.getSource().removeFeature(highlight);
                    }
                    if (feature) {
                        featureOverlay.getSource().addFeature(feature);
                    }
                    highlight = feature;
                }

            };
    */
    /*
            var select = new ol.interaction.Select();
            map.addInteraction(select);

            map.on('click', function(e) {
                displayFeatureInfo(e.pixel);
            });
    */
//    {# 코드 목록을 조회하여 selectpicker에 옵션들을 세팅 #}

    function set_codes_for_selectpicker(group_code, element_id, element_type) {
        $.ajax({
            method: 'POST',
            url: '{{ url_for("common.get_codes") }}',
            data: {group_code: group_code},
            dataType: 'json'
        }).done(function (data) {
            var results = [];
            $.each(data.codes, function (i, code) {
                results.push('<option value="' + code.code + '">' + code.name + '</option>');
            });
            $('#' + element_id).html(results.join('')).selectpicker('refresh');
        });
    }

    //    {# 인구통계 검색 #}
    function srch_popltn_stats() {
        codeStyle = 'popltn_stats';
        gridData = [];

        var year = $('#ps_eyear').val();
        var month = $('#ps_emonth').val();
        var selected_area = $('#spn-ps-area').text();

        $.ajax({
            url: '{{ url_for("situation.srch_popltn_stats") }}',
            method: 'POST',
            data: $('#frm-west-0').serialize(),
            dataType: 'json'
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                gridData.push(item);
            });
        });

        $.ajax({
            url: '{{ url_for("situation.srch_popltn_stats") }}',
            method: 'POST',
            data: $('#frm-west-0').serialize() + '&req_type=map',
            dataType: 'json'
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                content.innerHTML = '<span class="label label-success" style="display: inline-block;">' + selected_area +
                    '</span><br>' + year + '년 ' + month + '월, 선택 연령대 인구수: ' + set_comma(item.total_num) + '(세대)';
                overlay.setPosition(ol.proj.fromLonLat(item.coordinates));
            });
        }).fail(function (data) {
            alert(data.msg);
        });

        setAppendedAll(true);

//        var datatable;
//        if ($.fn.DataTable.isDataTable('#dataTables')) {
//            alert('뭐타니? 1');
//            $('#dataTables').DataTable().ajax.reload(null, false);
//        } else {
//            alert('뭐타니? 2');
//            datatable = $('#dataTables').DataTable({
//                pageLength: 3,
//                bPaginate: true,
//                bLengthChange: true,
//                lengthMenu : [ [ 3, 5, 10, -1 ], [ 3, 5, 10, "All" ] ],
//                bAutoWidth: false,
//                processing: true,
//                ordering: true,
//                serverSide: false,
//                searching: true,
//            });
//        }
//
//        var data = $.ajax({
//            url: '{{ url_for("situation.srch_popltn_stats") }}',
//            method: 'POST',
//            data: $('#frm-west-0').serialize(),
//            dataType: 'json'
//        });
//
//        datatable.clear().draw();
//        datatable.rows.add(data);
//        datatable.columns.adjust().draw();
//
//        function getFormData($form){
//            var unindexed_array = $form.serializeArray();
//            var indexed_array = {};
//
//            $.map(unindexed_array, function(n, i){
//                indexed_array[n['name']] = n['value'];
//            });
//
//            return indexed_array;
//        }

//        {# 남쪽 패널에 jqGrid 출력 #}
        $('#jqGrid').jqGrid({
            url: '{{ url_for("situation.srch_popltn_stats") }}',
            mtype: 'POST',
            styleUI: 'Bootstrap',
            datatype: 'json',
            postData: $('#frm-west-0').serialize(),
            colModel: [
                {label: '측정년도', name: 'srvy_yyyymm'},
                {label: '시도', name: 'sid'},
                {label: '시군구', name: 'sgg'},
                {label: '읍면동', name: 'emd'},
                {label: '연령대', name: 'age_grp'},
                {label: '남자수', name: 'man_num'},
                {label: '여자수', name: 'woman_num'},
                {label: '총인구수', name: 'total_num'},
            ],
            viewrecords: true,
            width: '100%',
            height: '100%',
            rowNum: 50,
            pager: "#jqGridPager"
        });
    }

//    {# 세대통계 검색 #}
    function srch_hshold_stats() {
        codeStyle = 'hshold_stats';
        gridData = [];

        var year = $('#ed_year').val();
        var selected_area = $('#spn-hs-a').text();
        $.ajax({
            url: '{{ url_for("situation.srch_hshold_stats") }}',
            method: 'POST',
            data: $('#frm-west-1').serialize() + '&req_type=map',
            dataType: 'json'
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                content.innerHTML = '<span class="label label-success" style="display: inline-block;">' + selected_area +
                    '</span><br>' + year + '년, 총 세대수: ' + set_comma(item.hshold_sum) + '(세대)';
                overlay.setPosition(ol.proj.fromLonLat(item.coordinates));
            });
        }).fail(function (data) {
            alert(data.msg);
        });

        $.ajax({
            url: '{{ url_for("situation.srch_hshold_stats") }}',
            method: 'POST',
            data: $('#frm-west-1').serialize(),
            dataType: 'json'
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                gridData.push(item);
            });
        });

//        {# 남쪽 패널에 jqGrid 출력 #}
        $('#jqGrid').jqGrid({
            url: '{{ url_for("situation.srch_hshold_stats") }}',
            mtype: 'POST',
            styleUI: 'Bootstrap',
            datatype: 'json',
            postData: $('#frm-west-1').serialize(),
            colModel: [
                {label: '측정년도', name: 'srvy_year'},
                {label: '시도', name: 'sid'},
                {label: '시군구', name: 'sgg'},
                {label: '주거유형', name: 'rsdnc_clsftn'},
                {label: '세대원수', name: 'fmly_num'},
                {label: '방개수', name: 'room_num'},
                {label: '세대수', name: 'hshold_num'},
            ],
            viewrecords: true,
            width: '100%',
            height: '100%',
            rowNum: 100,
            loadonce: true,
            pager: '#jqGridPager'
        });

        setAppendedAll(true);
    }

    //    {# 인구이동 검색 #}
    function srch_popltn_mvmt() {
        codeStyle = 'popltn_mvmt';
        gridData = [];

        $.ajax({
            url: '{{ url_for("situation.srch_popltn_mvmt") }}',
            method: 'POST',
            data: $('#frm-west-2').serialize() + '&req_type=map',
            dataType: 'json'
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                content.innerHTML = '총 전입자수: ' + item.fmly_sum + '<br>(총 전입세대수: ' + item.hshold_cnt + ')';
                overlay.setPosition(ol.proj.fromLonLat(item.coordinates));
            });
        }).fail(function (data) {
            alert(data.msg);
        });
//        {# 남쪽 패널에 jqGrid 출력 #}
        $('#jqGrid').jqGrid({
            url: '{{ url_for("situation.srch_popltn_mvmt") }}',
            mtype: 'POST',
            styleUI: 'Bootstrap',
            datatype: 'json',
            postData: $('#frm-west-2').serialize(),
            colModel: [
                {label: '전입시기', name: 'in_yyyymm'},
                {label: '전입시도', name: 'in_sid'},
                {label: '전입시군구', name: 'in_sgg'},
                {label: '전입읍면동', name: 'in_emd'},
                {label: '전출시도', name: 'out_sid'},
                {label: '전출시군구', name: 'out_sgg'},
                {label: '전출읍면동', name: 'out_emd'},
                {label: '이동사유', name: 'mv_reasn'},
                {label: '신고자유형', name: 'aplcnt_clsftn'},
                {label: '신고자나이', name: 'aplcnt_age'},
                {label: '신고자성별', name: 'aplcnt_sex'},
                {label: '이동가구원수', name: 'fmly_num'}
            ],
            viewrecords: true,
            width: '100%',
            height: '100%',
            rowNum: 100,
            loadonce: true,
            pager: '#jqGridPager'
        });

        setAppendedAll(true);
    }

    //    {# 실거래가 검색 #}
    function srch_trnstn_situtn() {
        codeStyle = 'trnstn_situtn';
        gridData = [];

        $.ajax({
            url: '{{ url_for("situation.srch_trnstn_situtn") }}',
            method: 'POST',
            data: $('#frm-west-3').serialize() + '&req_type=map',
            dataType: 'json'
        }).done(function (data) {
            alert(1);
            $.each(data.rows, function (i, item) {
                content.innerHTML = item.id;
                overlay.setPosition(ol.proj.fromLonLat(item.coordinates));
            });
        }).fail(function (data) {
            alert(data.msg);
        });

//        $.ajax({
//            url: '{{ url_for("situation.srch_trnstn_situtn") }}',
//            method: 'POST',
//            data: $('#frm-west-3').serialize(),
//            dataType: 'json'
//        }).done(function (data) {
//            $.each(data.rows, function (i, item) {
//                gridData.push(item);
//            });
//        });

////        {# 남쪽 패널에 jqGrid 출력 #}
//        $('#jqGrid').jqGrid({
//            url: '{{ url_for("situation.srch_trnstn_situtn") }}',
//            mtype: 'POST',
//            styleUI: 'Bootstrap',
//            datatype: 'json',
//            postData: $('#frm-west-3').serialize(),
//            colModel: [
//                {label: '측정년도', name: 'srvy_yyyymm'},
//                {label: '시도', name: 'sid'},
//                {label: '시군구', name: 'sgg'},
//                {label: '읍면동', name: 'emd'},
//                {label: '연령대', name: 'age_grp'},
//                {label: '남자수', name: 'man_num'},
//                {label: '여자수', name: 'woman_num'},
//                {label: '총인구수', name: 'total_num'},
//            ],
//            viewrecords: true,
//            width: '100%',
//            height: '100%',
//            rowNum: 50,
//            pager: "#jqGridPager"
//        });

        setAppendedAll(true);
    }

    //    {# 건물현황 검색 #}
    function srch_idnfln_bldng() {
        codeStyle = 'idnfln_bldng';
        gridData = [];

        console.log($('#frm-west-4').serialize());

        $.ajax({
            url: '{{ url_for("situation.srch_idnfln_bldng") }}',
            method: 'POST',
            data: $('#frm-west-4').serialize() + '&req_type=map',
            dataType: 'json'
        }).done(function (data) {
            alert(data);
        }).fail(function (data) {
            alert(data.msg);
        });

        $.ajax({
            url: '{{ url_for("situation.srch_idnfln_bldng") }}',
            method: 'POST',
            data: $('#frm-west-4').serialize(),
            dataType: 'json'
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                gridData.push(item);
            });
        });

//        {# 남쪽 패널에 jqGrid 출력 #}
        $('#jqGrid').jqGrid({
            url: '{{ url_for("situation.srch_idnfln_bldng") }}',
            mtype: 'POST',
            styleUI: 'Bootstrap',
            datatype: 'json',
            postData: $('#frm-west-4').serialize(),
            colModel: [
                {label: '시도', name: 'sid_cd'},
                {label: '시군구', name: 'sgg_cd'},
                {label: '읍면동', name: 'emd_cd'},
                {label: '주거유형', name: 'prcl_addrs'},
                {label: '세대원수', name: 'road_addrs'}
            ],
            viewrecords: true,
            width: '100%',
            height: '100%',
            rowNum: 100,
            loadonce: true,
            pager: '#jqGridPager'
        });

        setAppendedAll(true);
    }

    // Add slideDown animation to Bootstrap dropdown when expanding.
    $('.dropdown').on('show.bs.dropdown', function() {
    $(this).find('.dropdown-menu').first().stop(true, true).slideDown();
    });

    // Add slideUp animation to Bootstrap dropdown when collapsing.
    $('.dropdown').on('hide.bs.dropdown', function() {
    $(this).find('.dropdown-menu').first().stop(true, true).slideUp();
    });

//    {# 업종현황 검색 #}
    function srch_busins_situtn() {
        codeStyle = 'busins_situtn';
        gridData = [];

        console.log($('#frm-west-5').serialize());

        $.ajax({
            url: '{{ url_for("situation.srch_busins_situtn") }}',
            method: 'POST',
            data: $('#frm-west-5').serialize() + '&req_type=map',
            dataType: 'json'
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
            });
        }).fail(function (data) {
            alert(data.msg);
        });

        $.ajax({
            url: '{{ url_for("situation.srch_busins_situtn") }}',
            method: 'POST',
            data: $('#frm-west-5').serialize(),
            dataType: 'json'
        }).done(function (data) {
            console.log(data)
            $.each(data.rows, function (i, item) {
            });
        });

//        {# 남쪽 패널에 jqGrid 출력 #}
        $('#jqGrid').jqGrid({
            url: '{{ url_for("situation.srch_busins_situtn") }}',
            mtype: 'POST',
            styleUI: 'Bootstrap',
            datatype: 'json',
            postData: $('#frm-west-5').serialize(),
            colModel: [
                {label: '시도', name: 'sid'},
                {label: '시군구', name: 'sgg'},
                {label: '읍면동', name: 'emd'},
                {label: '인가허가년월일', name: 'lcnsng_dt'},
                {label: '업종분류코드', name: 'busins_clsftn_cd'},
                {label: '영업상태', name: 'busins_condtn'},
                {label: '소재지면적', name: 'loctn_area'},
                {label: '업체명', name: 'compny_nm'},
                {label: '지번우편번호', name: 'prcl_zipcd'},
                {label: '지번주소', name: 'prcl_addrs'},
                {label: '도로명우편번호', name: 'road_zipcd'},
                {label: '도로명주소', name: 'road_addrs'},
                {label: '소재지전화번호', name: 'loctn_phone'}
            ],
            viewrecords: true,
            width: '100%',
            height: '100%',
            rowNum: 100,
            loadonce: true,
            pager: '#jqGridPager'
        }).trigger('reloadGrid');
        console.log(jqGrid.postData);

        setAppendedAll(true);
    }

//    {# 콤마 찍기 #}
    function set_comma(str) {
        str = String(str);
        return str.replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,');
    }

//    {# 선택한 지역을 검색조건으로 세팅 #}
    function set_areas(name_prefix, target_id) {
        var results = [];
        $('#div-sid-area').find('input[name$=-area]:checked').each(function () {
            results.push('<input type="hidden" name="' + name_prefix + 'sid_cd" value="' + $(this).val() + '">');
            results.push('<span class="label label-success" style="display: inline-block;">' + $(this).parent().text() + '</span>\n');
        });
        $('#div-sgg-area').find('input[name$=-area]:checked').each(function () {
            results.push('<input type="hidden" name="' + name_prefix + 'sgg_cd" value="' + $(this).val() + '">');
            results.push('<span class="label label-success" style="display: inline-block;">' + $(this).parent().text() + '</span>\n');
        });
        $('#div-emd-area').find('input[name$=-area]:checked').each(function () {
            results.push('<input type="hidden" name="' + name_prefix + 'emd_cd" value="' + $(this).val() + '">');
            results.push('<span class="label label-success" style="display: inline-block;">' + $(this).parent().text() + '</span>\n');
        });
        $('#' + target_id).html(results.join(''));
//        {# 실행 후 반드시 클릭 이벤트 오프를 해줌 #}
        $('#btn-area').button().off('click');
    }
    /*
            var check_input = function() {
                $('[type=checkbox]').click(function(e) {
                    e.stopPropagation();
                });
                $('[type=radio]').click(function(e) {
                    e.stopPropagation();
                });
                $('.list-group a').click(function(e) {
                    e.stopPropagation();
                    var $this;
                    $this = $(this).find('[type=checkbox]');
                    if ($this.is(':checked')) {
                        $this.prop('checked', false);
                    } else {
                        $this.prop('checked', true);
                    }
                    $this = $(this).find('[type=radio]');
                    if ($this.is(':checked')) {
                        $this.prop('checked', false);
                    } else {
                        $this.prop('checked', true);
                    }
                });
            }
    */
//    {# 법정 시도 지역 조회 후 세팅 #}
    function set_law_sid_areas(input_type) {
        $.ajax({
            method: 'GET',
            url: '{{ url_for("common.get_law_areas") }}',
            data: {},
            dataType: 'json'
        }).done(function (data) {
            var results = [];
            results.push('<div class="list-group">');
            $.each(data.items, function (i, item) {
                results.push('<a href="#" class="list-group-item" onclick="set_law_sgg_areas(\'' + input_type + '\', \'' + item.sid_cd + '\');"> ' + item.sid_ko_nm + '<input id="sid-cd.' + item.sid_cd + '" name="' + input_type + '-area" type="' + input_type + '" class="pull-right" value="' + item.sid_cd + '" onclick="do_bounce(ol.proj.fromLonLat([' + item.coordinates + ']), view, function() {}, \'sid\'); update_params(\'' + item.layers + '\', \'' + item.featureid + '\');"></a>');
            });
            results.push('</div>');
            $('#div-sid-area').html(results.join(''));
        }).fail(function (data) {
            console.log(data.msg);
        });
//        {# 호출될 때마다 시군구, 읍면동 초기화 #}
        $('#div-sgg-area').html('');
        $('#div-emd-area').html('');
    }
//    {# 시도 코드로 법정 시군구 지역 조회 후 세팅 #}
    function set_law_sgg_areas(input_type, sid_cd) {
        $.ajax({
            method: 'GET',
            url: '{{ url_for("common.get_law_areas") }}',
            data: {sid_cd: sid_cd},
            dataType: 'json'
        }).done(function (data) {
            var results = [];
            results.push('<div class="list-group">');
            $.each(data.items, function (i, item) {
                results.push('<a href="#" class="list-group-item" onclick="set_law_emd_areas(\'' + input_type + '\', \'' + item.sgg_cd + '\');"> ' + item.sgg_ko_nm + '<input id="sgg-cd.' + item.sgg_cd + '" name="' + input_type + '-area" type="' + input_type + '" class="pull-right" value="' + item.sgg_cd + '" onclick="do_bounce(ol.proj.fromLonLat([' + item.coordinates + ']), view, function() {}, \'sgg\'); update_params(\'' + item.layers + '\', \'' + item.featureid + '\');"></a>');
            });
            results.push('</div>');
            $('#div-sgg-area').html(results.join(''));
        }).fail(function (data) {
            console.log(data.msg);
        });
    }
//    {# 시군구 코드로 법정 읍면동 지역 조회 후 세팅 #}
    function set_law_emd_areas(input_type, sgg_cd) {
        $.ajax({
            method: 'GET',
            url: '{{ url_for("common.get_law_areas") }}',
            data: {sgg_cd: sgg_cd},
            dataType: 'json'
        }).done(function (data) {
            var results = [];
            results.push('<div class="list-group">');
            $.each(data.items, function (i, item) {
                results.push('<a href="#" class="list-group-item"> ' + item.emd_ko_nm + '<input id="emd-cd.' + item.emd_cd + '" name="' + input_type + '-area" type="' + input_type + '" class="pull-right" value="' + item.emd_cd + '" onclick="do_bounce(ol.proj.fromLonLat([' + item.coordinates + ']), view, function() {}, \'emd\'); update_params(\'' + item.layers + '\', \'' + item.featureid + '\');"></a>');
            });
            results.push('</div>');
            $('#div-emd-area').html(results.join(''));
        }).fail(function (data) {
            console.log(data.msg);
        });
    }

</script>

{% endblock %}
