{% extends 'layouts/app.html' %}
{#{% import 'elements/map_controller.html' as controller %}#}

{% block title %}Housing Marketing System{% endblock %}
{% block meta_description %}Compete against yourself and others by guessing the
outcome of a dice roll. Win points and dominate the leaderboard.{% endblock %}

{% block body %}
<style type="text/css">
    .ol-custom-overviewmap,
    .ol-custom-overviewmap.ol-uncollapsible {
        bottom: 0;
        left: auto;
        right: 0;
        top: auto;
    }

    .ol-custom-overviewmap:not(.ol-collapsed) {
        border: 1px solid black;
    }

    .ol-custom-overviewmap .ol-overviewmap-map {
        border: none;
        width: 300px;
    }

    .ol-custom-overviewmap .ol-overviewmap-box {
        border: 2px solid red;
    }

    .ol-custom-overviewmap:not(.ol-collapsed) button {
        bottom: 1px;
        left: auto;
        right: 1px;
        top: auto;
    }

    #userMarkerPopup {
        width: 300px;
        height: 325px;
    }

    .map:-moz-full-screen {
        height: 100%;
    }

    .map:-webkit-full-screen {
        height: 100%;
    }

    .map:-ms-fullscreen {
        height: 100%;
    }

    .map:fullscreen {
        height: 100%;
    }

    .ol-rotate {
        top: 3em;
    }

    /* 팝업 */
    .ol-popup{
        position: absolute;
        background-color: white;
        -webkit-filter: drop-shadow(0 1px 4px rgba(0, 0, 0, 0.2));
        filter: drop-shadow(0 1px 4px rgba(0, 0, 0, 0.2));
        padding: 15px;
        /*border-radius: 10px;*/
        border: 1px solid #cccccc;
        bottom: 12px;
        left: -50px;
        min-width: 350px;
    }

    #polygon-popup{
        width: 500px;
    }

    .ol-popup:after, .ol-popup:before {
        top: 100%;
        border: solid transparent;
        content: " ";
        height: 0;
        width: 0;
        position: absolute;
        pointer-events: none;
    }

    .ol-popup:after {
        border-top-color: white;
        border-width: 10px;
        left: 48px;
        margin-left: -10px;
    }

    .ol-popup:before {
        border-top-color: #cccccc;
        border-width: 11px;
        left: 48px;
        margin-left: -11px;
    }

    .ol-popup-closer {
        content: "✖";
        text-decoration: none;
        position: absolute;
        top: 2px;
        right: 8px;
    }

    .ol-popup-closer:after {
        content: "✖";
    }

    #viewMarkerPopup {
        width: 350px;
    }

    /**** ctree ****/
    .ol-zoom {
        left: 18.5%;
    }

    .ol-zoomslider {
        left: 18.5%;
    }

    .ol-scale-line {
        left: 18.5%;
    }

    .ctl-refresh-map {
        right: 18.5%;
        top: 23.5em;
    }

    .ctl-marker-set {
        top : 21em;
        left: 18.5%;
        /*transform: translate(-50%,0);*/
    }

    .ctl-marker-view {
        /*right: 20.7%;*/
        top : 21em;
        left: 21%;
        /*transform: translate(-50%,0);*/
    }

    .ctl-bulk-view {
        top : 21em;
        left: 23.5%;
        /*transform: translate(-50%,0);*/
    }

    .ctl-draw-polygon {
        top : 24em;
        left: 18.5%;
        /*transform: translate(-50%, 0);*/
    }

    .ctl-draw-square {
        top : 24em;
        left: 21%;
        /*transform: translate(-50%, 0);*/
    }

    .ctl-draw-circle {
        top : 24em;
        left: 23.5%;
        /*transform: translate(-50%, 0);*/
    }

    .img-downloader {
        top : 6.5em;
        left: 50%;
        transform: translate(-50%, 0);
    }

    .ctl-addr-search {
        top: 0.5em;
        left: 21.5%;
    }

    .ctl-map-title {
        /*right: 20.7%;*/
        top : 0.5em;
        left: 50%;
        transform: translate(-50%,0);
    }


    #label-map-title{
        width: 240px;
        height: 50px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 5px;
        padding: 10px;
    }

    #label-map-title > p{
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .ol-control.ol-search-control ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .ol-control.ol-search-control li {
        color: rgba(0, 60, 136, 0.8);
        font-size: 1em;
        margin: 0.1em 0.5em 0.1em 0.5em;
        padding: 0.1em 0.5em 0.1em 0.5em;
        cursor: default;
        clear: both;
        border-bottom: 1px solid #e0e0e0;
    }

    .ol-control.ol-search-control li:hover {
        background-color: rgba(0, 60, 136, .5);
        color: #fff;
    }

    .ol-control.ol-search-control div{
        overflow: auto;
        height: 74px;
    }

    .ctl-slide-view {
        bottom: 3em;
        left: 50%;
        transform: translate(-50%,0);
    }

    #ctl-slide-view {
        height: 300px;
    }

    .ctl-list-view {
        top: 27em;
        left: 21%;
    }

    .ctl-list-window {
        top: 27em;
        left: 23.5%;
        background: white;
        position: absolute;

    }

    .ctl-card-view {
        top: 27em;
        left: 18.5%;
    }

    .ctl-card-window {
        top: 27em;
        left: 23.5%;
        height: 350px;
        width: 300px;
        background: white;
        position: absolute;

    }

    .ctl-legend-view {
        bottom: 3em;
        right: 18.5%;
    }
    .ctl-time-bar {
        bottom: 3em;
        left: 50%;
        transform: translate(-50%,0);
    }

    #time-bar-player{
        margin-top: 10px;
    }

    .window-body ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .window-body li {
        color: rgba(0, 60, 136, 0.8);
        font-size: 1em;
        margin: 0em 0em 0.5em 0em;
        cursor: default;
        clear: both;
        border-bottom: 1px solid #e0e0e0;
        list-style: none;
    }

    .window-body li:hover {
        background-color: rgba(0, 60, 136, .5);
        color: #fff;
    }

    .window-body{
        overflow: auto;
        height: 15em;
    }

    .ol-control.ol-legend-control div{
        overflow: auto;
        /*height: 15em;*/
    }

    .ol-list-control {
        border-radius: 4px;
        padding: 2px;
        position: absolute;
        /*width:300px;*/
        top: 27em;
        left: 18.5%;
    }

    .ol-legend-control {
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 4px;
        padding: 2px;
        position: absolute;
        width: 160px;
        height: 11.5em;
        overflow: auto;
    }

    .ol-timeBar-control {
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 4px;
        padding-top: 1em;
        padding-bottom: 1em;
        padding-left: 4em;
        padding-right: 4em;
        position: absolute;
        width: 30em;
        height: 8em;
    }

    .ol-full-screen {
        right: 18.5%;
    }

    .toggle-control-right {
        right: 24.5em;
    }

    .ol-overviewmap {
        right: 18.5%;
        bottom: 3em;
    }

    .md-margin-top {
        margin-top: 0;
    }

    .text-primary-bookmark {
        color: #ffffff;
    }

    .btn-bookmark {
        padding: 0 4px 0 4px;
        border: 0;
        margin-right: 2px;
    }

    .modal-chart-bar .modal-chart-horizontalBar .modal-chart-area .modal-chart-line {
        width: 80%;
    }

    .modal-chart-radar .modal-chart-pie {
        width: 50%;
    }

    .ol-control button:hover {
        background-color: rgba(0, 0, 0, 0.7)
    }

    .ol-control-selected {
        background-color: rgba(255, 255, 255, 0.7);
    }

    .tooltip {
        position: relative;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 4px;
        color: white;
        padding: 4px 8px;
        opacity: 0.7;
        white-space: nowrap;
    }

    .tooltip-measure {
        opacity: 1;
        font-weight: bold;
    }

    .tooltip-static {
        background-color: #ffcc33;
        color: black;
        border: 1px solid white;
    }

    .tooltip-measure:before,
    .tooltip-static:before {
        border-top: 6px solid rgba(0, 0, 0, 0.5);
        border-right: 6px solid transparent;
        border-left: 6px solid transparent;
        content: "";
        position: absolute;
        bottom: -6px;
        margin-left: -7px;
        left: 50%;
    }

    .tooltip-static:before {
        border-top-color: #ffcc33;
    }

    .loader {
        border: 8px solid #ffffff; /* Light grey */
        border-radius: 50%;
        border-top: 8px solid #3F316E; /* Blue */
        width: 60px;
        height: 60px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
        position: relative;
        z-index: 10;
        left: 50%;
        bottom: 50%;
        display: none;
    }

    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }
        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }

    .wrap-loading { /*화면 전체를 어둡게 합니다.*/
        position: fixed;
        left: 0;
        right: 0;
        top: 0;
        bottom: 2.1%;
        z-index: 9;
        background: rgba(0, 0, 0, 0.6); /*not in ie */
        filter: progid:DXImageTransform.Microsoft.Gradient(startColorstr='#20000000', endColorstr='#20000000'); /* ie */
        display: none;
    }
    .div-disable {
        height: 340px;
        background-color: #e1dfdf;
        color: #7a7070;
    }

    .div-table-title {
        background-color: black;
        padding: 5px;
        margin-bottom: 5px;
    }

    .margin-bottom{
        margin-bottom: 10px;
    }

    .width-full {
        width: 100%;
    }

    .width-2div {
        width: 50%;
    }

    .width-3div {
        width: 33.3%;
    }

    .width-4div {
        width: 25%;
    }

    #custom-handle {
        margin-left: -3.5em;
        width: 90px;
        height: 2em;
        top: 50%;
        margin-top: -1em;
        text-align: center;
        line-height: 1.6em;
        font-size: 13px;
    }

    .untouchable {
        -webkit-touch-callout: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        pointer-events: none;
        cursor: default;
        -webkit-tap-highlight-color: transparent
    }

    .untouchable:hover{
        opacity: 1;
    }

    .hahahoho:hover .untouchable-middle-box {
        opacity: 1;
    }

    .untouchable-middle-box {
        transition: .5s ease;
        opacity: 0;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 100;
        -ms-transform: translate(-50%, -50%);
        width: 90%;
    }

    .untouchable-middle-text {
        background-color: #000000;
        color: white;
        font-size: 16px;
        padding: 16px 56px;
        opacity: 0.7;
    }
    /**** ctree ****/

        .ol-zoom .ol-zoom-out {
        margin-top: 204px;
      }
      .ol-zoomslider {
        background-color: rgba(255, 255, 255, 0.8);
        top: 3.4em;
      }

      .ol-touch .ol-zoom .ol-zoom-out {
        margin-top: 212px;
      }
      .ol-touch .ol-zoomslider {
        top: 2.75em;
      }

      .ol-zoom-in.ol-has-tooltip:hover [role=tooltip],
      .ol-zoom-in.ol-has-tooltip:focus [role=tooltip] {
        top: 3px;
      }

      .ol-zoom-out.ol-has-tooltip:hover [role=tooltip],
      .ol-zoom-out.ol-has-tooltip:focus [role=tooltip] {
        top: 232px;
      }

    #search-result-div{
        padding: 5px;
        margin-top: 5px;
        height: 205px;
    }

    #ctl-addr-search{
        height: 240px;
    }

    .toggle-btn{
        backgroun: rgba(0, 0, 0, 0.7);
    }

    .window {
        display: none;
        position: absolute;
        z-index: 1;
        height: 350px;
        width: 300px;
    }

    .window .window-header {
        height: 35px;
        background: rgb(57, 152, 156);
        cursor: move;
        z-index: 2;
        padding-top: 5px;
        padding-bottom: 5px;
        padding-left: 10px;
        padding-right: 5px;
    }

    .window .window-header span {
        color: white;
        font-weight: bold;
    }

    .window .window-header button {
        height: 25px;
        width: 25px;
        padding-left: 0px;
        padding-right: 0px;
        padding-top: 0px;
        padding-bottom: 0px;
        border-top-width: 0px;
        border-right-width: 0px;
        border-bottom-width: 0px;
        border-left-width: 0px;
        border-radius: 0px;
    }

    .window .window-body {
        padding: 10px;
        height: 315px;
        overflow: auto;
        font-size: 11px;
    }

    .window-lg {
        display: none;
        position: absolute;
        z-index: 1;
        height: 440px;
        width: 1100px;
    }

    .window-lg .window-body {
        padding: 10px;
        height: 420px;
        overflow: unset;
        font-size: 11px;
    }

    .window-lg .window-body-card p {
        margin: 0px;
        padding: 0px;
    }

    .window-lg .window-body-card hr{
        margin-top: 2px;
        margin-bottom: 2px;
    }

    .card-table {
        height: 90px;
        overflow: auto;
    }

    .card-table table {
        padding: 0px;
        margin: 0px;
    }

    .card-table .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
        padding: 0px;
        padding-bottom: 1px;
    }

    .arrow-right {
        width: 0;
        height: 0;
        border-top: 60px solid transparent;
        border-bottom: 60px solid transparent;
        border-left: 25px solid #c6c6c6;
    }

    .arrow-right:hover {
        width: 0;
        height: 0;
        border-top: 60px solid transparent;
        border-bottom: 60px solid transparent;
        border-left: 25px solid #707070;
    }

    .arrow-left {
        width: 0;
        height: 0;
        border-top: 60px solid transparent;
        border-bottom: 60px solid transparent;
        border-right: 25px solid #c6c6c6;
    }

    .arrow-left:hover {
        width: 0;
        height: 0;
        border-top: 60px solid transparent;
        border-bottom: 60px solid transparent;
        border-right: 25px solid #707070;
    }
</style>

{# 공통 지역선택 모달 #}
<div id="mdl-area" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-area-label">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-area-label">지역선택</h4>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="list-group">
                                <a href="#" class="list-group-item active">시도</a>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="list-group">
                                <a href="#" class="list-group-item active">시군구</a>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="list-group">
                                <a href="#" class="list-group-item active">읍면동</a>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div id="div-sid-area" class="col-sm-4 pre-scrollable">
                        </div>
                        <div id="div-sgg-area" class="col-sm-4 pre-scrollable">
                        </div>
                        <div id="div-emd-area" class="col-sm-4 pre-scrollable">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-area" type="button" class="btn btn-default" data-dismiss="modal">확인</button>
            </div>
        </div>
    </div>
</div>

{# 즐겨찾기 모달 #}
<div id="mdl-bookmark" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-bookmark-label">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-bookmark-label">즐겨찾기 추가</h4>
            </div>
            <div id="mdl-bookmark-content" class="modal-body">
                <div id="clone-bookmark" class="untouchable">
                    <form id="clone-form">

                    </form>
                    <!--<div class="untouchable-middle-box">-->
                        <!--<div class="untouchable-middle-text">-->
                            <!--본 화면은 참고용입니다.<br>-->
                            <!--필터 변경은 좌측 화면에서 적용해주세요.-->
                        <!--</div>-->
                    <!--</div>-->
                </div>
                <hr>
                <!--<div>-->
                    <!--<form class="form-inline">-->
                <div class="form-group">
                    <input type="text" class="form-control" id="bookmark-name" placeholder="제목을 입력해주세요.">
                </div>
                    <!--</form>-->
                <!--</div>-->
            </div>
            <div class="modal-footer text-center" style="text-align: center;">
                <div class="w-100">
                    <button id="btn-bookmark-submit" type="button" class="btn btn-default" onclick="addBookmark();">저장</button>
                    <button id="btn-bookmark-cancel" type="button" class="btn btn-default" data-dismiss="modal">취소</button>
                </div>
            </div>
        </div>
    </div>
</div>
{# 차트 모달 #}
<div id="mdl-chart-radar" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-chart-radar-label">
    <div class="modal-dialog modal-chart-radar" role="document">
        <div id="mdl-content-radar" class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-chart-radar-label">레이더 차트</h4>
            </div>
            <div id="div-chart-radar" class="modal-body">
                <canvas id="cnv-chart-radar"></canvas>
            </div>
        </div>
    </div>
</div>
<div id="mdl-chart-bar" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-chart-bar-label">
    <div class="modal-dialog modal-chart-bar modal-lg" role="document">
        <div id="mdl-content-bar" class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-chart-bar-label">세로막대 차트</h4>
            </div>
            <div id="div-chart-bar" class="modal-body">
                <canvas id="cnv-chart-bar"></canvas>
            </div>
        </div>
    </div>
</div>
<div id="mdl-chart-horizontalBar" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="mdl-chart-horizontalBar-label">
    <div class="modal-dialog modal-chart-horizontalBar modal-lg" role="document">
        <div id="mdl-content-horizontalBar" class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-chart-horizontalBar-label">가로막대 차트</h4>
            </div>
            <div id="div-chart-horizontalBar" class="modal-body">
                <canvas id="cnv-chart-horizontalBar"></canvas>
            </div>
        </div>
    </div>
</div>
<div id="mdl-chart-area" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-chart-area-label">
    <div class="modal-dialog modal-chart-area modal-lg" role="document">
        <div id="mdl-content-area" class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-chart-area-label">영역 차트</h4>
            </div>
            <div id="div-chart-area" class="modal-body">
                <canvas id="cnv-chart-area"></canvas>
            </div>
        </div>
    </div>
</div>
<div id="mdl-chart-line" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-chart-line-label">
    <div class="modal-dialog modal-chart-line modal-lg" role="document">
        <div id="mdl-content-line" class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-chart-line-label">라인 차트</h4>
            </div>
            <div id="div-chart-line" class="modal-body">
                <canvas id="cnv-chart-line"></canvas>
            </div>
        </div>
    </div>
</div>
<div id="mdl-chart-pie" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-chart-pie-label">
    <div class="modal-dialog modal-chart-pie modal-lg" role="document">
        <div id="mdl-content-pie" class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-chart-pie-label">파이 차트</h4>
            </div>
            <div id="div-chart-pie" class="modal-body">
                <canvas id="cnv-chart-pie"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    let hmsUtil = new HmsUtil();
    let hmsUi = new HmsUi();
    let currentYear = hmsUtil.getCurrentYear();
    let currentMonth = hmsUtil.getCurrentMonth();

    let hmsChart = new HmsChart();
    let hmsControl = new HmsControl();

    let codeStyle = DEFAULT_FUNC.CODE_STYLE;
    let heatMapLayerName, poiLayerName = "";

    let gridData = [];

    let canAppened = {
        radar: true,
        bar: true,
        horizontalBar: true,
        area: true,
        line: true,
        pie: true
    };

    let chartConfig = {
        radar: hmsChart.getRadarConfig(),
        bar: hmsChart.getBarConfig(),
        horizontalBar: hmsChart.getHorizontalBarConfig(),
        area: hmsChart.getAreaConfig(),
        line: hmsChart.getLineConfig(),
        pie: hmsChart.getPieConfig()
    };

    function setChart(chartType, canvasId) {
        let ctx = document.getElementById(canvasId).getContext("2d");

        if (typeof(codeStyle) !== 'undefined' &&
            !hmsChart.getAcceptableTarget(chartType, codeStyle)) {
            alert("본 검색 결과에서는 해당 그래프를 지원하지 않습니다.");
        } else {
            if (chartType === 'radar') {
                if (dataParseForRadar()) {
                    let radarChart = new Chart(ctx, chartConfig[chartType]);
                    radarChart.update();
                    hmsUi.showModal('mdl-chart-radar');
                }
            } else if(chartType === 'bar') {
                if (dataParseForBar()) {
                    let barChart = new Chart(ctx, chartConfig[chartType]);
                    barChart.update();
                    hmsUi.showModal('mdl-chart-bar');
                }
            } else if(chartType === 'horizontalBar') {
                if (dataParseForHorizontalBar()) {
                    let horizontalBarChart = new Chart(ctx, chartConfig[chartType]);
                    horizontalBarChart.update();
                    hmsUi.showModal('mdl-chart-horizontalBar');
                }
            } else if(chartType === 'area') {
                if (dataParseForArea()) {
                    let areaChart = new Chart(ctx, chartConfig[chartType]);
                    areaChart.update();
                    hmsUi.showModal('mdl-chart-area');
                }
            } else if(chartType === 'line') {
                if (dataParseForLine()) {
                    let lineChart = new Chart(ctx, chartConfig[chartType]);
                    lineChart.update();
                    hmsUi.showModal('mdl-chart-line');
                }
            } else if(chartType === 'pie') {
                if (dataParseForPie()) {
                    let pieChart = new Chart(ctx, chartConfig[chartType]);
                    pieChart.update();
                    hmsUi.showModal('mdl-chart-pie');
                }
            } else {
                alert('Not my chart');
            }
        }
    }


//    {# 레이더 차트 Start  #}
    function dataParseForRadar() {
        if (gridData.length === 0) {
            alert("데이터 검색을 먼저해주세요.");
            return false
        } else {
            if (canAppened.radar) {

            }
            canAppened.radar = false;
            return true;
        }
    }
//    {# 레이더 차트 End  #}

//    {# 세로막대 차트 Start #}
    function dataParseForBar() {
        if (gridData.length === 0) {
            alert("데이터 검색을 먼저해주세요.");
            return false
        } else {
            if (canAppened.bar) {
                chartConfig.bar.options.title.text = '';
                chartConfig.bar.data.labels = [];
                chartConfig.bar.data.datasets = [];

                if (codeStyle === FUNC.POPLTN_STATS.CODE_STYLE) {
                    let ps_st_yyyymm = $('#ps_syear').val() + $('#ps_smonth').val();
                    let ps_ed_yyyymm = $('#ps_eyear').val() + $('#ps_emonth').val();

                    let ps_cols = hmsUtil.getTermArr(FUNC.POPLTN_STATS.TIME_START, FUNC.POPLTN_STATS.TIME_END, FUNC.POPLTN_STATS.TIME_STEP);

                    let ps_labels = [];
                    let ps_dataSets = {};
                    let ps_chartData = [];

                    for (let i = 0; i < ps_cols.length; i++) {
                        if (ps_cols[i] >= ps_st_yyyymm && ps_cols[i] <= ps_ed_yyyymm) {
                            ps_labels.push(hmsUtil.getDateToKor(ps_cols[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= ps_st_yyyymm && Number(key.replace(/"/gi, '')) <= ps_ed_yyyymm) {
                                    if (ps_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        ps_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        ps_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(ps_dataSets, function (k, v) {
                        ps_chartData.push(v);
                    });

                    let datasets = {
                        label: '인구수',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: ps_chartData
                    };

                    chartConfig.bar.options.title.text = "인구통계 세로막대 차트";
                    chartConfig.bar.data.labels = ps_labels;
                    chartConfig.bar.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.HSHOLD_STATS.CODE_STYLE) {
                    var st_yyyy = $('#hs_syear').val();
                    var ed_yyyy = $('#hs_eyear').val();

                    var hs_cols = hmsUtil.getTermArr(FUNC.HSHOLD_STATS.TIME_START, FUNC.HSHOLD_STATS.TIME_END, FUNC.HSHOLD_STATS.TIME_STEP);
                    var hs_labels = [];
                    var hs_dataSets = {};
                    var hs_chartData = [];

                    for (var i = 0; i < hs_cols.length; i++) {
                        if (hs_cols[i] >= st_yyyy && hs_cols[i] <= ed_yyyy) {
                            hs_labels.push(hmsUtil.getDateToKor(hs_cols[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= st_yyyy && Number(key.replace(/"/gi, '')) <= ed_yyyy) {
                                    if (hs_dataSets[key.replace(/"/gi, '')] === undefined) {

                                        hs_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        hs_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(hs_dataSets, function (k, v) {
                        hs_chartData.push(v);
                    });

                    var datasets = {
                        label: '인구수',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: hs_chartData
                    };

                    chartConfig.bar.options.title.text = "인구주택총조사 세로막대 차트";
                    chartConfig.bar.data.labels = hs_labels;
                    chartConfig.bar.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.TRNSTN_SITUTN_TRANS.CODE_STYLE) {
                    let tst_st_yyyymm = $('#tst_syear').val() + $('#tst_smonth').val();
                    let tst_ed_yyyymm = $('#tst_eyear').val() + $('#tst_emonth').val();

                    let tst_labels = [];
                    let tst_dataSets = {};
                    let tst_chartData = [];

                    let tst_cols = hmsUtil.getTermArr(FUNC.TRNSTN_SITUTN_TRANS.TIME_START, FUNC.TRNSTN_SITUTN_TRANS.TIME_END, FUNC.TRNSTN_SITUTN_TRANS.TIME_STEP);
                    for (let i = 0; i < tst_cols.length; i++) {
                        if (tst_cols[i] >= tst_st_yyyymm && tst_cols[i] <= tst_ed_yyyymm) {
                            tst_labels.push(hmsUtil.getDateToKor(tst_cols[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= tst_st_yyyymm && Number(key.replace(/"/gi, '')) <= tst_ed_yyyymm) {
                                    if (tst_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        tst_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        tst_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(tst_dataSets, function (k, v) {
                        tst_chartData.push(v);
                    });

                    let datasets = {
                        label: '인구수',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: tst_chartData
                    };

                    chartConfig.bar.options.title.text = "수요분석 - 거래량 세로막대 차트";
                    chartConfig.bar.data.labels = tst_labels;
                    chartConfig.bar.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.TRNSTN_SITUTN_PRICE.CODE_STYLE) {
                    let tsp_st_yyyymm = $('#tsp_syear').val() + $('#tsp_smonth').val();
                    let tsp_ed_yyyymm = $('#tsp_eyear').val() + $('#tsp_emonth').val();

                    let tsp_labels = [];
                    let tsp_dataSets = {};
                    let tsp_chartData = [];

                    let tsp_cols = hmsUtil.getTermArr(FUNC.TRNSTN_SITUTN_PRICE.TIME_START, FUNC.TRNSTN_SITUTN_PRICE.TIME_END, FUNC.TRNSTN_SITUTN_PRICE.TIME_STEP);
                    for (let i = 0; i < tsp_cols.length; i++) {
                        if (tsp_cols[i] >= tsp_st_yyyymm && tsp_cols[i] <= tsp_ed_yyyymm) {
                            tsp_labels.push(hmsUtil.getDateToKor(tsp_cols[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= tsp_st_yyyymm && Number(key.replace(/"/gi, '')) <= tsp_ed_yyyymm) {
                                    if (tsp_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        tsp_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        tsp_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(tsp_dataSets, function (k, v) {
                        tsp_chartData.push((v / gridData.length).toFixed(0));
                    });

                    let datasets = {
                        label: '거래가 평균',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: tsp_chartData
                    };

                    chartConfig.bar.options.title.text = "수요분석 - 가격 세로막대 차트";
                    chartConfig.bar.data.labels = tsp_labels;
                    chartConfig.bar.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.IDNFTN_BLDNG.CODE_STYLE) {
                    let ib_st_yyyymm = $('#ib_syear').val() + $('#ib_smonth').val();
                    let ib_ed_yyyymm = $('#ib_eyear').val() + $('#ib_emonth').val();

                    let ib_labels = [];
                    let ib_dataSets = {};
                    let ib_chartData = [];

                    let ib_cols = hmsUtil.getTermArr(FUNC.IDNFTN_BLDNG.TIME_START, FUNC.IDNFTN_BLDNG.TIME_END, FUNC.IDNFTN_BLDNG.TIME_STEP);
                    for (let i = 0; i < ib_cols.length; i++) {
                        if (ib_cols[i] >= ib_st_yyyymm && ib_cols[i] <= ib_ed_yyyymm) {
                            ib_labels.push(hmsUtil.getDateToKor(ib_cols[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= ib_st_yyyymm && Number(key.replace(/"/gi, '')) <= ib_ed_yyyymm) {
                                    if (ib_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        ib_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        ib_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(ib_dataSets, function (k, v) {
                        ib_chartData.push(v);
                    });

                    let datasets = {
                        label: '물량 총합',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: ib_chartData
                    };

                    chartConfig.bar.options.title.text = "입주물량 세로 차트";
                    chartConfig.bar.data.labels = ib_labels;
                    chartConfig.bar.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.BUSINS_SITUTN.CODE_STYLE) {
                    var bs_labels = [];
                    var bs_dataSets = {};
                    var bs_chartData = [];

                    var include = function (arr, obj) {
                        for (var i = 0, len = arr.length; i < len; i++) {
                            if (arr[i] === obj) {
                                return true;
                            }
                        }
                        return false;
                    };

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key === 'busins_narrow_cd'){
                                if (!include(bs_labels, value)) {
                                   bs_labels.push(value);
                                }
                            }
                        });
                    });

                    var category = '';
                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key === 'busins_narrow_cd'){
                                category = value;
                                if (!include(bs_labels, value)) {
                                   bs_labels.push(value);
                                }
                            }

                            if (key === 'busins_cnt'){
                                if (bs_dataSets[category] === undefined) {
                                    bs_dataSets[category] = value;
                                } else {
                                    bs_dataSets[category] += value;
                                }
                            }
                        });
                    });

                    $.each(bs_dataSets, function (k, v) {
                        bs_chartData.push(v);
                    });

                    var datasets = {
                        label: '자영업현황',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: bs_chartData
                    };

                    chartConfig.bar.options.title.text = "자영업현황 세로막대 차트";
                    chartConfig.bar.data.labels = bs_labels;
                    chartConfig.bar.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.HSHOLD_IMGRAT.CODE_STYLE) {
                    let hm_st_yyyymm = $('#hi_syear').val() + $('#hi_smonth').val();
                    let hm_ed_yyyymm = $('#hi_eyear').val() + $('#hi_emonth').val();

                    let hm_labels = [];
                    let hm_dataSets = {};
                    let hm_chartData = [];

                    let hm_cols = hmsUtil.getTermArr(FUNC.HSHOLD_IMGRAT.TIME_START, FUNC.HSHOLD_IMGRAT.TIME_END, FUNC.HSHOLD_IMGRAT.TIME_STEP);
                    for (let i = 0; i < hm_cols.length; i++) {
                        if (hm_cols[i] >= hm_st_yyyymm && hm_cols[i] <= hm_ed_yyyymm) {
                            hm_labels.push(hm_cols[i]);
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= hm_st_yyyymm && Number(key.replace(/"/gi, '')) <= hm_ed_yyyymm) {
                                    if (hm_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        hm_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        hm_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(hm_dataSets, function (k, v) {
                        hm_chartData.push(v);
                    });

                    let datasets = {
                        label: '세대수',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: hm_chartData
                    };

                    chartConfig.bar.options.title.text = "세대통계 세로막대 차트";
                    chartConfig.bar.data.labels = hm_labels;
                    chartConfig.bar.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.SUPPLY_PRESENT.CODE_STYLE) {
                    let sp_st_yyyymm = $('#sp_syear').val() + $('#sp_smonth').val();
                    let sp_ed_yyyymm = $('#sp_eyear').val() + $('#sp_emonth').val();

                    let sp_labels = [];
                    let sp_dataSets = {};
                    let sp_chartData = [];

                    let sp_cols = hmsUtil.getTermArr(FUNC.SUPPLY_PRESENT.TIME_START, FUNC.SUPPLY_PRESENT.TIME_END, FUNC.SUPPLY_PRESENT.TIME_STEP);
                    for (let i = 0; i < sp_cols.length; i++) {
                        if (sp_cols[i] >= sp_st_yyyymm && sp_cols[i] <= sp_ed_yyyymm) {
                            sp_labels.push(sp_cols[i]);
                        }
                    }

                    let param = $('#frm-west-8').serializeArray();
                    let paramLength = param.length;
                    let spType = '';
                    for (let i = 0; i < paramLength; i++) {
                        if (param[i].name === 'sp_type') {
                            spType = param[i].value;
                            break;
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= sp_st_yyyymm && Number(key.replace(/"/gi, '')) <= sp_ed_yyyymm) {
                                    if (sp_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        sp_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        sp_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    let label = '';
                    if (spType === '1'){
                        label = '공급세대수'
                    } else {
                        label = '평균평당가'
                    }

                    $.each(sp_dataSets, function (k, v) {
                        if (spType === '1'){
                            sp_chartData.push(v.toFixed(0));
                        } else {
                            sp_chartData.push((v / gridData.length).toFixed(0));
                        }
                    });

                    let datasets = {
                        label: label,
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: sp_chartData
                    };

                    chartConfig.bar.options.title.text = "분양현황 세로막대 차트";
                    chartConfig.bar.data.labels = sp_labels;
                    chartConfig.bar.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.INCOME_SITUTN.CODE_STYLE) {
                    console.log('?????');
//                    let is_st_yyyymm = $('#is_syear').val() + $('#is_smonth').val();
//                    let is_ed_yyyymm = $('#is_eyear').val() + $('#is_emonth').val();

                    let is_labels = [];
                    let is_dataSets = {};
                    let is_chartData = [];

//                    let is_cols = hmsUtil.getTermArr(FUNC.INCOME_SITUTN.TIME_START, FUNC.INCOME_SITUTN.TIME_END, FUNC.INCOME_SITUTN.TIME_STEP);
//                    for (let i = 0; i < is_cols.length; i++) {
//                        if (is_cols[i] >= is_st_yyyymm && is_cols[i] <= is_ed_yyyymm) {
//                            is_labels.push(is_cols[i]);
//                        }
//                    }

                    let param = $('#frm-west-9').serializeArray();
                    let paramLength = param.length;
                    let isType = '';
                    for (let i = 0; i < paramLength; i++) {
                        if (param[i].name === 'is_type') {
                            isType = param[i].value;
                            break;
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
//                                if (Number(key.replace(/"/gi, '')) >= is_st_yyyymm && Number(key.replace(/"/gi, '')) <= is_ed_yyyymm) {
                                    if (is_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        is_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        is_dataSets[key.replace(/"/gi, '')] += value;
                                    }
//                                }
                            }
                        });
                    });

                    let label = '';
                    if (isType === '1'){
                        label = '공급세대수'
                    } else {
                        label = '평균평당가'
                    }

                    $.each(is_dataSets, function (k, v) {
                        if (isType === '1'){
                            is_chartData.push(v.toFixed(0));
                        } else {
                            is_chartData.push((v / gridData.length).toFixed(0));
                        }
                    });

                    let datasets = {
                        label: label,
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: is_chartData
                    };

                    chartConfig.bar.options.title.text = "소득현황 세로막대 차트";
                    chartConfig.bar.data.labels = is_labels;
                    chartConfig.bar.data.datasets.push(datasets);
                }
            }
        }
        canAppened.bar = false;
        return true;
    }

//    {# 세로막대 차트 #}

//    {# 가로막대 차트 #}
    function dataParseForHorizontalBar() {
        if (gridData.length === 0) {
            alert("데이터 검색을 먼저해주세요.");
            return false
        } else {
            if (canAppened.horizontalBar) {
                chartConfig.horizontalBar.options.title.text = '';
                chartConfig.horizontalBar.data.labels = [];
                chartConfig.horizontalBar.data.datasets = [];

                if (codeStyle === 'popltn_stats') {
                    var ps_st_yyyymm = $('#ps_syear').val() + $('#ps_smonth').val();
                    var ps_ed_yyyymm = $('#ps_eyear').val() + $('#ps_emonth').val();

                    var data = hmsUtil.getTermArr(FUNC.POPLTN_STATS.TIME_START, FUNC.POPLTN_STATS.TIME_END, FUNC.POPLTN_STATS.TIME_STEP);

                    var labels = [];
                    var ps_dataSets = {};

                    var myData = [];
                    for (var i = 0; i < data.length; i++) {
                        if (data[i] >= ps_st_yyyymm && data[i] <= ps_ed_yyyymm) {
                            labels.push(hmsUtil.getDateToKor(data[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= ps_st_yyyymm && Number(key.replace(/"/gi, '')) <= ps_ed_yyyymm) {
                                    if (ps_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        ps_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        ps_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(ps_dataSets, function (k, v) {
                        myData.push(v);
                    });

                    var datasets = {
                        label: '인구수',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: myData
                    };

                    chartConfig.horizontalBar.options.title.text = "인구통계 가로막대 차트";
                    chartConfig.horizontalBar.data.labels = labels;
                    chartConfig.horizontalBar.data.datasets.push(datasets);
                }

                if (codeStyle === 'hshold_stats') {
                    var st_yyyy = $('#hs_syear').val();
                    var ed_yyyy = $('#hs_eyear').val();

                    var hs_cols = hmsUtil.getTermArr(FUNC.HSHOLD_STATS.TIME_START, FUNC.HSHOLD_STATS.TIME_END, FUNC.HSHOLD_STATS.TIME_STEP);;
                    var hs_labels = [];
                    var hs_dataSets = {};
                    var hs_chartData = [];

                    for (var i = 0; i < hs_cols.length; i++) {
                        if (hs_cols[i] >= st_yyyy && hs_cols[i] <= ed_yyyy) {
                            hs_labels.push(hmsUtil.getDateToKor(hs_cols[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= st_yyyy && Number(key.replace(/"/gi, '')) <= ed_yyyy) {
                                    if (hs_dataSets[key.replace(/"/gi, '')] === undefined) {

                                        hs_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        hs_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(hs_dataSets, function (k, v) {
                        hs_chartData.push(v);
                    });

                    var datasets = {
                        label: '인구수',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: hs_chartData
                    };

                    chartConfig.horizontalBar.options.title.text = "인구주택총조사 가로막대 차트";
                    chartConfig.horizontalBar.data.labels = hs_labels;
                    chartConfig.horizontalBar.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.TRNSTN_SITUTN_TRANS.CODE_STYLE) {
                    let tst_st_yyyymm = $('#tst_syear').val() + $('#tst_smonth').val();
                    let tst_ed_yyyymm = $('#tst_eyear').val() + $('#tst_emonth').val();

                    let tst_labels = [];
                    let tst_dataSets = {};
                    let tst_chartData = [];

                    let tst_cols = hmsUtil.getTermArr(FUNC.TRNSTN_SITUTN_TRANS.TIME_START, FUNC.TRNSTN_SITUTN_TRANS.TIME_END, FUNC.TRNSTN_SITUTN_TRANS.TIME_STEP);
                    for (let i = 0; i < tst_cols.length; i++) {
                        if (tst_cols[i] >= tst_st_yyyymm && tst_cols[i] <= tst_ed_yyyymm) {
                            tst_labels.push(hmsUtil.getDateToKor(tst_cols[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= tst_st_yyyymm && Number(key.replace(/"/gi, '')) <= tst_ed_yyyymm) {
                                    if (tst_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        tst_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        tst_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(tst_dataSets, function (k, v) {
                        tst_chartData.push(v);
                    });

                    let datasets = {
                        label: '인구수',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: tst_chartData
                    };

                    chartConfig.horizontalBar.options.title.text = "수요분석 - 거래량 가로막대 차트";
                    chartConfig.horizontalBar.data.labels = tst_labels;
                    chartConfig.horizontalBar.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.TRNSTN_SITUTN_PRICE.CODE_STYLE) {
                    let tsp_st_yyyymm = $('#tsp_syear').val() + $('#tsp_smonth').val();
                    let tsp_ed_yyyymm = $('#tsp_eyear').val() + $('#tsp_emonth').val();

                    let tsp_labels = [];
                    let tsp_dataSets = {};
                    let tsp_chartData = [];

                    let tsp_cols = hmsUtil.getTermArr(FUNC.TRNSTN_SITUTN_PRICE.TIME_START, FUNC.TRNSTN_SITUTN_PRICE.TIME_END, FUNC.TRNSTN_SITUTN_PRICE.TIME_STEP);
                    for (let i = 0; i < tsp_cols.length; i++) {
                        if (tsp_cols[i] >= tsp_st_yyyymm && tsp_cols[i] <= tsp_ed_yyyymm) {
                            tsp_labels.push(hmsUtil.getDateToKor(tsp_cols[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= tsp_st_yyyymm && Number(key.replace(/"/gi, '')) <= tsp_ed_yyyymm) {
                                    if (tsp_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        tsp_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        tsp_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(tsp_dataSets, function (k, v) {
                        tsp_chartData.push((v / gridData.length).toFixed(0));
                    });

                    let datasets = {
                        label: '거래가 평균',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: tsp_chartData
                    };

                    chartConfig.horizontalBar.options.title.text = "수요분석 - 가격 가로막대 차트";
                    chartConfig.horizontalBar.data.labels = tsp_labels;
                    chartConfig.horizontalBar.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.IDNFTN_BLDNG.CODE_STYLE) {
                    let ib_st_yyyymm = $('#ib_syear').val() + $('#ib_smonth').val();
                    let ib_ed_yyyymm = $('#ib_eyear').val() + $('#ib_emonth').val();

                    let ib_labels = [];
                    let ib_dataSets = {};
                    let ib_chartData = [];

                    let ib_cols = hmsUtil.getTermArr(FUNC.IDNFTN_BLDNG.TIME_START, FUNC.IDNFTN_BLDNG.TIME_END, FUNC.IDNFTN_BLDNG.TIME_STEP);
                    for (let i = 0; i < ib_cols.length; i++) {
                        if (ib_cols[i] >= ib_st_yyyymm && ib_cols[i] <= ib_ed_yyyymm) {
                            ib_labels.push(hmsUtil.getDateToKor(ib_cols[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= ib_st_yyyymm && Number(key.replace(/"/gi, '')) <= ib_ed_yyyymm) {
                                    if (ib_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        ib_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        ib_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(ib_dataSets, function (k, v) {
                        ib_chartData.push(v);
                    });

                    let datasets = {
                        label: '물량 총합',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: ib_chartData
                    };

                    chartConfig.horizontalBar.options.title.text = "입주물량 가로막대 차트";
                    chartConfig.horizontalBar.data.labels = ib_labels;
                    chartConfig.horizontalBar.data.datasets.push(datasets);
                }

                if (codeStyle === 'busins_situtn') {
                    var st_yyyy = $('#st_year').val();
                    var ed_yyyy = $('#ed_year').val();

                    var bs_labels = [];
                    var bs_dataSets = {};
                    var bs_chartData = [];

                    var include = function (arr, obj) {
                        for (var i = 0, len = arr.length; i < len; i++) {
                            if (arr[i] == obj) {
                                return true;
                            }
                        }
                        return false;
                    };


                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key == 'busins_narrow_cd'){
                                if (!include(bs_labels, value)) {
                                   bs_labels.push(value);
                                }
                            }
                        });
                    });

                    var category = '';
                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key == 'busins_narrow_cd'){
                                category = value;
                                if (!include(bs_labels, value)) {
                                   bs_labels.push(value);
                                }
                            }

                            if (key == 'busins_cnt'){
                                if (bs_dataSets[category] === undefined) {
                                    bs_dataSets[category] = value;
                                } else {
                                    bs_dataSets[category] += value;
                                }
                            }
                        });
                    });

                    $.each(bs_dataSets, function (k, v) {
                        bs_chartData.push(v);
                    });

                    var datasets = {
                        label: '업종현황',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: bs_chartData
                    };

                    chartConfig.horizontalBar.options.title.text = "업종현황 가로막대 차트";
                    chartConfig.horizontalBar.data.labels = bs_labels;
                    chartConfig.horizontalBar.data.datasets.push(datasets);
                }
                if (codeStyle === FUNC.HSHOLD_IMGRAT.CODE_STYLE) {
                    let hm_st_yyyymm = $('#hi_syear').val() + $('#hi_smonth').val();
                    let hm_ed_yyyymm = $('#hi_eyear').val() + $('#hi_emonth').val();

                    let hm_labels = [];
                    let hm_dataSets = {};
                    let hm_chartData = [];

                    let hm_cols = hmsUtil.getTermArr(FUNC.HSHOLD_IMGRAT.TIME_START, FUNC.HSHOLD_IMGRAT.TIME_END, FUNC.HSHOLD_IMGRAT.TIME_STEP);
                    for (let i = 0; i < hm_cols.length; i++) {
                        if (hm_cols[i] >= hm_st_yyyymm && hm_cols[i] <= hm_ed_yyyymm) {
                            hm_labels.push(hm_cols[i]);
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= hm_st_yyyymm && Number(key.replace(/"/gi, '')) <= hm_ed_yyyymm) {
                                    if (hm_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        hm_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        hm_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(hm_dataSets, function (k, v) {
                        hm_chartData.push(v);
                    });

                    let datasets = {
                        label: '세대수',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: hm_chartData
                    };

                    chartConfig.horizontalBar.options.title.text = "세대통계 가로막대 차트";
                    chartConfig.horizontalBar.data.labels = hm_labels;
                    chartConfig.horizontalBar.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.SUPPLY_PRESENT.CODE_STYLE) {
                    let sp_st_yyyymm = $('#sp_syear').val() + $('#sp_smonth').val();
                    let sp_ed_yyyymm = $('#sp_eyear').val() + $('#sp_emonth').val();

                    let sp_labels = [];
                    let sp_dataSets = {};
                    let sp_chartData = [];

                    let sp_cols = hmsUtil.getTermArr(FUNC.SUPPLY_PRESENT.TIME_START, FUNC.SUPPLY_PRESENT.TIME_END, FUNC.SUPPLY_PRESENT.TIME_STEP);
                    for (let i = 0; i < sp_cols.length; i++) {
                        if (sp_cols[i] >= sp_st_yyyymm && sp_cols[i] <= sp_ed_yyyymm) {
                            sp_labels.push(sp_cols[i]);
                        }
                    }

                    let param = $('#frm-west-8').serializeArray();
                    let paramLength = param.length;
                    let spType = '';
                    for (let i = 0; i < paramLength; i++) {
                        if (param[i].name === 'sp_type') {
                            spType = param[i].value;
                            break;
                        }
                    }

                    console.log(spType);

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= sp_st_yyyymm && Number(key.replace(/"/gi, '')) <= sp_ed_yyyymm) {
                                    if (sp_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        sp_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        sp_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    let label = '';
                    if (spType === '1'){
                        label = '공급세대수'
                    } else {
                        label = '평균평당가'
                    }

                    $.each(sp_dataSets, function (k, v) {
                        if (spType === '1'){
                            sp_chartData.push(v);
                        } else {
                            sp_chartData.push((v / gridData.length).toFixed(0));
                        }
                    });

                    let datasets = {
                        label: label,
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: sp_chartData
                    };

                    chartConfig.horizontalBar.options.title.text = "분양현황 가로막대 차트";
                    chartConfig.horizontalBar.data.labels = sp_labels;
                    chartConfig.horizontalBar.data.datasets.push(datasets);
                }
            }

            canAppened.horizontalBar = false;
            return true
        }
    }
//    {# 가로막대 차트 #}

//    {# 영역 차트 #}
    function dataParseForArea() {
        if (gridData.length === 0) {
            alert("데이터 검색을 먼저해주세요.");
            return false;
        } else {
            return true;
        }
    }

//    {# 영역 차트 #}

//    {# 라인 차트 #}
    function dataParseForLine() {
        if (gridData.length === 0) {
            alert("데이터 검색을 먼저해주세요.");
            return false;
        } else {
            if (canAppened.line) {
                chartConfig.line.options.title = {};
                chartConfig.line.options.scales.xAxes.scaleLabel = {};
                chartConfig.line.options.scales.yAxes.scaleLabel = {};
                chartConfig.line.data.labels = [];
                chartConfig.line.data.datasets = [];

                if (codeStyle === FUNC.POPLTN_STATS.CODE_STYLE) {
                    var ps_st_yyyymm = $('#ps_syear').val() + $('#ps_smonth').val();
                    var ps_ed_yyyymm = $('#ps_eyear').val() + $('#ps_emonth').val();

                    var ps_cols = hmsUtil.getTermArr(FUNC.POPLTN_STATS.TIME_START, FUNC.POPLTN_STATS.TIME_END, FUNC.POPLTN_STATS.TIME_STEP);

                    var ps_labels = [];
                    var ps_dataSets = {};
                    var ps_chartData = [];

                    for (var i = 0; i < ps_cols.length; i++) {
                        if (ps_cols[i] >= ps_st_yyyymm && ps_cols[i] <= ps_ed_yyyymm) {
                            ps_labels.push(hmsUtil.getDateToKor(ps_cols[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= ps_st_yyyymm && Number(key.replace(/"/gi, '')) <= ps_ed_yyyymm) {
                                    if (ps_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        ps_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        ps_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(ps_dataSets, function (k, v) {
                        ps_chartData.push(v);
                    });

                    var datasets = {
                        label: '인구수',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: ps_chartData
                    };

                    chartConfig.line.options.title = "인구통계 라인 차트";
                    chartConfig.line.options.scales.xAxes.scaleLabel = 'Year';
                    chartConfig.line.options.scales.yAxes.scaleLabel = '세대수';
                    chartConfig.line.data.labels = ps_labels;
                    chartConfig.line.data.datasets.push(datasets);
                }
                if (codeStyle === FUNC.HSHOLD_STATS.CODE_STYLE) {
                    var st_yyyy = $('#hs_syear').val();
                    var ed_yyyy = $('#hs_eyear').val();

                    var hs_cols = hmsUtil.getTermArr(FUNC.HSHOLD_STATS.TIME_START, FUNC.HSHOLD_STATS.TIME_END, FUNC.HSHOLD_STATS.TIME_STEP);
                    var hs_labels = [];
                    var hs_dataSets = {};
                    var hs_chartData = [];

                    for (var i = 0; i < hs_cols.length; i++) {
                        if (hs_cols[i] >= st_yyyy && hs_cols[i] <= ed_yyyy) {
                            hs_labels.push(hs_cols[i]);
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= st_yyyy && Number(key.replace(/"/gi, '')) <= ed_yyyy) {
                                    if (hs_dataSets[key.replace(/"/gi, '')] === undefined) {

                                        hs_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        hs_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(hs_dataSets, function (k, v) {
                        hs_chartData.push(v);
                    });

                    var datasets = {
                        label: '인구수',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: hs_chartData
                    };

                    chartConfig.line.options.title = "인구주택총조사 라인 차트";
                    chartConfig.line.options.scales.xAxes.scaleLabel = 'Year';
                    chartConfig.line.options.scales.yAxes.scaleLabel = '세대수';
                    chartConfig.line.data.labels = hs_labels;
                    chartConfig.line.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.TRNSTN_SITUTN_PRICE.CODE_STYLE) {
                    let tsp_st_yyyymm = $('#tsp_syear').val() + $('#tsp_smonth').val();
                    let tsp_ed_yyyymm = $('#tsp_eyear').val() + $('#tsp_emonth').val();

                    let tsp_labels = [];
                    let tsp_dataSets = {};
                    let tsp_chartData = [];

                    let tsp_cols = hmsUtil.getTermArr(FUNC.TRNSTN_SITUTN_PRICE.TIME_START, FUNC.TRNSTN_SITUTN_PRICE.TIME_END, FUNC.TRNSTN_SITUTN_PRICE.TIME_STEP);
                    for (let i = 0; i < tsp_cols.length; i++) {
                        if (tsp_cols[i] >= tsp_st_yyyymm && tsp_cols[i] <= tsp_ed_yyyymm) {
                            tsp_labels.push(hmsUtil.getDateToKor(tsp_cols[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= tsp_st_yyyymm && Number(key.replace(/"/gi, '')) <= tsp_ed_yyyymm) {
                                    if (tsp_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        tsp_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        tsp_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(tsp_dataSets, function (k, v) {
                        tsp_chartData.push((v / gridData.length).toFixed(0));
                    });

                    let datasets = {
                        label: '거래가 평균',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: tsp_chartData
                    };


                    chartConfig.line.options.title = "수요분석 - 가격 라인 차트";
                    chartConfig.line.options.scales.xAxes.scaleLabel = 'Year';
                    chartConfig.line.options.scales.yAxes.scaleLabel = '평균가';
                    chartConfig.line.data.labels = tsp_labels;
                    chartConfig.line.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.IDNFTN_BLDNG.CODE_STYLE) {
                    let ib_st_yyyymm = $('#ib_syear').val() + $('#ib_smonth').val();
                    let ib_ed_yyyymm = $('#ib_eyear').val() + $('#ib_emonth').val();

                    let ib_labels = [];
                    let ib_dataSets = {};
                    let ib_chartData = [];

                    let ib_cols = hmsUtil.getTermArr(FUNC.IDNFTN_BLDNG.TIME_START, FUNC.IDNFTN_BLDNG.TIME_END, FUNC.IDNFTN_BLDNG.TIME_STEP);
                    for (let i = 0; i < ib_cols.length; i++) {
                        if (ib_cols[i] >= ib_st_yyyymm && ib_cols[i] <= ib_ed_yyyymm) {
                            ib_labels.push(hmsUtil.getDateToKor(ib_cols[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= ib_st_yyyymm && Number(key.replace(/"/gi, '')) <= ib_ed_yyyymm) {
                                    if (ib_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        ib_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        ib_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(ib_dataSets, function (k, v) {
                        ib_chartData.push(v);
                    });

                    let datasets = {
                        label: '물량 총합',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: ib_chartData
                    };

                    chartConfig.line.options.title = "입주물량 라인 차트";
                    chartConfig.line.options.scales.xAxes.scaleLabel = 'Year';
                    chartConfig.line.options.scales.yAxes.scaleLabel = '총합';
                    chartConfig.line.data.labels = ib_labels;
                    chartConfig.line.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.BUSINS_SITUTN.CODE_STYLE) {
                    var st_yyyy = $('#st_year').val();
                    var ed_yyyy = $('#ed_year').val();

                    var bs_labels = [];
                    var bs_dataSets = {};
                    var bs_chartData = [];

                    var include = function (arr, obj) {
                        for (var i = 0, len = arr.length; i < len; i++) {
                            if (arr[i] === obj) {
                                return true;
                            }
                        }
                        return false;
                    };


                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key === 'busins_narrow_cd'){
                                if (!include(bs_labels, value)) {
                                   bs_labels.push(value);
                                }
                            }
                        });
                    });

                    var category = '';
                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key === 'busins_narrow_cd') {
                                category = value;
                                if (!include(bs_labels, value)) {
                                    bs_labels.push(value);
                                }
                            }

                            if (key === 'busins_cnt') {
                                if (bs_dataSets[category] === undefined) {
                                    bs_dataSets[category] = value;
                                } else {
                                    bs_dataSets[category] += value;
                                }
                            }
                        });
                    });

                    $.each(bs_dataSets, function (k, v) {
                        bs_chartData.push(v);
                    });

                    var datasets = {
                        label: '업종현황',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: bs_chartData
                    };

                    chartConfig.line.options.title = "업종현황 라인 차트";
                    chartConfig.line.options.scales.xAxes.scaleLabel = '업종';
                    chartConfig.line.options.scales.yAxes.scaleLabel = '업종수';
                    chartConfig.line.data.labels = bs_labels;
                    chartConfig.line.data.datasets.push(datasets);
                }
                if (codeStyle === FUNC.TRNSTN_SITUTN_TRANS.CODE_STYLE) {
                    let tst_st_yyyymm = $('#tst_syear').val() + $('#tst_smonth').val();
                    let tst_ed_yyyymm = $('#tst_eyear').val() + $('#tst_emonth').val();

                    let tst_labels = [];
                    let tst_dataSets = {};
                    let tst_chartData = [];

                    let tst_cols = hmsUtil.getTermArr(FUNC.TRNSTN_SITUTN_TRANS.TIME_START, FUNC.TRNSTN_SITUTN_TRANS.TIME_END, FUNC.TRNSTN_SITUTN_TRANS.TIME_STEP);
                    for (let i = 0; i < tst_cols.length; i++) {
                        if (tst_cols[i] >= tst_st_yyyymm && tst_cols[i] <= tst_ed_yyyymm) {
                            tst_labels.push(hmsUtil.getDateToKor(tst_cols[i]));
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= tst_st_yyyymm && Number(key.replace(/"/gi, '')) <= tst_ed_yyyymm) {
                                    if (tst_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        tst_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        tst_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(tst_dataSets, function (k, v) {
                        tst_chartData.push(v);
                    });

                    let datasets = {
                        label: '인구수',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: tst_chartData
                    };

                    chartConfig.line.options.title.text = "수요분석 - 거래량 라인 차트";
                    chartConfig.line.options.scales.xAxes.scaleLabel = '월별';
                    chartConfig.line.options.scales.yAxes.scaleLabel = '거래량';
                    chartConfig.line.data.labels = tst_labels;
                    chartConfig.line.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.HSHOLD_IMGRAT.CODE_STYLE) {
                    let hm_st_yyyymm = $('#hi_syear').val() + $('#hi_smonth').val();
                    let hm_ed_yyyymm = $('#hi_eyear').val() + $('#hi_emonth').val();

                    let hm_labels = [];
                    let hm_dataSets = {};
                    let hm_chartData = [];

                    let hm_cols = hmsUtil.getTermArr(FUNC.HSHOLD_IMGRAT.TIME_START, FUNC.HSHOLD_IMGRAT.TIME_END, FUNC.HSHOLD_IMGRAT.TIME_STEP);
                    for (let i = 0; i < hm_cols.length; i++) {
                        if (hm_cols[i] >= hm_st_yyyymm && hm_cols[i] <= hm_ed_yyyymm) {
                            hm_labels.push(hm_cols[i]);
                        }
                    }

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= hm_st_yyyymm && Number(key.replace(/"/gi, '')) <= hm_ed_yyyymm) {
                                    if (hm_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        hm_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        hm_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    $.each(hm_dataSets, function (k, v) {
                        hm_chartData.push(v);
                    });

                    let datasets = {
                        label: '세대수',
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: hm_chartData
                    };

                    chartConfig.line.options.title.text = "세대통계 라인 차트";
                    chartConfig.line.options.scales.xAxes.scaleLabel = '월별';
                    chartConfig.line.options.scales.yAxes.scaleLabel = '세대수';
                    chartConfig.line.data.labels = hm_labels;
                    chartConfig.line.data.datasets.push(datasets);
                }

                if (codeStyle === FUNC.SUPPLY_PRESENT.CODE_STYLE) {
                    let sp_st_yyyymm = $('#sp_syear').val() + $('#sp_smonth').val();
                    let sp_ed_yyyymm = $('#sp_eyear').val() + $('#sp_emonth').val();

                    let sp_labels = [];
                    let sp_dataSets = {};
                    let sp_chartData = [];

                    let sp_cols = hmsUtil.getTermArr(FUNC.SUPPLY_PRESENT.TIME_START, FUNC.SUPPLY_PRESENT.TIME_END, FUNC.SUPPLY_PRESENT.TIME_STEP);
                    for (let i = 0; i < sp_cols.length; i++) {
                        if (sp_cols[i] >= sp_st_yyyymm && sp_cols[i] <= sp_ed_yyyymm) {
                            sp_labels.push(sp_cols[i]);
                        }
                    }

                    let param = $('#frm-west-8').serializeArray();
                    let paramLength = param.length;
                    let spType = '';
                    for (let i = 0; i < paramLength; i++) {
                        if (param[i].name === 'sp_type') {
                            spType = param[i].value;
                            break;
                        }
                    }

                    console.log(spType);

                    $.each(gridData, function (k, v) {
                        $.each(v, function (key, value) {
                            if (key.charAt(0) === '"') {
                                if (Number(key.replace(/"/gi, '')) >= sp_st_yyyymm && Number(key.replace(/"/gi, '')) <= sp_ed_yyyymm) {
                                    if (sp_dataSets[key.replace(/"/gi, '')] === undefined) {
                                        sp_dataSets[key.replace(/"/gi, '')] = value;
                                    } else {
                                        sp_dataSets[key.replace(/"/gi, '')] += value;
                                    }
                                }
                            }
                        });
                    });

                    let label = '';
                    if (spType === '1'){
                        label = '공급세대수'
                    } else {
                        label = '평균평당가'
                    }

                    $.each(sp_dataSets, function (k, v) {
                        if (spType === '1'){
                            sp_chartData.push(v);
                        } else {
                            sp_chartData.push((v / gridData.length).toFixed(0));
                        }
                    });

                    let datasets = {
                        label: label,
                        backgroundColor: hmsUtil.getRandomHexColor(),
                        data: sp_chartData
                    };

                    chartConfig.line.options.title.text = "분양현황 가로막대 차트";
//                    chartConfig.line.options.scales.xAxes.scaleLabel = '월별';
//                    chartConfig.line.options.scales.yAxes.scaleLabel = '세대수';
                    chartConfig.line.data.labels = sp_labels;
                    chartConfig.line.data.datasets.push(datasets);
                }
            }
        }

        canAppened.line = false;
        return true;
    }

//    {# 라인 차트 #}

//    {# 파이 차트 #}
    function dataParseForPie() {
        var label = [];
        var data = [];
        var backgroundColor = [];

        if (gridData.length === 0) {
            alert("데이터 검색을 먼저해주세요.");
            return false;
        } else {
            if (canAppened.pie) {
            }
        }
        return true;
    }

//    {# 파이 차트 #}

    function setAppendedAll(bool) {
        canAppened.radar = bool;
        canAppened.bar = bool;
        canAppened.horizontalBar = bool;
        canAppened.area = bool;
        canAppened.line = bool;
        canAppened.pie = bool;
    }

    function set_marker_images(){

        var el = document.getElementById("div-markerImg-area");
        var ququ = [];
        $.ajax({
            url: '{{ url_for("util.get_marker_img_list") }}',
            method: 'POST',
            dataType: 'json',
        }).done(function (data) {
            var htmlText = '';

            $.each(data, function(i, item){
                htmlText += "<a href=\"javascript:setMarkerImage('" + item + "');\">" +
                        "<img width='50px' height='50px' src='" +
                        "/static/images/marker/icon_64/" + item +
                        "'></a>";
            });

            el.innerHTML = htmlText;
        });
    }

</script>

<div id="mdl-markerImg-area" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mdl-markerImg-area-label">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-markerImg-area-label">마커 이미지 선택</h4>
            </div>
            <div id="div-markerImg-area" class="modal-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>

<div id="mdl-viewMarker-area" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="mdl-viewMarker-area-label">
    <div class="modal-dialog modal-chart-area" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="mdl-viewMarker-area-label">마커 카테고리 선택</h4>
            </div>
            <div id="div-viewMarker-area" class="modal-body text-center">
                <form id="frm-viewMarker" class="form-horizontal">
                    <div class="form-group">
                        <select id="mdl-viewMarker-sp" name="category" class="selectpicker" multiple title="카테고리 선택"
                                data-size="10" data-actions-box="true">
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <div class="text-center">
                    <button id="btn-viewMarker-submit" type="button" class="btn btn-default" data-dismiss="modal">확인
                    </button>
                    <button id="btn-viewMarker-cancel" type="button" class="btn btn-default" data-dismiss="modal">닫기
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="ui-layout-center">
</div>
<div id="map" class="map"></div>
<div id="popup" class="ol-popup">
    <a href="#" id="popup-closer" class="ol-popup-closer"></a>
    <div id="popup-content"></div>
</div>

<div id="polygon-popup" class="ol-popup">
    <a href="#" id="polygon-popup-closer" class="ol-popup-closer"></a>
    <div id="polygon-popup-content"></div>
</div>

<div id="wiw-list-view" class="window ctl-list-window" style="display: none;">
    <div id="wiw-list-view-header" class="window-header">
        <span id="wiw-list-view-title">분양현황 검색 결과 리스트(기본형)</span>
        <button id="wiw-list-view-close" class="pull-right btn-sm btn-window-close">x</button>
    </div>
    <div id="wiw-lsit-view-body" class="window-body">
    </div>
</div>

<div id="wiw-card-view" class="window window-lg ctl-list-window" style="display: none;">
    <div id="wiw-card-view-header" class="window-header">
        <span id="wiw-card-view-close" id="wiw-card-view-title">분양현황 검색 결과 리스트(카드형)</span>
        <button class="pull-right btn-sm btn-window-close">x</button>
    </div>
    <div id="wiw-card-view-body" class="window-body window-body-card">
        <div class="row">
            <div class="col-md-1">
                <div class="arrow-left" style="margin: auto; margin-top: 125px"></div>
            </div>
            <div class="col-md-10">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card">
                            <p class="text-center"><strong>지제역 더샵 센토피아</strong></p>
                            <div style="">
                                <img class="card-img-top"
                                     src="{{url_for('static', filename='images/common/photo_not_found.png') }}"
                                     alt="Card image cap" width="200px" height="120px">
                            </div>
                            <div class="card-block">
                                <p class="card-text text-center">지하2층~지상27층, 16개동</p>
                                <hr>
                                <p class="card-text text-center">총 1,280세대</p>
                                <hr>
                                <p class="card-text text-center">17.07 / 19.09</p>
                                <hr>
                                <div class="card-table">
                                <table class="table text-center">
                                    <thead>
                                    <tr>
                                        <th class="text-center">전용면적</th>
                                        <th class="text-center">분양가</th>
                                        <th class="text-center">평당가</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    </tbody>
                                </table>
                                </div>
                                <hr>
                                <p class="card-text text-center">943-1, 495</p>
                                <hr>
                                <p class="card-text text-center">계약금정액제(1,000)만</p>
                                <p class="card-text text-center">발코니확장별도</p>
                                <hr>
                                <p class="card-text text-center">100%</p>
                                <hr>
                                <p class="card-text text-center">D+ 5개월</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <p class="text-center"><strong>지제역 더샵 센토피아</strong></p>
                            <div style="">
                                <img class="card-img-top"
                                     src="{{url_for('static', filename='images/common/photo_not_found.png') }}"
                                     alt="Card image cap" width="200px" height="120px">
                            </div>
                            <div class="card-block">
                                <p class="card-text text-center">지하2층~지상27층, 16개동</p>
                                <hr>
                                <p class="card-text text-center">총 1,280세대</p>
                                <hr>
                                <p class="card-text text-center">17.07 / 19.09</p>
                                <hr>
                                <div class="card-table">
                                <table class="table text-center">
                                    <thead>
                                    <tr>
                                        <th class="text-center">전용면적</th>
                                        <th class="text-center">분양가</th>
                                        <th class="text-center">평당가</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    </tbody>
                                </table>
                                </div>
                                <hr>
                                <p class="card-text text-center">943-1, 495</p>
                                <hr>
                                <p class="card-text text-center">계약금정액제(1,000)만</p>
                                <p class="card-text text-center">발코니확장별도</p>
                                <hr>
                                <p class="card-text text-center">100%</p>
                                <hr>
                                <p class="card-text text-center">D+ 5개월</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <p class="text-center"><strong>지제역 더샵 센토피아</strong></p>
                            <div style="">
                                <img class="card-img-top"
                                     src="{{url_for('static', filename='images/common/photo_not_found.png') }}"
                                     alt="Card image cap" width="200px" height="120px">
                            </div>
                            <div class="card-block">
                                <p class="card-text text-center">지하2층~지상27층, 16개동</p>
                                <hr>
                                <p class="card-text text-center">총 1,280세대</p>
                                <hr>
                                <p class="card-text text-center">17.07 / 19.09</p>
                                <hr>
                                <div class="card-table">
                                <table class="table text-center">
                                    <thead>
                                    <tr>
                                        <th class="text-center">전용면적</th>
                                        <th class="text-center">분양가</th>
                                        <th class="text-center">평당가</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    </tbody>
                                </table>
                                </div>
                                <hr>
                                <p class="card-text text-center">943-1, 495</p>
                                <hr>
                                <p class="card-text text-center">계약금정액제(1,000)만</p>
                                <p class="card-text text-center">발코니확장별도</p>
                                <hr>
                                <p class="card-text text-center">100%</p>
                                <hr>
                                <p class="card-text text-center">D+ 5개월</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <p class="text-center"><strong>지제역 더샵 센토피아</strong></p>
                            <div style="">
                                <img class="card-img-top"
                                     src="{{url_for('static', filename='images/common/photo_not_found.png') }}"
                                     alt="Card image cap" width="200px" height="120px">
                            </div>
                            <div class="card-block">
                                <p class="card-text text-center">지하2층~지상27층, 16개동</p>
                                <hr>
                                <p class="card-text text-center">총 1,280세대</p>
                                <hr>
                                <p class="card-text text-center">17.07 / 19.09</p>
                                <hr>
                                <div class="card-table">
                                <table class="table text-center">
                                    <thead>
                                    <tr>
                                        <th class="text-center">전용면적</th>
                                        <th class="text-center">분양가</th>
                                        <th class="text-center">평당가</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    <tr>
                                        <td>전용면적</td>
                                        <td>분양가</td>
                                        <td>평당가</td>
                                    </tr>
                                    </tbody>
                                </table>
                                </div>
                                <hr>
                                <p class="card-text text-center">943-1, 495</p>
                                <hr>
                                <p class="card-text text-center">계약금정액제(1,000)만</p>
                                <p class="card-text text-center">발코니확장별도</p>
                                <hr>
                                <p class="card-text text-center">100%</p>
                                <hr>
                                <p class="card-text text-center">D+ 5개월</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-1">
                <div class="arrow-right" style="margin: auto; margin-top: 125px"></div>
            </div>
        </div>
    </div>
</div>


<div id="userMarkerPopup" class="ol-popup">
    <div id="userMarkerPopupContent">
        <form id="frm-setMarker" class="form-horizontal">
            <label for="setMarkerCategory"><span class="label label-default">카테고리</span></label><br>
            <input class="form-control input-sm margin-bottom" id="setMarkerCategory" name="markerCategory" placeholder="카테고리를 입력하세요.">

            <label for="setMarkerTitle"><span class="label label-default">제목</span></label><br>
            <input class="form-control input-sm margin-bottom" id="setMarkerTitle" name="markerTitle" placeholder="제목을 입력하세요.">

            <label for="setMarkerContent"><span class="label label-default">내용</span></label><br>
            <textarea class="form-control input-sm margin-bottom" name="markerContent" rows="5" id="setMarkerContent" placeholder="내용을 입력하세요." style="resize :none;"></textarea>
        </form>
        <div class="text-center">
            <button id="userMarkerSubmit" type="button" class="btn btn-default btn-sm">확인</button>
            <button id="userMarkerCancel" type="button" class="btn btn-default btn-sm">취소</button>
        </div>
    </div>
</div>

<div id="viewMarkerPopup" class="ol-popup">
    <div id="viewMarkerPopupContent">
        <form id="frm-viewMarker-popup" class="form-horizontal">
            <!--<div class="form-group">-->
                <label for="viewMarkerCategory"><span class="label label-default">카테고리</span></label><br>
                <input class="form-control input-sm margin-bottom" id="viewMarkerCategory" name="markerCategory" placeholder="카테고리를 입력하세요. ">            <!--</div>-->
            <!--<div class="form-group">-->
                <label for="viewMarkerTitle"><span class="label label-default">제목</span></label><br>
                <input class="form-control input-sm margin-bottom" id="viewMarkerTitle" name="markerTitle"
                       placeholder="제목을 입력하세요.">
            <!--</div>-->
            <!--<div class="form-group">-->
                <label for="viewMarkerContent"><span class="label label-default">내용</span></label><br>
                <textarea class="form-control input-sm margin-bottom" id="viewMarkerContent" name="markerContent" rows="5"
                          placeholder="내용을 입력하세요."
                          style="resize :none;"></textarea>
            <!--</div>-->
            <div class="text-center">
                <button id="viewMarkerSubmit" type="button" class="btn btn-default btn-sm">수정</button>
                <button id="viewMarkerDelete" type="button" class="btn btn-default btn-sm">삭제</button>
                <button id="viewMarkerCancel" type="button" class="btn btn-default btn-sm">취소</button>
                <input type="hidden" id="viewMarkerIdx" name="idx">
            </div>
        </form>
    </div>
</div>

<div id="viewBulkPopup" class="ol-popup">
    <a href="#" id="viewBulkPopupCloser" class="ol-popup-closer"></a>
    <div id="viewBulkPopupContent">
        <div class="form-group">
            <input class="form-control input-sm" id="viewBulkCategory" name="markerCategory" placeholder="카테고리">
            <input class="form-control input-sm" id="viewBulkTitle" name="markerTitle"
                   placeholder="제목을 입력하세요."><br>
            <textarea class="form-control" id="viewBulkContent" name="markerContent" rows="5"
                      placeholder="내용을 입력하세요."
                      style="resize :none;"></textarea>
            <br>
            <div class="text-center">
                <button id="viewBulkSubmit" type="button" class="btn btn-default btn-sm">수정</button>
                <button id="viewBulkDelete" type="button" class="btn btn-default btn-sm">삭제</button>
                <button id="viewBulkCancel" type="button" class="btn btn-default btn-sm">취소</button>
            </div>
            <input type="hidden" id="viewBulkIdx" name="idx">
        </div>
    </div>
</div>

<script>
    let bubbleData = {};
    let numArr = [];
    let maxNum = 0;
    let minNum = 0;

    function getUICategory(targetNum) {
        var diffNum = maxNum - minNum;
        var stepNum = diffNum / 5;

        var categoryNum2 = minNum + (stepNum);
        var categoryNum3 = minNum + (stepNum * 2);
        var categoryNum4 = minNum + (stepNum * 3);
        var categoryNum5 = minNum + (stepNum * 4);

        // TODO : 요 부분 좀 .. 흠 갯수 상관없이 하도록 할 것
        if (minNum <= targetNum && targetNum < categoryNum2) {
            return 1
        } else if (categoryNum2 <= targetNum && targetNum < categoryNum3) {
            return 2
        } else if (categoryNum3 <= targetNum && targetNum < categoryNum4) {
            return 3
        } else if (categoryNum4 <= targetNum && targetNum < categoryNum5) {
            return 4
        } else if (targetNum < categoryNum5) {
            return 5
        } else {
            return 6
        }
    }

    function getBubbleRadius(targetNum) {
        var diffNum = maxNum - minNum;
        var stepNum = diffNum / ETC_UI.BUBBLE.TOTAL_STEP - 1

        for (var i = 0; i < ETC_UI.BUBBLE.TOTAL_STEP; i++) {

        }

        return
    }

    let heatMapLayer;
    let heatMapData;
    function setHeatMapForXX(target) {
        if (hasMapOverlayByTitle(MAP.HEAT_MAP.NAME)) {
            map.removeLayer(heatMapLayer);
        }

        heatMapLayer = undefined;
        let tempVector = new ol.source.Vector();
        let features = [];

        let heatMapDataLength = heatMapData.length;
        for (let i = 0; i < heatMapDataLength; i++) {
            let geom;
            if (heatMapData[i]['geom'].length > 0) {
                geom = heatMapData[i]['geom'][0];
            } else {
                geom = heatMapData[i]['geom'];
            }
            // TODO : 이거 좀 이상하네 ㅋㅋㅋㅋㅋ
            if(target === FUNC.SUPPLY_PRESENT.KOR_NAME) {
                var tempFeature = new ol.Feature({
                geometry: new ol.geom.Point(heatMapData[i]['geom'][0]),
                id: i,
                weight: 0.5
                });
            } else {
                var tempFeature = new ol.Feature({
                    geometry: new ol.geom.Point(heatMapData[i]['geom']),
                    id: i,
                    weight: 0.5
                });
            }

            features[i] = tempFeature;
        }

        tempVector.addFeatures(features);

        heatMapLayer = new ol.layer.Heatmap({
            title: MAP.HEAT_MAP.NAME,
            source: tempVector,
            gradient: ["#FFFFFF", "#FFFFFF", "#4444FF", "#FF0000", "#FFFF00"],
            blur: parseInt(25, 10),
            radius: parseInt(25, 10),
            zIndex: LAYER_ZINDEX.HEAT_MAP
        });

        map.addLayer(heatMapLayer);

        heatMapLayer.setVisible(false);
    }

    let bubbleLayer;
    let bubbleFluctationLayer;

    function setBubbleMap(calc = 'sum') {

        if (hasMapOverlayByTitle(MAP.BUBBLE_MAP.NAME)) {
            map.removeLayer(bubbleLayer);
        }

        let clusterSource;

        function addFeatures() {
            let features = [];
            let bubbleLength = bubbleData.length;
            for (let i = 0; i < bubbleLength; ++i) {
                let tempFeature = {};
                if (codeStyle === FUNC.SUPPLY_PRESENT.KOR_NAME) {
                    tempFeature = new ol.Feature({
                        geometry: new ol.geom.Point(bubbleData[i].coordinates[0]),
                        id: i
                    });
                } else {
                    tempFeature = new ol.Feature({
                        geometry: new ol.geom.Point([bubbleData[i].coordinates[0], bubbleData[i].coordinates[1]]),
                        id: i
                    });
                }

                tempFeature.set('group', '버블맵');
                tempFeature.set('area_ko_nm', bubbleData[i].area_ko_nm);
                tempFeature.set('total_sum', bubbleData[i].total_sum);
                features[i] = tempFeature;
            }
            clusterSource.getSource().clear();
            clusterSource.getSource().addFeatures(features);
        }

        let styleCache = {};
        let bubbleColor = ['204, 204, 204', '153, 153, 153', '127, 127, 127', '102, 102, 102', '90, 90, 90', '76, 76, 76'];
        let bubbleRadius = [25, 35, 40, 45, 55, 60];
        function getStyle(feature) {
            let clusterVal = 0;
            let tempFeatures = feature.get('features');

            let featuresLength = feature.get('features').length;
            for (let i = 0; i < featuresLength; i++) {
                tempFeatures[i].get('total_sum');
                clusterVal += tempFeatures[i].get('total_sum');
            }

            if (calc === 'avg') {
                clusterVal = (clusterVal / featuresLength).toFixed(0)
            }

            let style = styleCache[clusterVal];
            let category = getUICategory(clusterVal);

            if (!style) {
                let color = bubbleColor[category - 1];
                let radius = bubbleRadius[category - 1];

                style = styleCache[clusterVal] = new ol.style.Style({
                    image: new ol.style.Circle({
                        radius: radius,
                        fill: new ol.style.Fill({
                            color: "rgba(" + color + ", 0.85)"
                        }),
                        stroke: new ol.style.Stroke({
                            color: "#fff",
                            width: 2
                        })
                    }),
                    text: new ol.style.Text({
                        text: hmsUtil.setComma(clusterVal.toString()),
                        font: 'bold 16px Calibri, sans-serif',
                        stroke: new ol.style.Stroke({
                            color: "rgba(255,255,255,1)",
                            width: 5,
                            lineCap: "round"
                        }),
                        fill: new ol.style.Fill({
                            color: '#000'
                        })
                    })
                });
            }
            return [style];

        }

        clusterSource = new ol.source.Cluster({
            distance: 60,
            source: new ol.source.Vector()
        });

        bubbleLayer = new ol.layer.AnimatedCluster({
            title: MAP.BUBBLE_MAP.NAME,
            zIndex: MAP.BUBBLE_MAP.ZINDEX,
            name: 'Cluster',
            source: clusterSource,
            animationDuration: 700,
            style: getStyle
        });

        map.addLayer(bubbleLayer);
        // dynamicLayerGroup.setLayers([bubbleLayer]);
        addFeatures();

        let style1 = new ol.style.Style({
            stroke: new ol.style.Stroke({
                color: "#fff",
                width: 2
            })
        });

        let selectCluster = new ol.interaction.SelectCluster({
            selectCluster_: false,
            pointRadius: 60,
            animate: true,
            spiral: true,
            featureStyle: function (f) {

                let cluster = f.get('features');

                let featureGroup = undefined;
                if (!hmsUtil.isNull(f.get('features'))) {
                    featureGroup = f.get('features')[0].get('group');
                }

                if (featureGroup === '버블맵') {
                    if (f.get('selectclusterfeature')) {
                        let text = cluster[0].get('area_ko_nm') + ' : ' + hmsUtil.setComma(cluster[0].get('total_sum'));
                        let textStyle = new ol.style.Text({
                            text: text,
                            font: 'bold 15px Calibri, sans-serif',
                            stroke: new ol.style.Stroke({
                                color: "#000",
                                width: 10,
                            }),
                            fill: new ol.style.Fill({
                                color: '#fff'
                            })
                        });
                        style1.setText(textStyle);
                    } else {
                        style1.setText(undefined);
                    }

                    return style1
                }
                return false;
            },
            style: function (f, res) {
                let cluster = f.get('features');
                if (cluster[0].get('group') === '버블맵') {
                if (cluster) {
                    if (cluster.length > 1) {
                        if (cluster[0].get('group') === '버블맵') {
                            return getStyle(f, res);
                        } else {
                            return false
                        }
                    } else {
                        return [
                            new ol.style.Style({
                                text: new ol.style.Text({
                                    text : cluster[0].get('area_ko_nm'),
                                    font: 'bold 16px Calibri, sans-serif',
                                    stroke: new ol.style.Stroke({
                                        color: "rgba(255,255,255,1)",
                                        width: 5,
                                        lineCap: "round"
                                    }),
                                    fill: new ol.style.Fill({
                                        color: '#000'
                                    })
                                })
                            })
                        ];
                    }
                }
                }
            }
        });
        map.addInteraction(selectCluster);
    }

    function livyTest() {
        $.ajax({
            url: '{{ url_for("situation.livy_test") }}',
            method: 'POST',
            data: $('#frm-west-0').serialize() + '&req_type=check',
            dataType: 'json',
            async: false,

        }).done(function (data) {
            console.log(data.count);
        });
    }
</script>

<div class="ui-layout-west">
    <div id="west-accordion">
        <!--<h3><a href="#">test</a></h3>-->
        <!--<div>-->
            <!--<a href="javascript:livyTest()">Livy Test</a>-->
            <!--&lt;!&ndash;<a href="javascript:prestoTest()">Presto Test</a>&ndash;&gt;-->
        <!--</div>-->

        {# 인구통계 아코디언#}
        <h3 href="/hoho.html"><a href="#">인구통계</a></h3>
        <div>
            <form id="frm-west-0" class="form-horizontal">
                {# templates/macrLivy 테스트os/form.html에 form의 action이 정의되어 있음.#}
                <div id="frm-filter-0">
                    <div class="form-group">
                        <button id="btn-ps-area" type="button" class="btn btn-default" data-toggle="modal"
                                data-target="#mdl-area">지역선택 +
                        </button>
                        <p><span id="spn-ps-area"></span></p>
                    </div>
                    <div class="form-group">
                        <label for="ps_age_grp_cd"><span class="label label-default">연령대</span></label><br>
                        <select id="ps_age_grp_cd" name="ps_age_grp_cd" class="selectpicker show-tick" multiple title="연령대"
                                data-size="5" data-actions-box="true" data-width="100%" data-container="body">
                        </select>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">시작 년월</span></label><br>
                        <div class="row">
                            <div class="col-md-6">
                                <select id="ps_syear" name="ps_syear" class="selectpicker" title="시작년" data-size="5"
                                        data-actions-box="true" data-width="100%" data-container="body">
                                </select>
                            </div>
                            <div class="col-md-6">
                                <select id="ps_smonth" name="ps_smonth" class="selectpicker" title="시작월" data-size="5"
                                        data-actions-box="true" data-width="100%" data-container="body">
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">종료 년월</span></label><br>
                        <div class="row">
                            <div class="col-md-6">
                            <select id="ps_eyear" name="ps_eyear" class="selectpicker" title="종료년" data-size="5"
                                    data-actions-box="true" data-width="100%" data-container="body">
                            </select>
                                </div>
                            <div class="col-md-6">
                            <select id="ps_emonth" name="ps_emonth" class="selectpicker" title="종료월" data-size="5"
                                    data-actions-box="true" data-width="100%" data-container="body">
                            </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <button id="btn-ps-search" class="btn btn-default pull-right" type="button"
                        onclick="srch_popltn_stats();">
                    검색
                    </button>
                </div>
                <div class="form-group">
                    <span id="ps-source" class="pull-right">
                        <small>출처: </small>
                    </span>
                </div>
            </form>
        </div>

        <!--{# 인구주택총조사 아코디언#}-->
        <!--<h3><a href="#">인구주택총조사</a></h3>-->
        <!--<div>-->
            <!--<form id="frm-west-1" class="form-horizontal">-->
                <!--<div id="frm-filter-1">-->
                    <!--<div class="form-group">-->
                        <!--<button id="btn-hs-a" type="button" class="btn btn-default" data-toggle="modal"-->
                                <!--data-target="#mdl-area">지역선택 +-->
                        <!--</button>-->
                        <!--<p><span id="spn-hs-area"></span></p>-->
                    <!--</div>-->
                    <!--<div class="form-group">-->
                        <!--<label><span class="label label-default">세대수</span></label><br>-->
                        <!--<select id="hs_fmly_num_cd" name="hs_fmly_num_cd" class="selectpicker" multiple title="세대수"-->
                                <!--data-actions-box="true" data-width="100%" data-container="body">-->
                        <!--</select>-->
                    <!--</div>-->
                    <!--<div class="form-group">-->
                        <!--<label><span class="label label-default">주거유형</span></label><br>-->
                        <!--<select id="hs_rsdnc_clsftn_cd" name="hs_rsdnc_clsftn_cd" class="selectpicker" multiple title="주거유형"-->
                                <!--data-actions-box="true" data-width="100%" data-container="body">-->
                        <!--</select>-->
                    <!--</div>-->
                    <!--<div class="form-group">-->
                        <!--<label><span class="label label-default">방개수</span></label><br>-->
                        <!--<select id="hs_room_num_cd" name="hs_room_num_cd" class="selectpicker" multiple title="방개수"-->
                                <!--data-actions-box="true" data-width="100%" data-container="body">-->
                        <!--</select>-->
                    <!--</div>-->
                    <!--<div class="form-group">-->
                        <!--<label><span class="label label-default">시작년</span></label><br>-->
                        <!--<select id="hs_syear" name="hs_syear" class="selectpicker" title="시작년" data-size="5"-->
                                <!--data-actions-box="true" data-width="48.5%" data-container="body">-->
                            <!--<option value="2000">2000</option>-->
                            <!--<option value="2005" selected>2005</option>-->
                            <!--<option value="2010">2010</option>-->
                        <!--</select>-->
                    <!--</div>-->
                    <!--<div class="form-group">-->
                        <!--<label><span class="label label-default">종료년</span></label><br>-->
                        <!--<select id="hs_eyear" name="hs_eyear" class="selectpicker" title="종료년" data-size="5"-->
                                <!--data-actions-box="true" data-width="48.5%" data-container="body">-->
                            <!--<option value="2000">2000</option>-->
                            <!--<option value="2005">2005</option>-->
                            <!--<option value="2010" selected>2010</option>-->
                        <!--</select>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div class="form-group">-->
                    <!--<button id="btn-hs-search" class="btn btn-default pull-right" type="button" onclick="srch_hshold_stats();">-->
                        <!--검색-->
                    <!--</button>-->
                <!--</div>-->
                <!--<div class="form-group">-->
                    <!--<span class="pull-right"><small>출처 : 행정자치부</small></span>-->
                <!--</div>-->
            <!--</form>-->
        <!--</div>-->

        <!--{# 인구이동 아코디언 #}-->
        <h3><a href="#">인구이동</a></h3>
        <div>
            <form id="frm-west-2" class="form-horizontal">
                <div id="frm-filter-2">
                    <!--{# <div class="form-group"> #}-->
                        <!--{# <input id="pm-oa" type="radio" name="pm-trans-type" value="1" checked="checked"> 전출지 #}-->
                        <!--{# <input id="pm-ia" type="radio" name="pm-trans-type" value="2"> 전입지 #}-->
                    <!--{# </div> #}-->
                    <div id="frm-pm-oa" class="form-group inline">
                        <button id="btn-pm-oa" type="button" class="btn btn-default" data-toggle="modal"
                                data-target="#mdl-area">전출지 선택 +
                        </button>
                        <p><span id="spn-pm-oa"></span></p>
                    <!--</div>-->
                    <!--<div id="frm-pm-ia" class="form-group">-->
                        <button id="btn-pm-ia" type="button" class="btn btn-default" data-toggle="modal"
                                data-target="#mdl-area">전입지 선택 +
                        </button>
                        <p><span id="spn-pm-ia"></span></p>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">연령대</span></label><br>
                        <select id='pm_aplcnt_age_cd' name="pm_aplcnt_age_cd" class="selectpicker" multiple title="연령대"
                                data-size="5" data-actions-box="true" data-width="100%" data-container="body">
                        </select>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">이동사유</span></label><br>
                        <select id="pm_mv_reasn_cd" name="pm_mv_reasn_cd" class="selectpicker" multiple title="이동사유"
                                data-actions-box="true" data-width="100%" data-container="body">
                        </select>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">세대수</span></label><br>
                        <select id="pm_fmly_num_cd" name="pm_fmly_num_cd" class="selectpicker" multiple title="세대수" data-size="5"
                                data-actions-box="true" data-width="100%" data-container="body">
                        </select>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">시작 년월</span></label><br>
                        <select id="pm_syear" name="pm_syear" class="selectpicker" title="시작년" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                        <select id="pm_smonth" name="pm_smonth" class="selectpicker" title="시작월" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">종료 년월</span></label><br>
                        <select id="pm_eyear" name="pm_eyear" class="selectpicker" title="종료년" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                        <select id="pm_emonth" name="pm_emonth" class="selectpicker" title="종료월" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <button class="btn btn-default pull-right" type="button" onclick="srch_popltn_mvmt();">검색</button>
                </div>
                <div class="form-group">
                    <span id="pm-source" class="pull-right"><small>출처 : 통계청</small></span>
                </div>
            </form>
        </div>

        <!--수요분석 거래량 아코디언-->
        <h3><a href="#">수요분석 - 거래량</a></h3>
        <div>
            <form id="frm-west-3" class="form-horizontal">
                <div id="frm-filter-3">
                    <div class="form-group">
                        <button id="btn-tst-area" type="button" class="btn btn-default" data-toggle="modal"
                                data-target="#mdl-area"> 지역선택 +
                        </button>
                        <p><span id="spn-tst-area"></span></p>
                    </div>

                    <div class="form-group">
                        <span class="label label-default">매물 종류</span>
                        <br>
                        <div class="btn-group width-full" data-toggle="buttons">
                            <label class="btn btn-default width-4div active">
                                <input id="tst-sale" type="radio" name="tst_trans_type" value="1" checked> 매매
                            </label>
                            <label class="btn btn-default width-4div">
                                <input id="tst-rent" type="radio" name="tst_trans_type" value="2"> 전세
                            </label>
                            <label class="btn btn-default width-4div">
                                <input id="tst-rent-monthly" type="radio" name="tst_trans_type" value="3"> 월세
                            </label>
                            <label class="btn btn-default width-4div">
                                <input id="tst-supply" type="radio" name="tst_trans_type" value="4"> 분양권
                            </label>
                        </div>
                    </div>

                    <div id="tst-house-form" class="form-group">
                        <span class="label label-default">주택 구분</span>
                        <br>
                        <div class="btn-group width-full" data-toggle="buttons">
                            <label class="btn btn-default width-3div active">
                                <input type="radio" name="tst_house_kind" value="1" checked> 아파트
                            </label>
                            <label class="btn btn-default width-3div">
                                <input type="radio" name="tst_house_kind" value="2"> 오피스텔
                            </label>
                            <label class="btn btn-default width-3div disabled">
                                <input type="radio" name="tst_house_kind" value="3" disabled> 주택
                            </label>
                        </div>
                    </div>

                    {# 매매가 #}
                    <div id="tst-sale-form" class="form-group"></div>
                    {# 보증금 #}
                    <div id="tst-rent-form" class="form-group" style="display: none"></div>
                    {# 월세 #}
                    <div id="tst-mrent-form" class="form-group" style="display: none"></div>
                    {# 면적 #}
                    <div id="tst-area-form" class="form-group"></div>
                    {# 노후도 #}
                    <div id="tst-old-form" class="form-group"></div>

                    <div class="form-group">
                        <label><span class="label label-default">시작 년월</span></label><br>
                        <select id="tst_syear" name="tst_syear" class="selectpicker" title="시작년" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                        <select id="tst_smonth" name="tst_smonth" class="selectpicker" title="시작월" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">종료 년월</span></label><br>
                        <select id="tst_eyear" name="tst_eyear" class="selectpicker" title="종료년" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                        <select id="tst_emonth" name="tst_emonth" class="selectpicker" title="종료월" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <button id="btn-tst-search" class="btn btn-default pull-right" type="button"
                    onclick="srch_trnstn_situtn_trans();">검색
                    </button>
                </div>
                <div class="form-group">
                    <span id="tst-source" class="pull-right"><small>출처 : 국토교통부</small></span>
                </div>

                <script type="text/javascript">
                    $('#frm-west-3 .selectpicker').on('change', function () {
                        var slecteditem = $(this).find("option:selected").val();
                        if (slecteditem !== "") {
                            $(this).parent().next().val(slecteditem);
                        }
                    });

                    function chagngetst(value){
                        if (value === '1') {
                                $('#tst-sale-form').css("display", "block");
                                $('#tst-rent-form').css("display", "none");
                                $('#tst-mrent-form').css("display", "none");
                                $('#tst-old-form').css("display", "block");
                                $('#tst-house-form').css("display", "block");
                            } else if (value === '2') {
                                $('#tst-sale-form').css("display", "none");
                                $('#tst-rent-form').css("display", "block");
                                $('#tst-mrent-form').css("display", "none");
                                $('#tst-old-form').css("display", "block");
                                $('#tst-house-form').css("display", "block");
                            } else if (value === '3'){
                                $('#tst-sale-form').css("display", "none");
                                $('#tst-rent-form').css("display", "block");
                                $('#tst-mrent-form').css("display", "block");
                                $('#tst-old-form').css("display", "block");
                                $('#tst-house-form').css("display", "block");
                            } else if (value === '4'){
                                $('#tst-sale-form').css("display", "block");
                                $('#tst-rent-form').css("display", "none");
                                $('#tst-mrent-form').css("display", "none");
                                $('#tst-old-form').css("display", "none");
                                $('#tst-house-form').css("display", "none");
                            }
                    }

                     $('input:radio[name="tst_trans_type"]').change(function(){
                         chagngetst($(this).val());
                     });

                </script>
            </form>
        </div>

        <!--수요분석 가격 아코디언-->
        <h3><a href="#">수요분석 - 가격</a></h3>
        <div>
            <form id="frm-west-4" class="form-horizontal">
                <div id="frm-filter-4">
                    <div class="form-group">
                        <button id="btn-tsp-area" type="button" class="btn btn-default" data-toggle="modal"
                                data-target="#mdl-area"> 지역선택 +
                        </button>
                        <p><span id="spn-tsp-area"></span></p>
                    </div>

                    <div class="form-group">
                        <span class="label label-default">매물 종류</span>
                        <br>
                        <div class="btn-group width-full" data-toggle="buttons">
                            <label class="btn btn-default width-4div active">
                                <input id="tsp-sale" type="radio" name="tsp_trans_type" value="1" checked> 매매
                            </label>
                            <label class="btn btn-default width-4div">
                                <input id="tsp-rent" type="radio" name="tsp_trans_type" value="2"> 전세
                            </label>
                            <label class="btn btn-default width-4div">
                                <input id="tsp-rent-monthly" type="radio" name="tsp_trans_type" value="3"> 월세
                            </label>
                            <label class="btn btn-default width-4div">
                                <input id="tsp-supply" type="radio" name="tsp_trans_type" value="4"> 분양권
                            </label>
                        </div>
                    </div>

                    <div id="tsp-house-form" class="form-group">
                        <span class="label label-default">주택 구분</span>
                        <br>
                        <div class="btn-group width-full" data-toggle="buttons">
                            <label class="btn btn-default width-3div active">
                                <input type="radio" name="tsp_house_kind" value="1" checked> 아파트
                            </label>
                            <label class="btn btn-default width-3div">
                                <input type="radio" name="tsp_house_kind" value="2"> 오피스텔
                            </label>
                            <label class="btn btn-default width-3div disabled">
                                <input type="radio" name="tsp_house_kind" value="3"> 주택
                            </label>
                        </div>
                    </div>

                    {# 매매가 #}
                    <div id="tsp-sale-form" class="form-group"></div>
                    {# 보증금 #}
                    <div id="tsp-rent-form" class="form-group" style="display: none"></div>
                    {# 월세 #}
                    <div id="tsp-mrent-form" class="form-group" style="display: none"></div>
                    {# 면적 #}
                    <div id="tsp-area-form" class="form-group"></div>
                    {# 노후도 #}
                    <div id="tsp-old-form" class="form-group"></div>

                    <div class="form-group">
                        <label><span class="label label-default">시작 년월</span></label><br>
                        <select id="tsp_syear" name="tsp_syear" class="selectpicker" title="시작년" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                        <select id="tsp_smonth" name="tsp_smonth" class="selectpicker" title="시작월" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">종료 년월</span></label><br>
                        <select id="tsp_eyear" name="tsp_eyear" class="selectpicker" title="종료년" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                        <select id="tsp_emonth" name="tsp_emonth" class="selectpicker" title="종료월" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <button id="btn-tsp-search" class="btn btn-default pull-right" type="button"
                    onclick="srch_trnstn_situtn_price();">검색
                    </button>
                </div>
                <div class="form-group">
                    <span id="tsp-source" class="pull-right"><small>출처 : 국토교통부</small></span>
                </div>

                <script type="text/javascript">
                    $('#frm-west-4 .selectpicker').on('change', function () {
                        var slecteditem = $(this).find("option:selected").val();
                        if (slecteditem !== "") {
                            $(this).parent().next().val(slecteditem);
                        }
                    });

                    function chagngetsp(value){
                        if (value === '1') {
                            $('#tsp-sale-form').css("display", "block");
                            $('#tsp-rent-form').css("display", "none");
                            $('#tsp-mrent-form').css("display", "none");
                            $('#tsp-old-form').css("display", "block");
                            $('#tsp-house-form').css("display", "block");
                        } else if (value === '2') {
                            $('#tsp-sale-form').css("display", "none");
                            $('#tsp-rent-form').css("display", "block");
                            $('#tsp-mrent-form').css("display", "none");
                            $('#tsp-old-form').css("display", "block");
                            $('#tsp-house-form').css("display", "block");
                        } else if (value === '3') {
                            $('#tsp-sale-form').css("display", "none");
                            $('#tsp-rent-form').css("display", "block");
                            $('#tsp-mrent-form').css("display", "block");
                            $('#tsp-old-form').css("display", "block");
                            $('#tsp-house-form').css("display", "block");
                        } else if (value === '4') {
                            $('#tsp-sale-form').css("display", "block");
                            $('#tsp-rent-form').css("display", "none");
                            $('#tsp-mrent-form').css("display", "none");
                            $('#tsp-old-form').css("display", "none");
                            $('#tsp-house-form').css("display", "none");
                        }
                    }

                    $('input:radio[name="tsp_trans_type"]').change(function(){
                        chagngetsp($(this).val());
                    });
                </script>
            </form>
        </div>


        {# 입주물량 아코디언 #}
        <h3><a href="#">입주물량</a></h3>
        <div>
            <form id="frm-west-5" class="form-horizontal">
                <div id="frm-filter-5">
                    <div class="form-group">
                        <button id="btn-ib-area" type="button" class="btn btn-default" data-toggle="modal"
                                data-target="#mdl-area"> 지역선택 +
                        </button>
                        <p><span id="spn-ib-area"></span></p>
                    </div>
                    <div id="ib-house-form" class="form-group">
                        <span class="label label-default">주택 구분</span>
                        <br>
                        <div class="btn-group width-full" data-toggle="buttons">
                            <label class="btn btn-default width-3div active">
                                <input type="radio" name="ib_house_kind" value="1" checked> 아파트
                            </label>
                            <label class="btn btn-default width-3div">
                                <input type="radio" name="ib_house_kind" value="2"> 오피스텔
                            </label>
                            <label class="btn btn-default width-3div disabled">
                                <input type="radio" name="ib_house_kind" value="3" disabled> 주택
                            </label>
                        </div>
                    </div>
                    {# 면적 #}
                    <div id="ib-area-form" name="ib-total-area" class="form-group"></div>

                    <div class="form-group">
                        <label><span class="label label-default">입주 시작 년월</span></label><br>
                        <div class="row">
                            <div class="col-md-6">
                                <select id="ib_syear" name="ib_syear" class="selectpicker" title="시작년" data-size="5" data-actions-box="true"
                                        data-width="100%" data-container="body">
                                </select>
                            </div>
                            <div class="col-md-6">
                                <select id="ib_smonth" name="ib_smonth" class="selectpicker" title="시작월" data-size="5" data-actions-box="true"
                                        data-width="100%" data-container="body">
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">입주 종료 년월</span></label><br>
                        <div class="row">
                            <div class="col-md-6">
                                <select id="ib_eyear" name="ib_eyear" class="selectpicker" title="종료년" data-size="5" data-actions-box="true"
                                        data-width="100%" data-container="body">
                                </select>
                                </div>
                            <div class="col-md-6">
                                <select id="ib_emonth" name="ib_emonth" class="selectpicker" title="종료월" data-size="5" data-actions-box="true"
                                        data-width="100%" data-container="body">
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <button id="btn-ib-search" class="btn btn-default pull-right" type="button" onclick="srch_idnfln_bldng()">
                        검색
                    </button>
                </div>
                <div class="form-group">
                    <span id="ib-source" class="pull-right"><small>출처 : 세움터</small></span>
                </div>
            </form>
        </div>

        <!--{# 자영업현황 아코디언 #}-->
        <h3><a href="#">자영업현황</a></h3>
        <div>
            <form id="frm-west-6" class="form-horizontal">
                <div id="frm-filter-6">
                    <div class="form-group">
                        <button id="btn-bs-area" type="button" class="btn btn-default" data-toggle="modal"
                                data-target="#mdl-area"> 지역선택 +
                        </button>
                        <p><span id="spn-bs-area"></span></p>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">업종선택-대분류</span></label><br>
                        <select id="busins_wide_cd" name="busins_wide_cd" class="selectpicker" multiple title="업종선택-대분류"
                                data-size="5" data-actions-box="true" data-width="100%" data-container="body">
                        </select>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">업종선택-중분류</span></label><br>
                        <select id="busins_narr_cd" name="busins_narr_cd" class="selectpicker" multiple title="업종선택-중분류"
                                data-size="5" data-actions-box="true" data-width="100%" data-container="body">
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <button id="btn-bs-search" class="btn btn-default pull-right" type="button" onclick="srch_busins_situtn()">
                        검색
                    </button>
                </div>
                <div class="form-group">
                    <span id="bs-source" class="pull-right"><small>출처 : Ctree 수집 데이터</small></span>
                </div>
            </form>
        </div>

        <!--{# 세대통계 아코디언 #}-->
        <h3><a href="#">세대통계</a></h3>
        <div>
            <form id="frm-west-7" class="form-horizontal">
                <div id="frm-filter-7">
                    <div class="form-group">
                        <button id="btn-hi-area" type="button" class="btn btn-default" data-toggle="modal"
                                data-target="#mdl-area"> 지역선택 +
                        </button>
                        <p><span id="spn-hi-area"></span></p>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">세대수</span></label><br>
                        <select id="hi_fmly_num_cd" name="hi_fmly_num_cd" class="selectpicker" multiple title="세대수"
                                data-actions-box="true" data-container="body" data-width="100%">
                        </select>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">시작 년월</span></label><br>
                        <select id="hi_syear" name="hi_syear" class="selectpicker" title="시작년" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                        <select id="hi_smonth" name="hi_smonth" class="selectpicker" title="시작월" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">종료 년월</span></label><br>
                        <select id="hi_eyear" name="hi_eyear" class="selectpicker" title="종료년" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                        <select id="hi_emonth" name="hi_emonth" class="selectpicker" title="종료월" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <button id="btn-tt-search" class="btn btn-default pull-right" type="button" onclick="srch_hshold_imgrat()">
                    검색
                    </button>
                </div>
                <div class="form-group">
                    <span id="hi-source" class="pull-right"><small>출처 : 통계청</small></span>
                </div>
            </form>
        </div>

        <!--{# 분양현황 아코디언 #}-->
        <h3><a href="#">분양현황</a></h3>
        <div>
            <form id="frm-west-8" class="form-horizontal">
                <div class="form-group text-center">
                    <button id="btn-sp-search1" class="btn btn-primary" type="button"
                            onclick="srchSupplyPresentPrediction('yearly')">
                        금년 분양 검색
                    </button>
                    <!--</div>-->
                    <button id="btn-sp-search2" class="btn btn-primary" type="button"
                            onclick="srchSupplyPresentPrediction('monthly')">
                        금월 분양 검색
                    </button>
                </div>
                <hr>
                <div id="frm-filter-8">
                    <div class="form-group">
                        <button id="btn-sp-area" type="button" class="btn btn-default" data-toggle="modal"
                                data-target="#mdl-area"> 지역선택 +
                        </button>
                        <p><span id="spn-sp-area"></span></p>
                    </div>

                    <div class="form-group">
                        <span class="label label-default">구분</span>
                        <br>
                        <div class="btn-group width-full" data-toggle="buttons">
                            <label class="btn btn-default width-2div active">
                                <input type="radio" name="sp_type" value="1" checked> 공급세대수
                            </label>
                            <label class="btn btn-default width-2div">
                                <input type="radio" name="sp_type" value="2"> 평균평당가
                            </label>

                        </div>
                    </div>

                    {# 면적 #}
                    <div id="sp-area-form" class="form-group"></div>

                    <div class="form-group">
                        <label><span class="label label-default">시작 년월</span></label><br>
                        <select id="sp_syear" name="sp_syear" class="selectpicker" title="시작년" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                        <select id="sp_smonth" name="sp_smonth" class="selectpicker" title="시작월" data-size="5" data-actions-box="true"
                                data-width="48.5%" data-container="body">
                        </select>
                    </div>
                    <div class="form-group">
                        <label><span class="label label-default">종료 년월</span></label><br>
                        <select id="sp_eyear" name="sp_eyear" class="selectpicker" title="종료년" data-size="7"
                                data-actions-box="true" data-width="48.5%" data-container="body">
                        </select>
                        <select id="sp_emonth" name="sp_emonth" class="selectpicker" title="종료월" data-size="7"
                                data-actions-box="true" data-width="48.5%" data-container="body">
                        </select>
                    </div>
                </div>
                <div class="form-group text-center">
                <!--<div class="btn-group">-->
                    <!--&lt;!&ndash;<div class="col-md-3">&ndash;&gt;-->
                <!--<div>-->

                    <button id="btn-sp-search" class="btn btn-default pull-right" type="button" onclick="srchSupplyPresent()">
                        검색
                    </button>
                </div>
                <div class="form-group">
                    <span id="sp-source" class="pull-right"><small>출처 : APT2you</small></span>
                </div>
            </form>
        </div>

        <!--{# 소득현황 아코디언 #}-->
        <h3><a href="#">소득현황</a></h3>
        <div>
            <form id="frm-west-9" class="form-horizontal">
                <div id="frm-filter-9">
                    <div class="form-group">
                        <button id="btn-is-area" type="button" class="btn btn-default" data-toggle="modal"
                                data-target="#mdl-area"> 지역선택 +
                        </button>
                        <p><span id="spn-is-area"></span></p>
                    </div>

                    <div class="form-group">
                        <span class="label label-default">소득 구분</span>
                        <br>
                        <div class="btn-group width-full" data-toggle="buttons">
                            <label class="btn btn-default width-2div active">
                                <input type="radio" name="is_type" value="1" checked> 1인 평균 연봉
                            </label>
                            <label class="btn btn-default width-2div">
                                <input type="radio" name="is_type" value="2"> 종사자 수
                            </label>

                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <button id="btn-is-search" class="btn btn-default pull-right" type="button" onclick="srch_income_situtn()">
                        검색
                    </button>
                </div>
                <div class="form-group">
                    <span id="is-source" class="pull-right"><small>출처 : Ctree 수집 데이터</small></span>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="ui-layout-east">
    <script>
        // let bookMarkUrlInfo = {
        //     select: '{{url_for("bookmark.select_bookmark")}}',
        //     insert: '{{url_for("bookmark.insert_bookmark")}}',
        //     update: '{{url_for("bookmark.update_bookmark")}}',
        //     delete: '{{url_for("bookmark.delete_bookmark")}}',
        // };
        // let hmsBookmark = new HmsBookmark(bookMarkUrlInfo);
        //
        // $(document).ready(hmsBookmark.selectBookmarks(1));

        $(document).ready(selectBookmarks(1));


        function setBookmarkName($this) {
            $('input:text[name=txt-bookmark-name]').val($this.is(':checked') ? $this.next().text() : '');
            $('input:checkbox[name=cbx-bookmark]').not($this).prop('checked', false);
        }


        function findConfigByIndex(index) {
            let traceIndex = 0;
            let ret = {};
            $.each(FUNC, function (i, item) {
                if (traceIndex === Number(index)) {
                    ret = item;
                    return false;
                }

                traceIndex += 1;
            });
            return ret;
        }

        function selectBookmarks(page) {
            $.ajax({
                method: 'POST',
                url: '{{url_for("bookmark.select_bookmark")}}',
                data: {bookmark_page: page},
                dataType: 'json'
            }).done(function (data) {
                let results = [];

                if (data.items.length !== 0) {
                    $.each(data.items, function (i, item) {
                        results.push('<tr><td>');
                        results.push(`<input type="checkbox" name="cbx-bookmark" value="${item.id}" onclick="setBookmarkName($(this));">`);
                        results.push(`<a href="#" onclick="executeBookmark(${item.target},'${item.parameter}');">${item.name}</a>`);
                        //                        results.push('<td class="text-right"><button class="btn btn-default btn-sm btn-bookmark"><i class="fa fa-eye" aria-hidden="true"></a></button></td>');
                        results.push('</td></tr>');
                    });
                } else {
                    results.push('<tr><td class="text-center">');
                    results.push('검색 결과가 없습니다.');
                    results.push('</td></tr>');
                }
                $('#tbl-bookmark tbody').empty().append(results.join(''));
                $('input:text[name=txt-bookmark-name]').val('');
            });
        }

        function executeBookmark(target, parameter) {
            let NAME_TYPE_CONF = {
                popltn_stats: {
                    ps_age_grp_cd: 'selectpicker',
                    ps_syear: 'selectpicker',
                    ps_smonth: 'selectpicker',
                    ps_eyear: 'selectpicker',
                    ps_emonth: 'selectpicker'
                },
                hshold_stats: {
                    hs_fmly_num_cd: 'selectpicker',
                    hs_rsdnc_clsftn_cd: 'selectpicker',
                    hs_room_num_cd: 'selectpicker',
                    hs_syear: 'selectpicker',
                    hs_smonth: 'selectpicker',
                    hs_eyear: 'selectpicker',
                    hs_emonth: 'selectpicker'
                },
                popltn_mvmt: {
                    pm_aplcnt_age_cd: 'selectpicker',
                    pm_mv_reasn_cd: 'selectpicker',
                    pm_fmly_num_cd: 'selectpicker',
                    pm_syear: 'selectpicker',
                    pm_smonth: 'selectpicker',
                    pm_eyear: 'selectpicker',
                    pm_emonth: 'selectpicker'
                },
                trnstn_situtn_trans: {
                    tst_trans_type: 'toggle_button',
                    tst_house_kind: 'toggle_button',
                    tst_ssale: 'range_slider',
                    tst_esale: 'range_slider',
                    tst_sdeposit: 'range_slider',
                    tst_edeposit: 'range_slider',
                    tst_srent: 'range_slider',
                    tst_erent: 'range_slider',
                    tst_sexarea: 'range_slider',
                    tst_eexarea: 'range_slider',
                    tst_sdecrepit: 'range_slider',
                    tst_edecrepit: 'range_slider',
                    tst_sale: 'range_slider',
                    tst_deposit: 'range_slider',
                    tst_rent: 'range_slider',
                    tst_exarea: 'range_slider',
                    tst_decrepit: 'range_slider',
                    tst_syear: 'selectpicker',
                    tst_smonth: 'selectpicker',
                    tst_eyear: 'selectpicker',
                    tst_emonth: 'selectpicker'
                },
                trnstn_situtn_price: {
                    tsp_trans_type: 'toggle_button',
                    tsp_house_kind: 'toggle_button',
                    tsp_ssale: 'range_slider',
                    tsp_esale: 'range_slider',
                    tsp_sdeposit: 'range_slider',
                    tsp_edeposit: 'range_slider',
                    tsp_srent: 'range_slider',
                    tsp_erent: 'range_slider',
                    tsp_sexarea: 'range_slider',
                    tsp_eexarea: 'range_slider',
                    tsp_sdecrepit: 'range_slider',
                    tsp_edecrepit: 'range_slider',
                    tsp_sale: 'range_slider',
                    tsp_deposit: 'range_slider',
                    tsp_rent: 'range_slider',
                    tsp_exarea: 'range_slider',
                    tsp_decrepit: 'range_slider',
                    tsp_syear: 'selectpicker',
                    tsp_smonth: 'selectpicker',
                    tsp_eyear: 'selectpicker',
                    tsp_emonth: 'selectpicker'
                },
                idnftn_bldng: {
                    ib_house_kind: 'toggle_button',
                    ib_sexarea: 'range_slider',
                    ib_eexarea: 'range_slider',
                    ib_exarea: 'range_slider',
                    ib_syear: 'selectpicker',
                    ib_smonth: 'selectpicker',
                    ib_eyear: 'selectpicker',
                    ib_emonth: 'selectpicker'
                },
                busins_situtn: {
                    busins_wide_cd: 'selectpicker',
                    busins_narr_cd: 'selectpicker'
                },
                hshold_imgrat: {
                    hi_fmly_num_cd: 'selectpicker',
                    hi_syear: 'selectpicker',
                    hi_smonth: 'selectpicker',
                    hi_eyear: 'selectpicker',
                    hi_emonth: 'selectpicker'
                },
                supply_present: {
                    sp_type: 'toggle_button',
                    sp_sexarea: 'range_slider',
                    sp_eexarea: 'range_slider',
                    sp_exarea: 'range_slider',
                    sp_syear: 'selectpicker',
                    sp_smonth: 'selectpicker',
                    sp_eyear: 'selectpicker',
                    sp_emonth: 'selectpicker'
                },
                income_situtn: {
                    is_type: 'toggle_button'
                }
            };

            $('#west-accordion').accordion('option', 'active', target);
            parameter = decodeURIComponent(parameter);

            let codeStyleShort = findConfigByIndex(target).CODE_STYLE_SHORT;

            let paramObj = {};
            $.each(parameter.split('&'), function (i, param) {
                let pairs = param.split('=');
                let name = pairs[0];
                let value = pairs[1];

                if (NAME_TYPE_CONF[findConfigByIndex(target).CODE_STYLE][name] !== 'range_slider') {
                    if (paramObj[name]) {
                        paramObj[name].push(value);
                    } else {
                        paramObj[name] = [value];
                    }
                } else {
                    name = codeStyleShort + '_' + name.substring(codeStyleShort.length + 2, name.length);

                    if (paramObj[name]) {
                        paramObj[name].push(Number(value));
                    } else {
                        console.log(NAME_TYPE_CONF[findConfigByIndex(target).CODE_STYLE][name]);
                        paramObj[name] = [Number(value)];
                    }
                }

            });

            $.each(paramObj, function (key, value) {
                console.log(key);
                console.log(value);
                // TODO : 지역 코드 여러개 들어갈 수 있도록 해야함
                if (key.indexOf('sid_cd') >= 0 || key.indexOf('sgg_cd') >= 0 || key.indexOf('emd_cd') >= 0) {
                    if (findConfigByIndex(target).CODE_STYLE === 'popltn_mvmt') {
                        if (key.indexOf('out_') >= 0) {
                            let ko_name = getAreaKor(findConfigByIndex(target).LOCATION_TYPE, value);

                            let outAreaContent = '<input locationdepth="' + key.split('_')[0] + '" type="hidden" name="' + key + '" value="' + value + '">' +
                                '<span class="label label-success" style="display: inline-block;">' + ko_name[0].ko_nm + '</span>';
                            $('#spn-' + codeStyleShort + '-oa').html(outAreaContent);
                        }

                        if (key.indexOf('in_') >= 0) {
                            let ko_name = getAreaKor(findConfigByIndex(target).LOCATION_TYPE, value);

                            let inAreaContent = '<input locationdepth="' + key.split('_')[0] + '" type="hidden" name="' + key + '" value="' + value + '">' +
                                '<span class="label label-success" style="display: inline-block;">' + ko_name[0].ko_nm + '</span>';
                            $('#spn-' + codeStyleShort + '-ia').html(inAreaContent);
                        }
                    } else {
                        let ko_name = getAreaKor(findConfigByIndex(target).LOCATION_TYPE, value);
                        console.log(ko_name);

                        let areaContent = '<input locationdepth="' + key.split('_')[0] + '" type="hidden" name="' + key + '" value="' + value + '">' +
                            '<span class="label label-success" style="display: inline-block;">' + ko_name[0].ko_nm + '</span>';
                        $('#spn-' + codeStyleShort + '-area').html(areaContent);
                    }
                }

                let nameType = NAME_TYPE_CONF[findConfigByIndex(target).CODE_STYLE][key];

                if (nameType === 'selectpicker') {
                    $('#' + key).selectpicker('val', value);
                }

                if (nameType === 'toggle_button') {
                    $.each($('input[name=' + key + ']'), function (i, element) {
                        if ($(element).val() === value[0]) {
                            $(element).parent().addClass('active');
                            $(element).prop('checked', true);

                            if (codeStyleShort === 'tst' && key === 'tst_trans_type') {
                                chagngetst(value[0]);
                            }

                            if (codeStyleShort === 'tsp' && key === 'tsp_trans_type') {
                                chagngetsp(value[0]);
                            }
                        } else {
                            $(element).parent().removeClass('active');
                            $(element).removeAttr('checked');
                        }
                    });
                }

                if (nameType === 'range_slider') {
                    let replaceKey = key.replace('_', '-');

                    $('#' + replaceKey + '-slider').slider("option", "values", value);
                    let $labelEl = $('#' + replaceKey + '-label')
                    let originText = $labelEl.text();
                    let thisUnit = originText.substring(originText.indexOf("(") + 1, originText.indexOf(")"));

                    $labelEl.text(' ' + hmsUtil.setComma(String(value[0])) + ' ~ ' + String(hmsUtil.setComma(value[1])) + ' (' + thisUnit + ')');

                    $('#' + key.replace('_', '_s')).val(value[0]);
                    $('#' + key.replace('_', '_e')).val(value[1]);
                }
            });
        }

        function showAddBookMark() {
            var $target = $('#west-accordion').accordion('option', 'active');

            $('#frm-filter-' + $target)
                .clone()
                .prependTo($('#clone-form'));

            hmsUi.showModal('mdl-bookmark');

            $('#mdl-bookmark').on('hide.bs.modal', function () {
                $('#clone-form').empty();
            });
        }

        function addBookmark() {
            let $nameEl = $('#bookmark-name');
            let $name = $nameEl.val();

            if ($name === '') {
                alert('즐겨찾기 명칭을 입력해주세요.');
                $nameEl.focus();
                return;
            }

            let $target = $('#west-accordion').accordion('option', 'active');
            let $parameter = $('#frm-west-' + $target).serialize();

            $.ajax({
                method: 'POST',
                url: '{{url_for("bookmark.insert_bookmark")}}',
                data: {name: $name, target: $target, parameter: encodeURIComponent($parameter)},
                dataType: 'json'
            }).done(function (data) {
                alert(data.msg);
                selectBookmarks(1);
                hmsUi.hideModal('mdl-bookmark');
            });
        }

        function deleteBookmark() {
            var $this = $('input:checkbox[name=cbx-bookmark]');
            if ($this.is(':checked') == false) {
                alert('삭제할 검색 명칭을 체크해주세요.');
                return;
            }
            var $id;
            $this.each(function () {
                if ($(this).is(':checked') == true) {
                    $id = $(this).val();
                }
            });
            $.ajax({
                method: 'POST',
                url: '{{url_for("bookmark.delete_bookmark")}}',
                data: {id: $id},
                dataType: 'json'
            }).done(function (data) {
                alert(data.msg);
                selectBookmarks(1);
            });
        }

        function edit_bookmark() {
            var $this = $('input:checkbox[name=cbx-bookmark]');
            if ($this.is(':checked') == false) {
                alert('수정할 검색 명칭을 체크해주세요.');
                return;
            }
            var $id;
            $this.each(function () {
                if ($(this).is(':checked') == true) {
                    $id = $(this).val();
                }
            });
            $.ajax({
                method: 'POST',
                url: '{{url_for("bookmark.update_bookmark")}}',
                data: {id: $id, name: $('input:text[name=txt-bookmark-name]').val()},
                dataType: 'json'
            }).done(function (data) {
                alert(data.msg);
                selectBookmarks(1);
            });
        }

    </script>
    <div id="east-accordion">
        <h3><a href="#">즐겨찾기</a></h3>
        <div>
            <table id="tbl-bookmark" class="table">
                <thead>
                <tr>
                    <td>
                        <button id="btn-bookmark-add" class="btn btn-default btn-sm btn-bookmark"
                                type="button"
                                onclick="showAddBookMark();" title="즐겨찾기 추가">
                            <i class="fa fa-plus-circle text-primary text-primary-bookmark" aria-hidden="true"></i>
                         </button>
                        <button id="btn-bookmark-delete" class="btn btn-default btn-sm btn-bookmark"
                                type="button"
                                onclick="deleteBookmark();" title="즐겨찾기 삭제">
                            <i class="fa fa-minus-circle text-primary text-primary-bookmark" aria-hidden="true"></i>
                        </button>
                    </td>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <div class="text-center">
                <nav aria-label="Page navigation example">
                    <ul class="pagination pagination-sm">
                        <li class="page-item"><a class="page-link" onclick="selectBookmarks(1)">1</a></li>
                        <li class="page-item"><a class="page-link" onclick="selectBookmarks(2)">2</a></li>
                        <li class="page-item"><a class="page-link" onclick="selectBookmarks(3)">3</a></li>
                        <li class="page-item"><a class="page-link" onclick="selectBookmarks(4)">4</a></li>
                        <li class="page-item"><a class="page-link" onclick="selectBookmarks(5)">5</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <h3><a href="#">분석 결과 레이어</a></h3>
        <div>
            <div class="form-group pull-right">
            <button id="asdf" class="btn btn-default btn-sm btn-bookmark"
                    type="button" title="즐겨찾기 추가">
                <i class="fas fa-arrow-alt-circle-up text-primary text-primary-bookmark" aria-hidden="true"></i>
            </button>
            <button id="fdsa" class="btn btn-default btn-sm btn-bookmark"
                    type="button" title="즐겨찾기 삭제">
                <i class="fas fa-arrow-alt-circle-down text-primary text-primary-bookmark" aria-hidden="true"></i>
            </button>
            </div>
        </div>
        <h3><a href="#">UI 설정</a></h3>
        <div>
            <div class="">
                <div class="card-header">
                <!--Featured-->
                </div>
                <div class="card-block">
                    <h4>POI 타이틀 토글</h4>
                    <div class="btn-group width-full" data-toggle="buttons">
                        <label class="btn btn-default width-2div active">
                            <input type="radio" name="title-toggle" value="off" checked> Off
                        </label>
                        <label class="btn btn-default width-2div">
                            <input type="radio" name="title-toggle" value="on"> on
                        </label>
                    </div>
                </div>
            </div>
            <script>
                $('input:radio[name="title-toggle"]').on('change', function() {
                    let poiTitleToggleVal = $(this).val();

                    console.log(poiLayerName);

                    if (poiLayerName) {
                        let codeStyleShort = FUNC[codeStyle.toUpperCase()]["CODE_STYLE_SHORT"];
                        let styleName = "";

                        if (poiLayerName === "hms:trnstn_situtn_ssss" || poiLayerName === "hms:trnstn_situtn_supply_ssss") {
                            if (poiTitleToggleVal === 'on') {
                                styleName = `hms:hms_poi_${codeStyleShort}_title_on_ssss`;
                            } else {
                                styleName = "";
                            }
                            console.log(styleName);
                            FUNC[codeStyle.toUpperCase()]["MAP_LAYER"].getSource().updateParams({
                                STYLES: styleName
                            });
                        } else if (poiLayerName !== "hms:trnstn_situtn_supply") {

                            if (poiTitleToggleVal === 'on') {
                                styleName = `hms:hms_poi_${codeStyleShort}_title_on`;
                            } else {
                                styleName = "";
                            }
                            console.log(styleName);
                            FUNC[codeStyle.toUpperCase()]["MAP_LAYER"].getSource().updateParams({
                                STYLES: styleName
                            });
                        }
                        else {
                            if (poiTitleToggleVal === 'on') {
                                styleName = `hms:hms_poi_tss_title_on`;
                            } else {
                                styleName = "";
                            }

                            FUNC[codeStyle.toUpperCase()]["MAP_LAYER"].getSource().updateParams({
                                STYLES: styleName
                            });
                        }
                    }
                });
            </script>

            <br>

            <div class="card">
                <div class="card-header">
                <!--Featured-->
                </div>
                <div class="card-block">
                    <h4>히트맵</h4>
                    <div id="hmap-radius"></div>
                </div>
            </div>
            <br>

        </div>
        <h3><a href="#">차트</a></h3>
        <div>
            <!--<a class="btn btn-default btn-block" onclick="setChart('radar', 'cnv-chart-radar');">-->
                <!--<i class="fa fa-area-chart fa-lg text-info"></i> 레이더-->
            <!--</a>-->
            <br>
            <a class="btn btn-default btn-block" onclick="setChart('bar', 'cnv-chart-bar');">
                <i class="fa fa-bar-chart fa-lg text-info"></i> 세로막대
            </a>
            <br>
            <a class="btn btn-default btn-block" onclick="setChart('horizontalBar', 'cnv-chart-horizontalBar');">
                <i class="fa fa-bar-chart fa-lg text-info"></i> 가로막대
            </a>
            <br>
            <!--<a class="btn btn-default btn-block" onclick="setChart('area', 'cnv-chart-area');">-->
                <!--<i class="fa fa-area-chart fa-lg text-info"></i> 영역-->
            <!--</a>-->
            <!--<br>-->
            <a class="btn btn-default btn-block" onclick="setChart('line', 'cnv-chart-line');">
                <i class="fa fa-line-chart fa-lg text-info"></i> 라인
            </a>
            <!--<br>-->
            <!--<a class="btn btn-default btn-block" onclick="setChart('pie', 'cnv-chart-pie');">-->
                <!--<i class="fa fa-pie-chart fa-lg text-info"></i> 파이-->
            <!--</a>-->
        </div>
        <h3><a href="#">설정</a></h3>
        <div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">전체 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-all" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-all" value="false"> 숨기기
                    </label>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">줌 버튼 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-zbutton" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-zbutton" value="false"> 숨기기
                    </label>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">줌 슬라이더 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-zslider" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-zslider" value="false"> 숨기기
                    </label>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">스케일 라인 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-sline" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-sline" value="false"> 숨기기
                    </label>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">풀 스크린 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-fscreen" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-fscreen" value="false"> 숨기기
                    </label>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">레이어 스위처 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-lswitcher" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-lswitcher" value="false"> 숨기기
                    </label>
                </div>
            </div>

            {# <div class="panel panel-default"> #}
                {# <div class="panel-heading"> #}
                    {# <h3 class="panel-title">오버뷰 맵 컨트롤</h3> #}
                {# </div> #}
                {# <div class="panel-body"> #}
                    {# <label class="radio-inline"> #}
                        {# <input type="radio" name="rdo-control-ovmap" value="true" checked> 보이기 #}
                    {# </label> #}
                    {# <label class="radio-inline"> #}
                        {# <input type="radio" name="rdo-control-ovmap" value="false"> 숨기기 #}
                    {# </label> #}
                {# </div> #}
            {# </div> #}

            {# <div class="panel panel-default"> #}
                {# <div class="panel-heading"> #}
                    {# <h3 class="panel-title">이미지 다운로드 컨트롤</h3> #}
                {# </div> #}
                {# <div class="panel-body"> #}
                    {# <label class="radio-inline"> #}
                        {# <input type="radio" name="rdo-control-imgdwl" value="true" checked> 보이기 #}
                    {# </label> #}
                    {# <label class="radio-inline"> #}
                        {# <input type="radio" name="rdo-control-imgdwl" value="false"> 숨기기 #}
                    {# </label> #}
                {# </div> #}
            {# </div> #}

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">폴리곤 생성 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-polygon" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-polygon" value="false"> 숨기기
                    </label>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">마커 컨트롤</h3>
                </div>
                <div class="panel-body">
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-marker" value="true" checked> 보이기
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="rdo-control-marker" value="false"> 숨기기
                    </label>
                </div>
            </div>

            {# <div class="panel panel-default"> #}
                {# <div class="panel-heading"> #}
                    {# <h3 class="panel-title">지도 리플레쉬 컨트롤</h3> #}
                {# </div> #}
                {# <div class="panel-body"> #}
                    {# <label class="radio-inline"> #}
                        {# <input type="radio" name="rdo-control-refresh" value="true" checked> 보이기 #}
                    {# </label> #}
                    {# <label class="radio-inline"> #}
                        {# <input type="radio" name="rdo-control-refresh" value="false"> 숨기기 #}
                    {# </label> #}
                {# </div> #}
            {# </div> #}
        </div>
    </div>
</div>
<div class="wrap-loading"></div>
<div class="loader"></div>
<div class="ui-layout-south">
    <div id="pivotTitle" class="text-center"></div>
    <div id="pivot-tab"></div>
    <div class="row sm-margin-bottom">
        <div class="col-md-11">
            <div id="pivot-timeseries" class="text-right sm-margin-top"></div>
        </div>
        <div class="col-md-1">
        <div id="pivot-download" class="text-right"></div>
        </div>
    </div>
    <div id="pivot-table" class="md-margin-top"></div>
</div>

<script type="text/javascript">
    function showLoader() {
        $('.loader').show();
        $('.wrap-loading').show();
    }

    function hideLoader() {
        $('.loader').hide();
        $('.wrap-loading').hide();
    }

    $(document).ready(function () {
        // let hmsTest = new HmsSituationTable({cols:"123", rows:"123"}, '타이틀이지');
        // console.log(hmsTest.setGroupFieldId(12133));
        // 시작부분
        setDataSource();

        function setAllAreas() {
            set_areas('', 'ps', 'spn-ps-area', 'adm');
            set_areas('', 'hs', 'spn-hs-area', 'law');
            set_areas('in_', 'pm', 'spn-pm-ia', 'adm');
            set_areas('', 'tst', 'spn-tst-area', 'law');
            set_areas('', 'tsp', 'spn-tsp-area', 'law');
            set_areas('', 'ib', 'spn-ib-area', 'law');
            set_areas('', 'bs', 'spn-bs-area', 'law');
            set_areas('', 'hi', 'spn-hi-area', 'adm');
            set_areas('', 'sp', 'spn-sp-area', 'law');
            set_areas('', 'is', 'spn-is-area', 'law');
        }

//        {# 지역현황 > 인구통계 > 필터 세팅 #}
        $('#btn-ps-area').button().on('click', function () {
            refresh_areas();

            set_adm_sid_areas('radio');
            $('#btn-area').button().on('click', function () {

                set_areas('', 'ps', 'spn-ps-area', 'adm');
            });
        });

        set_codes_for_selectpicker('ps_age_grp_cd', 'ps_age_grp_cd');
        set_year_for_selectpicker('ps_syear', hmsUtil.getYearFromStr(FUNC.POPLTN_STATS.TIME_START), hmsUtil.getYearFromStr(FUNC.POPLTN_STATS.TIME_END), 1, true, hmsUtil.getYearFromStr(FUNC.POPLTN_STATS.TIME_END));
        set_date_for_selectpicker('ps_smonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.POPLTN_STATS.TIME_END));
        set_year_for_selectpicker('ps_eyear', hmsUtil.getYearFromStr(FUNC.POPLTN_STATS.TIME_START), hmsUtil.getYearFromStr(FUNC.POPLTN_STATS.TIME_END), 1, false, hmsUtil.getYearFromStr(FUNC.POPLTN_STATS.TIME_END));
        set_date_for_selectpicker('ps_emonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.POPLTN_STATS.TIME_END));

//        {# 지역현황 > 인구주택총조사 > 필터 세팅 #}
        $('#btn-hs-a').button().on('click', function () {
            refresh_areas();

            set_law_sid_areas('radio');
            $('#btn-area').button().on('click', function () {

                set_areas('', 'hs', 'spn-hs-area', 'law');
            });
        });

        set_codes_for_selectpicker('hs_fmly_num_cd', 'hs_fmly_num_cd');
        set_codes_for_selectpicker('hs_rsdnc_clsftn_cd', 'hs_rsdnc_clsftn_cd');
        set_codes_for_selectpicker('hs_room_num_cd', 'hs_room_num_cd');


//        {# 지역현황 > 인구이동 > 필터 세팅 #}
        $("#btn-pm-oa").button().on('click', function () {
            refresh_areas();

            set_adm_sid_areas('radio');
            $('#btn-area').button().on('click', function () {
                set_areas('out_', 'pm', 'spn-pm-oa', 'adm');
            });
        });

        $('#btn-pm-ia').button().on('click', function () {
            refresh_areas();

            set_adm_sid_areas('radio');
            $('#btn-area').button().on('click', function () {

                set_areas('in_', 'pm', 'spn-pm-ia', 'adm');
            });
        });

        set_codes_for_selectpicker('pm_aplcnt_age_cd', 'pm_aplcnt_age_cd');
        set_codes_for_selectpicker('pm_mv_reasn_cd', 'pm_mv_reasn_cd');
        set_codes_for_selectpicker('pm_fmly_num_cd', 'pm_fmly_num_cd');
        set_year_for_selectpicker('pm_syear', hmsUtil.getYearFromStr(FUNC.POPLTN_MVMT.TIME_START), hmsUtil.getYearFromStr(FUNC.POPLTN_MVMT.TIME_END), 1, true, hmsUtil.getYearFromStr(FUNC.POPLTN_MVMT.TIME_END));
        set_date_for_selectpicker('pm_smonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.POPLTN_MVMT.TIME_END));
        set_year_for_selectpicker('pm_eyear', hmsUtil.getYearFromStr(FUNC.POPLTN_MVMT.TIME_START), hmsUtil.getYearFromStr(FUNC.POPLTN_MVMT.TIME_END), 1, false, hmsUtil.getYearFromStr(FUNC.POPLTN_MVMT.TIME_END));
        set_date_for_selectpicker('pm_emonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.POPLTN_MVMT.TIME_END));

//        {# 지역현황 > 수요분석 - 거래량 > 필터 세팅 #}
        $('#btn-tst-area').button().on('click', function () {
            refresh_areas();

            set_law_sid_areas('radio');
            $('#btn-area').button().on('click', function () {

                set_areas('', 'tst', 'spn-tst-area', 'law');
            });
        });

        set_codes_for_range_slider('tst-sale-form', 'tst-sale-slider', 'tst-sale-label', 'tst_ssale', 'tst_esale', '매매가', '만 원', 0, 200000, 5000, 0, 200000);
        set_codes_for_range_slider('tst-rent-form', 'tst-deposit-slider', 'tst-deposit-label', 'tst_sdeposit', 'tst_edeposit', '보증금', '만 원', 0, 150000, 5000, 0, 150000);
        set_codes_for_range_slider('tst-mrent-form', 'tst-rent-slider', 'tst-rent-label', 'tst_srent', 'tst_erent', '월세', '만 원', 0, 900, 100, 0, 900);
        set_codes_for_range_slider('tst-area-form', 'tst-exarea-slider', 'tst-exarea-label', 'tst_sexarea', 'tst_eexarea', '면적', '㎡', 0, 500, 10, 0, 500);
        set_codes_for_range_slider('tst-old-form', 'tst-decrepit-slider', 'tst-decrepit-label', 'tst_sdecrepit', 'tst_edecrepit', '노후도', '년', 0, 50, 1, 0, 50);
        set_year_for_selectpicker('tst_syear', hmsUtil.getYearFromStr(FUNC.TRNSTN_SITUTN_TRANS.TIME_START), hmsUtil.getYearFromStr(FUNC.TRNSTN_SITUTN_TRANS.TIME_END), 1, true, hmsUtil.getYearFromStr(FUNC.TRNSTN_SITUTN_TRANS.TIME_END));
        set_date_for_selectpicker('tst_smonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.TRNSTN_SITUTN_TRANS.TIME_END));
        set_year_for_selectpicker('tst_eyear', hmsUtil.getYearFromStr(FUNC.TRNSTN_SITUTN_TRANS.TIME_START), hmsUtil.getYearFromStr(FUNC.TRNSTN_SITUTN_TRANS.TIME_END), 1, false, hmsUtil.getYearFromStr(FUNC.TRNSTN_SITUTN_TRANS.TIME_END));
        set_date_for_selectpicker('tst_emonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.TRNSTN_SITUTN_TRANS.TIME_END));

//        {# 지역현황 > 수요분석 - 가격 > 필터 세팅 #}
        $('#btn-tsp-area').button().on('click', function () {
            refresh_areas();

            set_law_sid_areas('radio');
            $('#btn-area').button().on('click', function () {

                set_areas('', 'tsp', 'spn-tsp-area', 'law');
            });
        });

        set_codes_for_range_slider('tsp-sale-form', 'tsp-sale-slider', 'tsp-sale-label', 'tsp_ssale', 'tsp_esale', '매매가', '만 원', 0, 200000, 5000, 0, 200000);
        set_codes_for_range_slider('tsp-rent-form', 'tsp-deposit-slider', 'tsp-deposit-label', 'tsp_sdeposit', 'tsp_edeposit', '보증금', '만 원', 0, 150000, 5000, 0, 150000);
        set_codes_for_range_slider('tsp-mrent-form', 'tsp-rent-slider', 'tsp-rent-label', 'tsp_srent', 'tsp_erent', '월세', '만 원', 0, 900, 100, 0, 900);
        set_codes_for_range_slider('tsp-area-form', 'tsp-exarea-slider', 'tsp-exarea-label', 'tsp_sexarea', 'tsp_eexarea', '면적', '㎡', 0, 500, 10, 0, 500);
        set_codes_for_range_slider('tsp-old-form', 'tsp-decrepit-slider', 'tsp-decrepit-label', 'tsp_sdecrepit', 'tsp_edecrepit', '노후도', '년', 0, 50, 1, 0, 50);
        set_year_for_selectpicker('tsp_syear', hmsUtil.getYearFromStr(FUNC.TRNSTN_SITUTN_PRICE.TIME_START), hmsUtil.getYearFromStr(FUNC.TRNSTN_SITUTN_PRICE.TIME_END), 1, true, hmsUtil.getYearFromStr(FUNC.TRNSTN_SITUTN_PRICE.TIME_END));
        set_date_for_selectpicker('tsp_smonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.TRNSTN_SITUTN_PRICE.TIME_END));
        set_year_for_selectpicker('tsp_eyear', hmsUtil.getYearFromStr(FUNC.TRNSTN_SITUTN_PRICE.TIME_START), hmsUtil.getYearFromStr(FUNC.TRNSTN_SITUTN_PRICE.TIME_END), 1, false, hmsUtil.getYearFromStr(FUNC.TRNSTN_SITUTN_PRICE.TIME_END));
        set_date_for_selectpicker('tsp_emonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.TRNSTN_SITUTN_PRICE.TIME_END));

//        {# 지역현황 > 입주물량 > 필터 세팅 #}
        $('#btn-ib-area').button().on('click', function () {
            refresh_areas();

            set_law_sid_areas('radio');
            $('#btn-area').button().on('click', function () {

                set_areas('', 'ib', 'spn-ib-area', 'law');
            });
        });

        set_codes_for_selectpicker('main_use_cd', 'main_use_cd');
        set_codes_for_range_slider('ib-area-form', 'ib-exarea-slider', 'ib-exarea-label', 'ib_sexarea', 'ib_eexarea', '면적', '㎡', 0, 500, 10, 0, 500);

        set_year_for_selectpicker('ib_syear', hmsUtil.getYearFromStr(FUNC.IDNFTN_BLDNG.TIME_START), hmsUtil.getYearFromStr(FUNC.IDNFTN_BLDNG.TIME_END), 1, true, hmsUtil.getYearFromStr(FUNC.IDNFTN_BLDNG.TIME_END));
        set_date_for_selectpicker('ib_smonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.IDNFTN_BLDNG.TIME_END));
        set_year_for_selectpicker('ib_eyear', hmsUtil.getYearFromStr(FUNC.IDNFTN_BLDNG.TIME_START), hmsUtil.getYearFromStr(FUNC.IDNFTN_BLDNG.TIME_END), 1, false, hmsUtil.getYearFromStr(FUNC.IDNFTN_BLDNG.TIME_END));
        set_date_for_selectpicker('ib_emonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.IDNFTN_BLDNG.TIME_END));

//        {# 지역현황 > 자영업현황 > 필터 세팅 #}
        $('#btn-bs-area').button().on('click', function () {
            refresh_areas();

            set_law_sid_areas('radio');
            $('#btn-area').button().on('click', function () {

                set_areas('', 'bs', 'spn-bs-area', 'law');
            });
        });

        set_codes_for_selectpicker('busins_wide_cd', 'busins_wide_cd');
        set_codes_for_selectpicker('busins_narr_cd', 'busins_narr_cd');
//        {# 지역현황 > 세대통계 > 필터 세팅 #}
        $('#btn-hi-area').button().on('click', function () {
            refresh_areas();

            set_adm_sid_areas('radio');
            $('#btn-area').button().on('click', function () {

                set_areas('', 'hi', 'spn-hi-area', 'adm');
            });
        });

        set_codes_for_selectpicker('hi_fmly_num_cd', 'hi_fmly_num_cd');
        set_year_for_selectpicker('hi_syear', hmsUtil.getYearFromStr(FUNC.HSHOLD_IMGRAT.TIME_START), hmsUtil.getYearFromStr(FUNC.HSHOLD_IMGRAT.TIME_END), 1, true, hmsUtil.getYearFromStr(FUNC.HSHOLD_IMGRAT.TIME_END));
        set_date_for_selectpicker('hi_smonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.HSHOLD_IMGRAT.TIME_END));
        set_year_for_selectpicker('hi_eyear', hmsUtil.getYearFromStr(FUNC.HSHOLD_IMGRAT.TIME_START), hmsUtil.getYearFromStr(FUNC.HSHOLD_IMGRAT.TIME_END), 1, false, hmsUtil.getYearFromStr(FUNC.HSHOLD_IMGRAT.TIME_END));
        set_date_for_selectpicker('hi_emonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.HSHOLD_IMGRAT.TIME_END));
//        {# 지역현황 > 분양현황 > 필터 세팅 #}
        $('#btn-sp-area').button().on('click', function () {
            refresh_areas();

            set_law_sid_areas('radio');
            $('#btn-area').button().on('click', function () {

                set_areas('', 'sp', 'spn-sp-area', 'law');
            });
        });

        set_codes_for_range_slider('sp-area-form', 'sp-exarea-slider', 'sp-exarea-label', 'sp_sexarea', 'sp_eexarea', '면적', '㎡', 0, 500, 10, 0, 500);
        set_year_for_selectpicker('sp_syear', hmsUtil.getYearFromStr(FUNC.SUPPLY_PRESENT.TIME_START), hmsUtil.getYearFromStr(FUNC.SUPPLY_PRESENT.TIME_END), 1, true, hmsUtil.getYearFromStr(FUNC.SUPPLY_PRESENT.TIME_END));
        set_date_for_selectpicker('sp_smonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.SUPPLY_PRESENT.TIME_END));
        set_year_for_selectpicker('sp_eyear', hmsUtil.getYearFromStr(FUNC.SUPPLY_PRESENT.TIME_START), hmsUtil.getYearFromStr(FUNC.SUPPLY_PRESENT.TIME_END), 1, false, hmsUtil.getYearFromStr(FUNC.SUPPLY_PRESENT.TIME_END));
        set_date_for_selectpicker('sp_emonth', 1, 12, hmsUtil.getMonthFromStr(FUNC.SUPPLY_PRESENT.TIME_END));
//        {# 지역현황 > 소득현황 > 필터 세팅 #}
        $('#btn-is-area').button().on('click', function () {
            refresh_areas();

            set_law_sid_areas('radio');
            $('#btn-area').button().on('click', function () {

                set_areas('', 'is', 'spn-is-area', 'law');
            });
        });

//        {# begin of 지도 컨트롤 설정 #}
        $('input:radio[name=rdo-control-all]').click(function () {
            if ($(this).val() === 'true') {
                map.addControl(fullScreenControl);
                map.addControl(zoomSliderControl);
                map.addControl(scaleLineControl);
                map.addControl(viewMarkerControl);
                map.addControl(viewBulkControl);
                map.addControl(setMarkerControl);
                map.addControl(downloadImageControl);
                map.addControl(drawSquareControl);
                map.addControl(drawCircleControl);
                map.addControl(drawPolygonControl);
                map.addControl(searchControl);

                $('.layer-switcher').show();
                $('.ol-zoom').show();

                $('input:radio[name=rdo-control-zbutton][value=true]').prop('checked', true);
                $('input:radio[name=rdo-control-zslider][value=true]').prop('checked', true);
                $('input:radio[name=rdo-control-sline][value=true]').prop('checked', true);
                $('input:radio[name=rdo-control-fscreen][value=true]').prop('checked', true);
                $('input:radio[name=rdo-control-lswitcher][value=true]').prop('checked', true);
//                $('input:radio[name=rdo-control-ovmap][value=true]').prop('checked', true);
                $('input:radio[name=rdo-control-polygon][value=true]').prop('checked', true);
                $('input:radio[name=rdo-control-marker][value=true]').prop('checked', true);

            } else {
                map.removeControl(fullScreenControl);
                map.removeControl(zoomSliderControl);
                map.removeControl(scaleLineControl);
                map.removeControl(viewMarkerControl);
                map.removeControl(viewBulkControl);
                map.removeControl(setMarkerControl);
                map.removeControl(downloadImageControl);
                map.removeControl(drawSquareControl);
                map.removeControl(drawCircleControl);
                map.removeControl(drawPolygonControl);
                map.removeControl(drawCircleControl);
                map.removeControl(drawPolygonControl);
                map.removeControl(searchControl);

                $('.layer-switcher').hide();
                $('.ol-zoom').hide();

                $('input:radio[name=rdo-control-zbutton][value=false]').prop('checked', true);
                $('input:radio[name=rdo-control-zslider][value=false]').prop('checked', true);
                $('input:radio[name=rdo-control-sline][value=false]').prop('checked', true);
                $('input:radio[name=rdo-control-fscreen][value=false]').prop('checked', true);
                $('input:radio[name=rdo-control-lswitcher][value=false]').prop('checked', true);
//                $('input:radio[name=rdo-control-ovmap][value=false]').prop('checked', true);
                $('input:radio[name=rdo-control-polygon][value=false]').prop('checked', true);
                $('input:radio[name=rdo-control-marker][value=false]').prop('checked', true);
            }
        });


        $('input:radio[name=rdo-control-zbutton]').click(function () {
            let $olZoom = $('.ol-zoom');
            $(this).val() !== 'true' ? $olZoom.hide() : $olZoom.show();
        });
        $('input:radio[name=rdo-control-zslider]').click(function () {
            $(this).val() === 'true' ? map.addControl(zoomSliderControl) : map.removeControl(zoomSliderControl);
        });
        $('input:radio[name=rdo-control-sline]').click(function () {
            $(this).val() === 'true' ? map.addControl(scaleLineControl) : map.removeControl(scaleLineControl);
        });
        $('input:radio[name=rdo-control-fscreen]').click(function () {
            $(this).val() === 'true' ? map.addControl(fullScreenControl) : map.removeControl(fullScreenControl);
        });
        $('input:radio[name=rdo-control-lswitcher]').click(function () {
            let $layerSwitcher = $('.layer-switcher');
            $(this).val() === 'true' ? $layerSwitcher.show() : $layerSwitcher.hide();
        });
//        $('input:radio[name=rdo-control-ovmap]').click(function () {
//            $(this).val() === 'true' ? map.addControl(overviewMapControl) : map.removeControl(overviewMapControl);
//        });
        $('input:radio[name=rdo-control-imgdwl]').click(function () {
            $(this).val() === 'true' ? map.addControl(downloadImageControl) : map.removeControl(downloadImageControl);
        });
        $('input:radio[name=rdo-control-polygon]').click(function () {
            if ($(this).val() === 'true') {
                map.addControl(drawPolygonControl);
                map.addControl(drawSquareControl);
                map.addControl(drawCircleControl);
            } else {
                map.removeControl(drawPolygonControl);
                map.removeControl(drawSquareControl);
                map.removeControl(drawCircleControl);
            }
        });
        $('input:radio[name=rdo-control-marker]').click(function () {
            if ($(this).val() === 'true') {
                map.addControl(viewMarkerControl);
                map.addControl(setMarkerControl);
            } else {
                map.removeControl(viewMarkerControl);
                map.removeControl(setMarkerControl);
            }
        });

        set_codes_for_slider('hmap-radius', 'htmap-radius-slider', 'htmap-radius-label', '히트맵 크기',
            'pixcel', 10, 100, 10, 50);

//        {# end of 지도 컨트롤 설정 #}
    });
    //    {# end of document.ready #}


        function addAllControl() {
            map.addControl(fullScreenControl);
            map.addControl(zoomSliderControl);
            map.addControl(scaleLineControl);
            map.addControl(viewMarkerControl);
            map.addControl(viewBulkControl);
            map.addControl(setMarkerControl);
            map.addControl(downloadImageControl);
            map.addControl(drawSquareControl);
            map.addControl(drawCircleControl);
            map.addControl(drawPolygonControl);
            map.addControl(searchControl);

            $('.layer-switcher').show();
            $('.ol-zoom').show();
            $('input:radio[name=rdo-control-all][value-true]').prop('checked', true);
            $('input:radio[name=rdo-control-zbutton][value=true]').prop('checked', true);
            $('input:radio[name=rdo-control-zslider][value=true]').prop('checked', true);
            $('input:radio[name=rdo-control-sline][value=true]').prop('checked', true);
            $('input:radio[name=rdo-control-fscreen][value=true]').prop('checked', true);
            $('input:radio[name=rdo-control-lswitcher][value=true]').prop('checked', true);
            $('input:radio[name=rdo-control-polygon][value=true]').prop('checked', true);
            $('input:radio[name=rdo-control-marker][value=true]').prop('checked', true);
        }

        function removeAllControl() {
            map.removeControl(fullScreenControl);
            map.removeControl(zoomSliderControl);
            map.removeControl(scaleLineControl);
            map.removeControl(viewMarkerControl);
            map.removeControl(viewBulkControl);
            map.removeControl(setMarkerControl);
            map.removeControl(downloadImageControl);
            map.removeControl(drawSquareControl);
            map.removeControl(drawCircleControl);
            map.removeControl(drawPolygonControl);
            map.removeControl(drawCircleControl);
            map.removeControl(drawPolygonControl);
            map.removeControl(searchControl);

            $('.layer-switcher').hide();
            $('.ol-zoom').hide();

            $('input:radio[name=rdo-control-all][value=false]').prop('checked', true);
            $('input:radio[name=rdo-control-zbutton][value=false]').prop('checked', true);
            $('input:radio[name=rdo-control-zslider][value=false]').prop('checked', true);
            $('input:radio[name=rdo-control-sline][value=false]').prop('checked', true);
            $('input:radio[name=rdo-control-fscreen][value=false]').prop('checked', true);
            $('input:radio[name=rdo-control-lswitcher][value=false]').prop('checked', true);
            $('input:radio[name=rdo-control-polygon][value=false]').prop('checked', true);
            $('input:radio[name=rdo-control-marker][value=false]').prop('checked', true);
        }

    //    {# Initialize JQuery UI Layout plug - in #}
    $('html').css('height', '100%');
    $('body').css('height', '100%');
    $('#main').css('height', '97%');
    $('#main').layout({
        west__size: '18%',
        west__resizable: false,
        west__onclose_start: function () {
            resetControl('ol-zoom', 'left', '0.5%');
            resetControl('ol-zoomslider', 'left', '0.5%');
            resetControl('ol-scale-line', 'left', '0.5%');
            resetControl('ctl-addr-search', 'left', '3.5%');
            resetControl('ctl-draw-circle', 'left', '0.5%');
            resetControl('ctl-draw-square', 'left', '2.7%');
            resetControl('ctl-draw-polygon', 'left', '4.9%');
            resetControl('ctl-bulk-view', 'left', '0.5%');
            resetControl('ctl-marker-view', 'left', '2.7%');
            resetControl('ctl-marker-set', 'left', '4.9%');
            resetControl('ctl-card-view', 'left', '0.5%');
            resetControl('ctl-list-view', 'left', '2.7%');
        },
        east__size: '18%',
        east__resizable: false,
        east__onclose_start: function () {
            resetControl('ol-full-screen', 'right', '0.5%');
            resetControl('layer-switcher', 'right', '0.5%');
            resetControl('ol-overviewmap', 'right', '0.5%');
            resetControl('ol-overviewmap', 'right', '0.5%');

        },
        south__size: '1%',
        south__minSize: '4%',
        south__maxSize: '99%',
        south__zIndex: 99,

        west__onresize: function () {
            $.layout.callbacks.resizePaneAccordions;
            resetControl('ol-zoom', 'left', '18.5%');
            resetControl('ol-zoomslider', 'left', '18.5%');
            resetControl('ol-scale-line', 'left', '18.5%');
            resetControl('ctl-addr-search', 'left', '21.5%');
            resetControl('ctl-draw-circle', 'left', '18.5%');
            resetControl('ctl-draw-square', 'left', '21%');
            resetControl('ctl-draw-polygon', 'left', '23.5%');
            resetControl('ctl-bulk-view', 'left', '18.5%');
            resetControl('ctl-marker-view', 'left', '21%');
            resetControl('ctl-marker-set', 'left', '23.5%');
            resetControl('ctl-card-view', 'left', '18.5%');
            resetControl('ctl-list-view', 'left', '21%');
        },
        east__onresize: function () {
            $.layout.callbacks.resizePaneAccordions
            resetControl('ol-full-screen', 'right', '18.5%');
            resetControl('layer-switcher', 'right', '18.5%');
            resetControl('ol-overviewmap', 'right', '18.5%');
        },
        south__onclose_start: function () {
            if (this.isClosed) {
                this.isClosed = false;
                $('#main').layout().sizePane('south', '1%');
                $('.ui-layout-toggler-south-closed').removeClass('ui-layout-toggler-south-closed').addClass('ui-layout-toggler-south-open');
            } else {
                this.isClosed = true;
                $('#main').layout().sizePane('south', '99%');
                $('.ui-layout-toggler-south-open').removeClass('ui-layout-toggler-south-open').addClass('ui-layout-toggler-south-closed');
            }
            return false;
        },
    });

    let $westAccordion = $('#west-accordion');
    $westAccordion.accordion({heightStyle: 'content'});
    $('#east-accordion').accordion({heightStyle: 'content'});

    // 아코디언 변경 추적
    $westAccordion.find("> h3").on('click', function () {
        $.each($(this).children(), function (i, element) {
            if ($(element).is('a')) {
                var target = $(this).text();
                let isTargetSet = false;
                $.each(FUNC, function (i, item){
                    if (item['KOR_NAME'] === target) {
                        item['CODE_STYLE'] ? codeStyle = item['CODE_STYLE'] : alert('Not My target');
                        isTargetSet = true;
                    }
                    if (isTargetSet) {
                        // break;
                        return false;
                    }
                });
            }
        });
    });

    // TODO : 이거 시퀀스 개꼬인듯;
    var Interval = '';
    function playTimeBar() {
        Interval = setInterval(function () {
            if (heatMapSlider.current >= heatMapSlider.end) {

                clearInterval(Interval);
                return false;
            }

            let currentValue = $('#slider-range').slider("values")[0];
            $('#slider-range').slider('values', 0, currentValue + 1);
            let date = heatMapSlider.currentDate;
            date.setMonth(date.getMonth() + 1);

            $("#custom-handle").text(date.getFullYear() + '년' + (date.getMonth() + 1) + '월');
            heatMapSlider.current++

            if (heatMapSlider.current % 100 > 12) {
                heatMapSlider.current = heatMapSlider.current + 100 - 12;
            }

            setTimeBarGeoHeatMap(heatMapSlider.layer, heatMapSlider.cql, date);
        }, 1000);
    };

    function pauseTimeBar() {
        clearInterval(Interval);
    }

    function stopTimeBar() {
        clearInterval(Interval);
        $('#slider-range').slider('values', 0, 0);
        let date = parse(heatMapSlider.start + '01');
        $("#custom-handle").text(date.getFullYear() + '년' + (date.getMonth() + 1) + '월');
        heatMapSlider.currentDate = date;
        heatMapSlider.current = heatMapSlider.start;
        setTimeBarGeoHeatMap(heatMapSlider.layer, heatMapSlider.cql, date);
    }

    function resetControl(class_name, target_css, value) {
        $('.' + class_name).css(target_css, value);
    }

    let hmsMap = new HmsMap(VWORLD_API_KEY, DOMAIN);

    let invisibleMap = hmsMap.getInvisibleMap();
    var distAreaMap = hmsMap.getDistAreaMap();

    let layers = [
        hmsMap.getMidnightMap(),
        hmsMap.getGrayMap(),
        hmsMap.getSatelliteMap(),
        hmsMap.getBaseMap(),
    ];

    let hybridLayer = [
        invisibleMap,
        distAreaMap,
        hmsMap.getJijeockMap(),
        hmsMap.getUserPlanMap(),
        hmsMap.getHybridMap(),
    ];

    function updateDistAreaLayer(locationType, featureIds) {
        // TODO : 이거 레이어 지웠다가 넣는 방법 고안할 것

        var layerTarget = '';
        if (locationDepth === 'sid') {
            layerTarget = 'sgg'
        } else if (locationDepth === 'sgg') {
            layerTarget = 'emd'
        } else if (locationDepth === 'emd') {
            layerTarget = 'emd'
        }

        var layers = 'hms:' + locationType + '_' + layerTarget + "_area";

        distAreaMap.getSource().updateParams({
            'layers': layers,
            'featureid': featureIds
        });
    }

    var fullScreenControl = new ol.control.FullScreen({
        tipLabel: '최대 화면'
    });
    var zoomSliderControl = new ol.control.ZoomSlider();
    var scaleLineControl = new ol.control.ScaleLine();

    var layerSwitcherControl = new ol.control.LayerSwitcher({
        tipLabel: '레이어 스위처'
    });

    window.app = {};
    var app = window.app;

    /******************************** View Marker Controller Start ********************************/
    var viewMarkerVL = new ol.layer.Vector({
        title: MAP.GET_MARKER.NAME,
        zIndex: MAP.GET_MARKER.ZINDEX,
    });

    var viewMarkerFlag = false;
    app.viewMarkerControl = function (opt_options) {
        var options = opt_options || {};

        var button = document.createElement('button');
        button.setAttribute('title', MAP.GET_MARKER.NAME);
        button.innerHTML = '<i class="fa fa-eye" aira-hidden="true"></i>';

        var viewMarkerControl = function () {
            if (viewMarkerFlag === false) {
                viewMarkerFlag = true;
                $('.ctl-marker-view').children().first().css('background-color', 'rgba(0, 0, 0, 0.7)');

                $.ajax({
                    method: 'POST',
                    url: '{{ url_for("situation.get_categorys") }}',
                    dataType: 'json'
                }).done(function (data) {
                    let results = [];
                    $.each(data.rows, function (i, item) {
                        let category = '';
                        item.category === '' ?  category = '구분없음' : category = item.category;
                        results.push(`<option value="${item.category}">${category}</option>`);
                    });
                    $('#mdl-viewMarker-sp').html(results.join('')).selectpicker('refresh');
                });

                hmsUi.showModal('mdl-viewMarker-area')
            } else {
                viewMarkerFlag = false;
                $('.ctl-marker-view').children().first().css('background-color', 'rgba(57, 152, 156, .7)');

                closeViewMarkerPopup();
                map.removeLayer(viewMarkerVL);
            }
        };

        button.addEventListener('click', viewMarkerControl, false);
        button.addEventListener('touchstart', viewMarkerControl, false);

        var element = document.createElement('div');
        element.className = 'ctl-marker-view ol-unselectable ol-control';
        element.appendChild(button);

        ol.control.Control.call(this, {
            element: element,
            target: options.target
        });
    };

    $('#btn-viewMarker-submit').on('click', function () {
        if (viewMarkerFlag) {
            $.ajax({
                method: 'POST',
                url: '{{ url_for("situation.view_marker") }}',
                data: $('#frm-viewMarker').serialize(),
                dataType: 'json'
            }).done(function (data) {
                let featureArr = [];

                $.each(data.rows, function (i, item) {
                    let iconFeature = new ol.Feature({
                        geometry: new ol.geom.Point(item.geom),
                        id: item.idx,
                        population: 4000,
                        rainfall: 500
                    });

                    iconFeature.set('category', item.category);
                    iconFeature.set('title', item.title);
                    iconFeature.set('content', item.content);

                    let baseSourceUrl = "{{url_for('static', filename='images/marker/') }}";
                    let iconStyle = new ol.style.Style({
                        image: new ol.style.Icon(({
                            anchor: [0.5, 0.5],
                            anchorXUnits: 'fraction',
                            anchorYUnits: 'fraction',
                            scale: 0.7,
    //                        opacity : 0.5,
                            src: baseSourceUrl + 'icon_64/' + item.img_name
                        })),
                        text: new ol.style.Text({
                            font: 'bold 16px Calibri, sans-serif',
                            fill: new ol.style.Fill({color: '#000'}),
                            stroke: new ol.style.Stroke({
                                color: '#fff', width: 5
                            }),
                            text: item.title,
                            offsetY: 30
                        })
                    });

                    iconFeature.setStyle(iconStyle);

                    featureArr.push(iconFeature);
                });

                let vectorSource = new ol.source.Vector({
                    features: featureArr
                });

                viewMarkerVL.setSource(vectorSource);

                targetLayer = viewMarkerVL;
                map.addLayer(viewMarkerVL);
            });
        }
    });

    ol.inherits(app.viewMarkerControl, ol.control.Control);
    /******************************** View Marker Controller End ********************************/


    /******************************** View Bulk Controller Start ********************************/
    let viewBulkVL = new ol.layer.Vector({
        title: MAP.GET_MARKER.NAME,
        zIndex: MAP.GET_MARKER.ZINDEX,
    });

    let viewBulkFlag = false;
    app.viewBulkControl = function (opt_options) {
        let options = opt_options || {};

        let button = document.createElement('button');
        button.setAttribute('title', MAP.GET_MARKER.NAME + '-벌크');
        button.innerHTML = '<i class="fa fa-street-view" aira-hidden="true"></i>';

        let viewBulkControl = function() {
            if(viewBulkFlag === false) {
                viewBulkFlag = true;

                $('.ctl-bulk-view').children().first().css('background-color', 'rgba(0, 0, 0, 0.7)');

                $.ajax({
                    method: 'POST',
                    url: '{{ url_for("bulk_upload.get_bulk_categorys") }}',
                    data: {userId: '102'},
                    dataType: 'json'
                }).done(function (data) {
                    var results = [];
                    $.each(data.rows, function (i, item) {
                        if (item.category === '') {
                            results.push(`<option value="${item.category}">구분 없음</option>`);
                        } else {
                            results.push(`<option value="${item.category}">${item.category}</option>`);
                        }
                    });
                    $('#mdl-viewMarker-sp').html(results.join('')).selectpicker('refresh');
                });

                hmsUi.showModal('mdl-viewMarker-area')
            } else {
                viewBulkFlag = false;
                $('.ctl-bulk-view').children().first().css('background-color', 'rgba(57, 152, 156, .7)');

                map.removeLayer(viewBulkVL);
            }
        };

        button.addEventListener('click', viewBulkControl, false);
        button.addEventListener('touchstart', viewBulkControl, false);

        let element = document.createElement('div');
        element.className = 'ctl-bulk-view ol-unselectable ol-control';
        element.appendChild(button);

        ol.control.Control.call(this, {
            element: element,
            target: options.target
        });
    };

    $('#btn-viewMarker-submit').on('click', function () {
        if (viewBulkFlag){
            $.ajax({
                method: 'POST',
                url: '{{ url_for("bulk_upload.get_bulks") }}',
                data: $('#frm-viewMarker').serialize(),
                dataType: 'json'
            }).done(function (data) {
                let featureArr = [];

                $.each(data.rows, function (i, item) {
                    let iconFeature = new ol.Feature({
                        geometry: new ol.geom.Point(item.geom),
                        id: item.idx,
                        population: 4000,
                        rainfall: 500
                    });

                    iconFeature.set('group', 'viewBulk');
                    iconFeature.set('item', item);

                    let title = item.title ? item.title : '';

                    let baseSourceUrl = "{{url_for('static', filename='images/marker/') }}";
                    let iconStyle = new ol.style.Style({
                        image: new ol.style.Icon(({
                            anchor: [0.5, 0.5],
                            anchorXUnits: 'fraction',
                            anchorYUnits: 'fraction',
                            scale: 0.7,
    //                        opacity : 0.5,
                            src: baseSourceUrl + 'icon_64/' + item.img_name
                        })),
                    });

                    if(title) {
                        iconStyle.setText(new ol.style.Text({
                            font: 'bold 16px Calibri, sans-serif',
                            fill: new ol.style.Fill({color: '#000'}),
                            stroke: new ol.style.Stroke({
                                color: '#fff', width: 5
                            }),
                            // get the text from the feature - `this` is ol.Feature
                            // and show only under certain resolution
                            text: item.title,
                            offsetY: 30})
                        )
                    }

                    iconFeature.setStyle(iconStyle);
    //
                    featureArr.push(iconFeature);
                });

                let vectorSource = new ol.source.Vector({
                    features: featureArr
                });
    //
                viewBulkVL.setSource(vectorSource);
    //
                targetLayer = viewBulkVL;

                map.addLayer(viewBulkVL);
            });
        }
    });

    ol.inherits(app.viewBulkControl, ol.control.Control);
    /******************************** View Bulk Controller End ********************************/


    /******************************** Set Marker Controller Start ********************************/
    var markerAvailable = false;
    var markerGeom = '';
    var markerSelectedImg = '';
    app.setMarkerControl = function (opt_options) {
        var options = opt_options || {};

        var button = document.createElement('button');
        button.setAttribute('title', MAP.SET_MARKER.NAME);
        button.innerHTML = '<i class="fa fa-map-marker" aira-hidden="true"></i>';

        var toggleMarkerAvailable = function () {
            if (markerAvailable === false) {
                markerAvailable = true;

                map.addLayer(setMarkerLayer);
                $('.ctl-marker-set').children().first().css('background-color', 'rgba(0, 0, 0, 0.7)');
                set_marker_images();
                hmsUi.showModal('mdl-markerImg-area');
            } else {
                markerAvailable = false;
                markerSelectedImg = '';
                markerGeom = '';

                closeSetMarkerPopup();
                map.removeLayer(setMarkerLayer);
                $('.ctl-marker-set').children().first().css('background-color', 'rgba(57, 152, 156, .7)');
            }
        };

        button.addEventListener('click', toggleMarkerAvailable, false);
        button.addEventListener('touchstart', toggleMarkerAvailable, false);

        var element = document.createElement('div');
        element.className = 'ctl-marker-set ol-unselectable ol-control';
        element.appendChild(button);

        ol.control.Control.call(this, {
            element: element,
            target: options.target
        });
    };
    ol.inherits(app.setMarkerControl, ol.control.Control);
    /******************************** Set Marker Controller End ********************************/


    /******************************** Download img Controller Start ********************************/
    app.downloadImageControl = function (opt_options) {
        var options = opt_options || {};

        var button = document.createElement('button');
        button.innerHTML = '<i class="fa fa-download" aria-hidden="true"></i>';

        var clickDownloadImageController = function () {
            alert('미구현 기능');
//            ImageDownload();
            var dt = document.getElementById('mapCanvas');
//            dt.msToBlob();

            dt.toBlob(function (blob) {
                saveAs(blob, 'map.png');
            });

            var img = new Image();
            img.setAttribute('crossOrigin')
            dt.replace(/^data:image\/[^;]/, 'data:application/octet-stream');
        };

        button.addEventListener('click', clickDownloadImageController, false);
        button.addEventListener('touchstart', clickDownloadImageController, false);

        var element = document.createElement('div');
        element.className = 'img-downloader ol-unselectable ol-control';
        element.setAttribute('id', 'downloadImageControl');
        element.appendChild(button);

        ol.control.Control.call(this, {
            element: element,
            target: options.target
        });
    };

    function ImageDownload() {
        try {
            var can = document.getElementById('mapCanvas');
            var ctx = can.getContext('2d');
            document.location.href = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
//            var img = new Image();
//            img.crossOrigin = '';
//
//            img.src = 'http://lobbydata.com/Content/images/bg_price2.gif';
        } catch (ex) {
            alert(ex);
        }

        img.onload = function () {
            try {
                var start = new Date().getTime();
                can.width = img.width;
                can.height = img.height;
                ctx.drawImage(img, 0, 0, img.width, img.height);
                var url = can.toDataURL(); // if read succeeds, canvas isn't dirty.
                //get pixels
                var imgd = ctx.getImageData(0, 0, img.width, img.width);
                var pix = imgd.data;
                var len = pix.length;
                var argb = []; //pixels as int
                for (var i = 0; i < len; i += 4) {
                    argb.push((pix[i + 3] << 24) + (pix[i] << 16) + (pix[i + 1] << 8) + pix[i + 2]);
                }
                var end = new Date().getTime();
                var time = end - start;
                document.getElementById("results").innerHTML = "<span style='color:Green;'>" +
                    "Success: Your browser supports CORS for cross domain images in Canvas <br>" +
                    "Read " + argb.length + " pixels in " + time + "ms</span>";
            } catch (ex) {
                document.getElementById("results").innerHTML = "<span style='color:Red;'>Failed: " + ex + "</span>";
            }
        }
    }

    ol.inherits(app.downloadImageControl, ol.control.Control);
    /******************************** Download img Controller End ********************************/


    /******************************** Draw Controller Bar End ********************************/
    var drawControlBar = new ol.control.Bar({});
    /******************************** Draw Controller Bar End ********************************/

    function set_polygon_search(centroid, geom) {
        let geojson = new ol.format.GeoJSON({
            geometryName: 'actualGeometry',
            defaultDataProjection :'EPSG:4326',
            featureProjection: 'EPSG:4326'
        });

        let result = {};
        $.ajax({
            method: 'POST',
            url: '{{ url_for("situation.srch_summary") }}',
            data: 'geom=' +  geojson.writeGeometry(geom),
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
            }
        }).done(function (data) {
            result = data;

            result.ts_yyyymm = Number(result.ts_yyyymm) / 100;

            if(!result.popltn_sum) {
                result.popltn_sum = "데이터가 없습니다."
            } else {
                result.popltn_sum = hmsUtil.setComma(result.popltn_sum) + ' (명)';
            }

            if (!result.in_popltn_sum) {
                result.in_popltn_sum = "데이터가 없습니다."
            } else {
                result.in_popltn_sum = hmsUtil.setComma(result.in_popltn_sum) + ' (명)';
            }

            if (!result.out_popltn_sum) {
                result.out_popltn_sum = "데이터가 없습니다."
            } else {
                result.out_popltn_sum = hmsUtil.setComma(result.out_popltn_sum) + ' (명)';
            }

            if  (!result.trnstn_amount_sum) {
                result.trnstn_amount_sum = "데이터가 없습니다."
            } else {
                result.trnstn_amount_sum = hmsUtil.setComma(result.trnstn_amount_sum) + ' (건)';
            }

            if (!result.trnstn_price_avg) {
                result.trnstn_price_avg = "데이터가 없습니다."
            } else {
                result.trnstn_price_avg = hmsUtil.setComma(result.trnstn_price_avg.toFixed(0)) + ' (만 원)';
            }

            if (!result.household_sum) {
                result.household_sum = "데이터가 없습니다."
            } else {
                result.household_sum = hmsUtil.setComma(result.household_sum) + ' (세대)';
            }

            if (!result.self_emp_sum) {
                result.self_emp_sum = "데이터가 없습니다."
            } else {
                result.self_emp_sum = hmsUtil.setComma(result.self_emp_sum) + ' (개)';
            }

            if (!result.parcel_area_sum) {
                result.parcel_area_sum = "데이터가 없습니다."
            } else {
                result.parcel_area_sum = hmsUtil.setComma(result.parcel_area_sum) + ' (개)';
            }

            if (!result.parcel_trnstn_sum) {
                result.parcel_trnstn_sum = "데이터가 없습니다."
            } else {
                result.parcel_trnstn_sum = hmsUtil.setComma(result.parcel_trnstn_sum) + ' (세대)';
            }

            if (!result.floor_price_avg) {
                result.floor_price_avg = "데이터가 없습니다."
            } else {
                result.floor_price_avg = hmsUtil.setComma(result.floor_price_avg) + ' (만 원)';
            }

            if (!result.labor_sum) {
                result.labor_sum = "데이터가 없습니다."
            } else {
                result.labor_sum = hmsUtil.setComma(result.labor_sum) + ' (명)';
            }

            if (!result.income_avg) {
                result.income_avg = "데이터가 없습니다."
            } else {
                result.income_avg = hmsUtil.setComma(result.income_avg) + ' (원)';
            }

            let resultContent = '';
                resultContent += '<br>' +
                    '<table class="table table-condensed">' +
                        '<tr>' +
                            '<th class="text-center">구분</th>' +
                            '<th class="text-center">데이터</th>' +
                            '<th class="text-center">기준 년월</th>' +
                        '</tr>' +
                        '<tr>' +
                            '<td class="text-center" style="vertical-align: middle;"><span title=""><strong>'+ FUNC.POPLTN_STATS.KOR_NAME +'</strong></span></td>' +
                            '<td><strong>총 인구수</strong> : ' + result.popltn_sum + '</td>' +
                            '<td class="text-center">' + hmsUtil.getDateToKor(result.ps_yyyymm) + '</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<td rowspan="2" class="text-center" style="vertical-align: middle;"><strong>'+ FUNC.POPLTN_MVMT.KOR_NAME +'</strong></td>' +
                            '<td><strong>총 전입자</strong> : ' + result.in_popltn_sum +  '</td>' +
                            '<td class="text-center">' + hmsUtil.getDateToKor(result.pm_yyyymm) + '</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<td><strong>총 전출자</strong> : ' + result.out_popltn_sum + '</td>' +
                            '<td class="text-center">' + hmsUtil.getDateToKor(result.pm_yyyymm) + '</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<td rowspan="2" class="text-center" style="vertical-align: middle;"><strong>'+ '수요분석' +'</strong></td>' +
                            '<td><strong>총 거래량</strong> : ' + result.trnstn_amount_sum + '</td>' +
                            '<td class="text-center">' + hmsUtil.getDateToKor(result.ts_yyyymm) + '</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<td><strong>평균 거래가</strong> : ' + result.trnstn_price_avg + '</td>' +
                            '<td class="text-center">' + hmsUtil.getDateToKor(result.ts_yyyymm) + '</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<td class="text-center" style="vertical-align: middle;"><strong>' + FUNC.IDNFTN_BLDNG.KOR_NAME + '</strong></td>' +
                            '<td><strong>총 입주 세대수</strong> : ' + result.household_sum + '</td>' +
                            '<td class="text-center">' + hmsUtil.getDateToKor(result.hi_yyyymm) + '</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<td class="text-center" style="vertical-align: middle;"><strong>'+ FUNC.BUSINS_SITUTN.KOR_NAME +'</strong></td>' +
                            '<td><strong>자영업소수</strong> : ' + result.self_emp_sum + '</td>' +
                            '<td class="text-center">' + hmsUtil.getDateToKor(result.bs_yyyymm) + '</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<td class="text-center" style="vertical-align: middle;"><strong>'+ FUNC.HSHOLD_IMGRAT.KOR_NAME +'</strong></td>' +
                            '<td><strong>세대수</strong> : ' + result.household_sum + '</td>' +
                            '<td class="text-center">' + hmsUtil.getDateToKor(result.hi_yyyymm) + '</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<td rowspan="3" class="text-center" style="vertical-align: middle;"><strong>'+ FUNC.SUPPLY_PRESENT.KOR_NAME +'</strong></td>' +
                            '<td><strong>분양 단지 수</strong> : ' + result.parcel_area_sum + '</td>' +
                            '<td class="text-center">' + hmsUtil.getDateToKor(result.sp_yyyymm) + '</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<td><strong>분양 세대 수</strong> : ' + result.parcel_trnstn_sum + '</td>' +
                            '<td class="text-center">' + hmsUtil.getDateToKor(result.sp_yyyymm) + '</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<td><strong>평균 평당가</strong> : ' + result.floor_price_avg + '</td>' +
                            '<td class="text-center">' + hmsUtil.getDateToKor(result.sp_yyyymm) + '</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<td rowspan="2" class="text-center" style="vertical-align: middle;"><strong>'+ FUNC.INCOME_SITUTN.KOR_NAME +'</strong></td>' +
                            '<td><strong>총 종사자 수</strong> : ' + result.labor_sum + '</td>' +
                            '<td class="text-center">' + hmsUtil.getDateToKor(result.is_yyyymm) + '</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<td><strong>평균 추정 연봉</strong> : ' + result.income_avg + '</td>' +
                            '<td class="text-center">' + hmsUtil.getDateToKor(result.is_yyyymm) + '</td>' +
                        '</tr>' +
                    '</table>';

            polygonPopupContent.innerHTML = resultContent;
            polygonPopupOverlay.setPosition(centroid);

        });
    }
    /******************************** Draw Square Controller Start ********************************/
    var drawSquareFlag = false;
    app.drawSquareControl = function (opt_options) {
        var options = opt_options || {};

        var button = document.createElement('button');
        button.setAttribute('title', MAP.SET_SQUARE.NAME);
        button.innerHTML = '<i class="fa fa-square-o" aria-hidden="true"></i>';

        var drawSqaureController = function () {
            if (drawSquareFlag === false) {
                drawSquareAble();
                if (drawSquareFlag) {
                    drawSquareFN();
                }

            } else {
                drawSquareDisable();
            }
        };

        button.addEventListener('click', drawSqaureController, false);
        button.addEventListener('touchstart', drawSqaureController, false);

        var element = document.createElement('div');
        element.className = 'ctl-draw-square ol-unselectable ol-control';
        element.setAttribute('id', 'drawSquareControl');
        element.appendChild(button);

        ol.control.Control.call(this, {
            element: element,
            target: options.target
        })
    };

    ol.inherits(app.drawSquareControl, ol.control.Control);

    var drawSquareAble = function () {
        drawSquareFlag = true;
        drawCircleFlag = false;
        drawPolygonFlag = false;
        $('.ctl-draw-square').children().first().css('background-color', 'rgba(0, 0, 0, 0.7)');

        drawCircleDisable();
        drawPolygonDisable();
    };

    var drawSquareDisable = function () {
        drawSquareFlag = false;
        map.removeInteraction(drawSquareI);

        if (hasMapOverlayByTitle(MAP.SET_SQUARE.NAME)) {
            map.removeLayer(drawSquareVL);
        }
        closePolygonPopup();
        $('.ctl-draw-square').children().first().css('background-color', 'rgba(57, 152, 156, .7)');
    };

    var drawSquareVL;
    var drawSquareI;
    var drawSquareFN = function () {
        if (hasMapOverlayByTitle(MAP.SET_SQUARE.NAME)) {
            map.removeLayer(drawSquareVL);
        }

        drawSquareI = undefined;
        drawSquareVL = undefined;

        drawSquareVL = new ol.layer.Vector({
            title: MAP.SET_SQUARE.NAME,
            source: new ol.source.Vector(),
            style: new ol.style.Style({
                fill: new ol.style.Fill({
                    color: COLOR.DRAW.FILL
                }),
                stroke: new ol.style.Stroke({
                    color: COLOR.DRAW.STROKE,
                    width: 2
                })
            }),
            zIndex: MAP.SET_SQUARE.ZINDEX
        });

        map.addLayer(drawSquareVL);

        drawSquareI = new ol.interaction.DrawRegular({
            source: drawSquareVL.getSource(),
            sides: 4,
            canRoate: true
        });
        drawSquareI.title = 'drawSquareInteraction';

        map.addInteraction(drawSquareI);

        targetLayer = drawSquareVL;
        drawSquareI.on('drawstart', function (e) {
        });

        drawSquareI.on('drawend', function (evt) {
            let squareFeatre = evt.feature;
            let squareGeom = squareFeatre.getGeometry();
            let squareExtent = squareGeom.getExtent();
            let squareCenter = ol.extent.getCenter(squareExtent);

            set_polygon_search(squareCenter, squareGeom);
        });
    };
    /******************************** Draw Square Controller End ********************************/

    var hasMapOverlayByTitle = function (title) {
        var layers = map.getLayers();
        for (i = 0, n = layers.getLength(); i < n; i++) {

            var layer = layers.a[i];
            if (layer.S.title === title) {
                return true
            }
        }
    };

    var hasMapInteractionByx = function () {
        var interaction = map.getInteractions();

        map.getInteractions().forEach(function (interaction) {
            if (interaction instanceof ol.interaction.DrawRegular) {
            }
        });
    };

    /******************************** Draw Circle Controller Start ********************************/
    var drawCircleFlag = false;
    app.drawCircleControl = function (opt_options) {
        var options = opt_options || {};

        var button = document.createElement('button');
        button.setAttribute('title', MAP.SET_CIRCLE.NAME);
        button.innerHTML = '<i class="fa fa-circle-o" aria-hidden="true"></i>';

        var drawCircleController = function () {
            if (drawCircleFlag === false) {
                drawCircleAble();
                if (drawCircleFlag) {
                    drawCircleFN();
                }

            } else {
                drawCircleDisable();
            }
        };

        button.addEventListener('click', drawCircleController, false);
        button.addEventListener('touchstart', drawCircleController, false);

        var element = document.createElement('div');
        element.className = 'ctl-draw-circle ol-unselectable ol-control';
        element.setAttribute('id', 'drawCircleControl');
        element.appendChild(button);

        ol.control.Control.call(this, {
            element: element,
            target: options.target
        });
    };

    ol.inherits(app.drawCircleControl, ol.control.Control);

    var drawCircleAble = function () {
        drawCircleFlag = true;
        drawSquareFlag = false;
        drawPolygonFlag = false;
        $('#drawCircleControl').children().first().css('background-color', 'rgba(0, 0, 0, 0.7)');

        drawSquareDisable();
        drawPolygonDisable();
    };

    var drawCircleDisable = function () {
        drawCircleFlag = false;
        map.removeInteraction(drawCircleI);

        if (hasMapOverlayByTitle(MAP.SET_CIRCLE.NAME)) {
            map.removeLayer(drawCircleVL);
        }

        closePolygonPopup();
        $('.ctl-draw-circle').children().first().css('background-color', 'rgba(57, 152, 156, .7)');
    };

    var drawCircleVL;
    var drawCircleI;
    var drawCircleFN = function () {
        if (hasMapOverlayByTitle(MAP.SET_CIRCLE.NAME)) {
            map.removeLayer(drawCircleVL);
        }

        drawCircleVL = undefined;
        drawCircleI = undefined;

        drawCircleVL = new ol.layer.Vector({
            title: MAP.SET_CIRCLE.NAME,
            source: new ol.source.Vector(),
            style: new ol.style.Style({
                fill: new ol.style.Fill({
                    color: COLOR.DRAW.FILL
                }),
                stroke: new ol.style.Stroke({
                    color: COLOR.DRAW.STROKE,
                    width: 2
                })
            }),
            zIndex: MAP.SET_CIRCLE.ZINDEX
        });

        map.addLayer(drawCircleVL);

        drawCircleI = new ol.interaction.DrawRegular({
            source: drawCircleVL.getSource(),
            canRotate: true
        });

        map.addInteraction(drawCircleI);

        targetLayer = drawCircleVL;
        drawCircleI.on('drawstart', function (e) {

        });

        drawCircleI.on('drawend', function (evt) {
            let circleFeature = evt.feature;
            let circleGeom = circleFeature.getGeometry();
            let circleExtent = circleGeom.getExtent();
            let circleCenter = ol.extent.getCenter(circleExtent);

            set_polygon_search(circleCenter, circleGeom);
        });

    };
    /******************************** Draw Circle Controller End ********************************/

    /******************************** Draw Polygon Controller Start ********************************/
    var drawPolygonFlag = false;
    app.drawPolygonControl = function (opt_options) {
        var options = opt_options || {};

        var button = document.createElement('button');
        button.setAttribute('title', MAP.SET_POLYGON.NAME);
        button.innerHTML = '<i class="fa fa-bookmark-o fa-rotate-270" aria-hidden="true"></i>';

        var drawPolygonFunction = function () {
            if (drawPolygonFlag === false) {
                drawPolygonAble();
                if (drawPolygonFlag) {
                    drawPolygonFN();
                }
            } else {
                drawPolygonDisable();
            }
        };

        button.addEventListener('click', drawPolygonFunction, false);
        button.addEventListener('touchstart', drawPolygonFunction, false);

        var element = document.createElement('div');
        element.className = 'ctl-draw-polygon ol-unselectable ol-control';
        element.setAttribute('id', 'drawPolygonControl');
        element.appendChild(button);

        ol.control.Control.call(this, {
            element: element,
            target: options.target
        });
    };

    ol.inherits(app.drawPolygonControl, ol.control.Control);

    var drawPolygonAble = function () {
        drawPolygonFlag = true;
        drawSquareFlag = false;
        drawCircleFlag = false;
        $('.ctl-draw-polygon').children().first().css('background-color', 'rgba(0, 0, 0, 0.7)');

        drawSquareDisable();
        drawCircleDisable();
    };

    var drawPolygonDisable = function () {
        drawPolygonFlag = false;
        map.removeInteraction(drawPolygonI);
        if (hasMapOverlayByTitle(MAP.SET_POLYGON.NAME)) {
            map.removeLayer(drawPolygonVL);
        }

        closePolygonPopup();
        $('.ctl-draw-polygon').children().first().css('background-color', 'rgba(57, 152, 156, .7)');
    };

    var drawPolygonVL;
    var drawPolygonI;
    var drawPolygonFN = function () {
        if (hasMapOverlayByTitle(MAP.SET_POLYGON.NAME)) {
            map.removeLayer(drawPolygonVL);
        }

        drawPolygonVL = undefined;
        drawPolygonI = undefined;

        drawPolygonVL = new ol.layer.Vector({
            title: MAP.SET_POLYGON.NAME,
            source: new ol.source.Vector(),
            style: new ol.style.Style({
                fill: new ol.style.Fill({
                    color: COLOR.DRAW.FILL
                }),
                stroke: new ol.style.Stroke({
                    color: COLOR.DRAW.STROKE,
                    width: 2
                })
            }),
            zIndex: MAP.SET_POLYGON.ZINDEX
        });

        map.addLayer(drawPolygonVL);

        drawPolygonI = new ol.interaction.Draw({
            type: 'Polygon',
            source: drawPolygonVL.getSource()
        });
        drawPolygonI.title = 'drawPolygonInteraction';

        map.addInteraction(drawPolygonI);


        drawPolygonI.on('drawstart', function (evt) {

        });

        drawPolygonI.on('drawend', function (evt) {
            let polygonFeature = evt.feature;
            let polygonGeom = polygonFeature.getGeometry();
            let polygonExtent = polygonGeom.getExtent();
            let polygonCenter = ol.extent.getCenter(polygonExtent);

            set_polygon_search(polygonCenter, polygonGeom);
        }, this);
    };
    /******************************** Draw Polygon Controller Start ********************************/

    /******************************** Refresh Map Controller Start ********************************/
//    app.refreshMapControl = function (opt_options) {
//        var options = opt_options || {};

//        var button = document.createElement('button');
//        button.innerHTML = '<i class="fa fa-eye-slash" aria-hidden="true"></i>';
//
//        var refreshMapController = function () {
////            view.animate({
////                duration: 1000,
////                center: center,
////                zoom: 8
////            });
//            refreshAreaPolygon();
//        };
//
//        button.addEventListener('click', refreshMapController, false);
//        button.addEventListener('touchstart', refreshMapController, false);
//
//        var element = document.createElement('div');
//        element.className = 'ctl-refresh-map ol-unselectable ol-control';
//        element.setAttribute('id', 'refreshMapControl');
//        element.appendChild(button);
//
//        ol.control.Control.call(this, {
//            element: element,
//            target: options.target
//        });
//    };

//    ol.inherits(app.refreshMapControl, ol.control.Control);
    /******************************** Refresh Map Controller End ********************************/
    var addrSearchFlag = false;

    app.addrSearchControl = function(opt_options) {
        var options = opt_options || {};

        var button = document.createElement('button');
        button.setAttribute('title', '검색');
        button.innerHTML = '<i class="fa fa-search" aria-hidden="true"></i>';

        var addrSearchController = function () {
            if(addrSearchFlag === false) {
                addrSearchFlag = true;

                $('.ol-search-control').css('width', '22em');
                $('.ol-search-control').css('height', '285px');
                $('.ol-search-control').css('background-color', 'rgba(255, 255, 255, 1)');

                var addrSearchDiv = document.createElement('div');
                addrSearchDiv.setAttribute('id', 'ctl-addr-search');

                addrSearchDiv.innerHTML =
                    '<input type="text" class="form-control input-sm" id="addr-search-text" placeholder="주소를 입력해주세요." ' +
                    ' onkeypress="if(event.keyCode==13) {searchAddr(); return false;}"' +
                    'style="width: 90%; margin: auto;">' +
                    '<div id="search-result-div">' +
                    '</div>';

                element.appendChild(addrSearchDiv);
            } else {
                addrSearchFlag = false;
                $('.ol-search-control').css('width', '42px');
                $('.ol-search-control').css('height', '42px');
                $('.ol-search-control').css('background-color', 'rgba(255, 255, 255, 0)');

                if(document.getElementById('ctl-addr-search')) {
                    element.removeChild(document.getElementById('ctl-addr-search'));
                }
            }
        };

        var searchButton = $('addr-search-btn');

        button.addEventListener('click', addrSearchController, false);
        button.addEventListener('touchstart', addrSearchController, false);

        var element = document.createElement('div');
        element.className = 'ctl-addr-search ol-unselectable ol-control ol-search-control';
        element.setAttribute('id', 'addrSearchControl');
        element.appendChild(button);

        ol.control.Control.call(this, {
            element: element,
            target: options.target
        });
    };

    ol.inherits(app.addrSearchControl, ol.control.Control);

    var searchAddr = function () {
        let addr = $('#addr-search-text').val();

        if (!addr) {
            alert('주소를 입력해 주세요.');
            return false;
        }

        let contents = '<ul>';
        let $importDiv = $('#search-result-div');
        $.ajax({
            method: 'POST',
            url: '{{url_for("situation.search_address")}}',
            data: {'address': addr},
            dataType: 'json'
        }).done(function (data) {
            if (data.status === 'OK') {
                $.each(data.result.items, function (i, item) {
                    contents += '';
                    let address = item.address;
                    let point = item.point;
                    contents += '<li style="display: list-item" onclick="setPosition(' + point.x + ',' + point.y + ',' + 18 + ');">'
                        + address.road + '<br>'
                        + '(' + address.parcel + ')'
                        + '</li>';
                });
            } else {
                contents += '<li class="text-center" style="display: list-item">'
                    + '검색 결과가 없습니다.'
                    + '</li>';
            }

            contents += '</ul>';
            $importDiv.html(contents);
        });
    };
    /******************************** Search Controller End ********************************/


    /******************************** hmhm Controller Start ********************************/
    let viewSlideFlag = false;
    app.viewSlideControl = function(opt_options) {
        let options = opt_options || {};

        let button = document.createElement("button");
        button.setAttribute('title', '리스트 보기');
        button.innerHTML = '<i class="fa fa-angle-up" aria_hidden="true"></i>';

        let viewSlideAction = function() {
            if (viewSlideFlag) {
                viewSlideFlag = true;

                let viewSlideDiv = document.createElement("div");
                viewSlideDiv.setAttribute("id", "ctl-slide-view");
                viewSlideDiv.innerHTML =
                    "<a>하하하</a>";

                element.appendChild(viewSlideDiv);
            } else {
                viewSlideFlag = false;
            }
        }

        button.addEventListener('click', viewSlideAction, false);
        button.addEventListener('touchstart', viewSlideAction, false);

        let element = document.createElement("div");
        element.className = "ctl-slide-view ol-unselectable ol-control";
        element.setAttribute("id", "viewSlideControl");
        element.appendChild(button);

        ol.control.Control.call(this, {
            element: element,
            target: options.target
        });
    };

    ol.inherits(app.viewSlideControl, ol.control.Control);
    /******************************** hmhm Controller End ********************************/

    /******************************** Search Map Controller End ********************************/

    /******************************** Time Bar Map Controller Start ********************************/
    app.timeBarControl = function (opt_options) {
        let options = opt_options || {};

        let element = document.createElement('div');
        element.className = 'ctl-time-bar ol-unselectable ol-control ol-timeBar-control';
        element.setAttribute('id', 'timeBarControl');

        let timeBarFlag = true;
        var timeBarContents = "";
        timeBarContents += "" +
            "<p class='text-center'><strong>< HeatMap Time Slider ></strong></p>" +
            "<div id='slider-range'>" +
            "<div id='custom-handle' class='ui-slider-handle'></div>" +
            "</div>" +
            "<div id='time-bar-player' class='text-center'>" +
            "<a id='time-bar-play' class='btn btn-default' onclick='javascript:playTimeBar();'>" +
                "<i class='fa fa-play fa-lg'></i>" +
            "</a>" +
            "<a id='time-bar-pause' class='btn btn-default' onclick='javascript:pauseTimeBar();'>" +
                "<i class='fa fa-pause fa-lg'></i>" +
            "</a>" +
            "<a id='time-bar-stop' class='btn btn-default' onclick='javascript:stopTimeBar();'>" +
                "<i class='fa fa-stop fa-lg'></i>" +
            "</a>" +

            "</div>";

        var timeBarDiv = document.createElement('div');
        timeBarDiv.setAttribute('id', 'ctl-timeBar-div');

        timeBarDiv.innerHTML = timeBarContents;
        element.appendChild(timeBarDiv);

        ol.control.Control.call(this, {
            element: element,
            target: options.target
        });
    };

    ol.inherits(app.timeBarControl, ol.control.Control);


    // TODO : 유틸로 뺄것
    function parse(str) {
        if (!/^(\d){8}$/.test(str)) return "invalid date";
        var y = str.substr(0, 4),
            m = str.substr(4, 2) - 1,
            d = str.substr(6, 2);

        return new Date(y, m, d);
    }

    var timeBarLayer = '';
    var timeBarCql = '';
    var timeBarTargetDate = '';

    var heatMapSlider = {
        start: '',
        end: '',
        layer: '',
        cql: '',
        currentDate: '',
        setHeatMapSlider: function (start, end, layer, cql) {
            this.start = start;
            this.end = end;
            this.layer = layer;
            this.cql = cql;
            this.current = start;
            this.currentDate = parse(String(start) + '01');

            let handle = $("#custom-handle");
            $("#slider-range").slider({
                create: function () {
                    let date = parse(String(start) + '01');
                    handle.text(date.getFullYear() + '년' + (date.getMonth() + 1) + '월');
                },
                min: 0,
                max: hmsUtil.getTermArr(start, end, 1).length - 1,
                step: 1,
                values: [0],
                slide: function (event, ui) {
                    let targetDateNum = Number(start) + Number(ui.values[0]);
                    if (targetDateNum % 100 > 12) {
                        targetDateNum = targetDateNum + 100 - 12;
                    }

                    let date = parse(String(targetDateNum) + '01');
                    heatMapSlider.current = targetDateNum;
                    heatMapSlider.currentDate = date;

                    handle.text(date.getFullYear() + '년 ' + (date.getMonth() + 1) + '월');
                    setTimeBarGeoHeatMap(layer, cql, date);
                }
            });
        },
    };

    setHeatMapSlider = function (start, end, layer, cql) {
        timeBarLayer = layer;
        timeBarCql = cql;

        let handle = $("#custom-handle");
        $("#slider-range").slider({
            create: function () {
                let date = parse(String(start) + '01');
                handle.text(date.getFullYear() + '년' + (date.getMonth() + 1) + '월');
            },
            start: start,
            end: end,
            min: 0,
            max: hmsUtil.getTermArr(start, end, 1).length - 1,
            step: 1,
            values: [0],
            slide: function (event, ui) {
                let targetDateNum = Number(start) + Number(ui.values[0]);
                if (targetDateNum % 100 > 12) {
                    targetDateNum = targetDateNum + 100 - 12;
                }

                let date = parse(String(targetDateNum) + '01');
                timeBarTargetDate = date;

                handle.text(date.getFullYear() + '년 ' + (date.getMonth() + 1) + '월');
                setTimeBarGeoHeatMap(layer, cql, date);
            }
        });
    };

    function setTimeBarGeoHeatMap(layer, cql, date) {
        let prefix = '';
        if (codeStyle === FUNC.TRNSTN_SITUTN_TRANS.CODE_STYLE) {
            prefix = FUNC.TRNSTN_SITUTN_TRANS.CODE_STYLE_SHORT
        }

        if (codeStyle === FUNC.TRNSTN_SITUTN_PRICE.CODE_STYLE) {
            prefix = FUNC.TRNSTN_SITUTN_PRICE.CODE_STYLE_SHORT
        }

        let replaceStr1 = cql.substring(cql.indexOf(prefix + '_syear'), cql.indexOf(prefix + '_syear') + 14);
        let replaceStr2 = cql.substring(cql.indexOf(prefix + '_smonth'), cql.indexOf(prefix + '_smonth') + 13);
        let replaceStr3 = cql.substring(cql.indexOf(prefix + '_eyear'), cql.indexOf(prefix + '_eyear') + 14);
        let replaceStr4 = cql.substring(cql.indexOf(prefix + '_emonth'), cql.indexOf(prefix + '_emonth') + 13);

        let result = cql
            .replace(replaceStr1, prefix + '_syear=' + date.getFullYear())
            .replace(replaceStr2, prefix + '_smonth=' + pad((date.getMonth() + 1), 2))
            .replace(replaceStr3, prefix + '_eyear=' + date.getFullYear())
            .replace(replaceStr4, prefix + '_emonth=' + pad((date.getMonth() + 1), 2));

//        geoHeatmapLayer.getSource().updateParams({
//            LAYER: layer,
//            CQL: result,
//        });
//
//        geoHeatmapLayer.setVisible(true);
        setGeoHeatMap(layer, result, true);
    }

    function pad(n, width) {
        n = n + '';
        return n.length >= width ? n : new Array(width - n.length + 1).join('0') + n;
    }

    /******************************** Refresh Map Controller End ********************************/

    let listViewFlag = true;
    let listViewArr = [];
    let listViewTarget = "";
    /******************************** List View Controller Start ********************************/
    app.listViewControl = function (opt_options) {

        let options = opt_options || {};

        let button = document.createElement('button');
        button.setAttribute('id', 'btn-list-view');
        button.setAttribute('title', '리스트 보기');
        button.innerHTML = '<i class="fa fa-list-alt" aria-hidden="true"></i>';

        let window = document.getElementById("wiw-list-view");
        let listViewAction = function() {
            console.log("ListView 에서 " + listViewFlag);

            if (listViewFlag) {
                listViewFlag = false;
                $('#btn-list-view').css("background", "rgba(0, 0, 0, 0.7)");
                window.style.display = "inline";
                setListView();
            } else {
                listViewFlag = true;
                $('#btn-list-view').css('background', 'rgba(57, 152, 156, .7)');
                window.style.display = "none";
            }
        };

        button.addEventListener('click', listViewAction, false);
        button.addEventListener('touchstart', listViewAction, false);

        let element = document.createElement('div');
        element.className = 'ctl-list-view ol-unselectable ol-control';
        element.appendChild(button);

        hmsUi.setWindow(document.getElementById(("wiw-list-view")), button, listViewFlag);
        ol.control.Control.call(this, {
            element: element,
            target: options.target
        });
    };

    function setListView() {
        let listContents = '';
        $('#wiw-list-view-title').html(FUNC[listViewTarget.toUpperCase()].KOR_NAME + " 검색 결과 리스트(기본형)");

        if (listViewTarget === FUNC.BUSINS_SITUTN.KOR_NAME) {
            $.each(listViewArr, function (k, v) {
                listContents += '<li style="display: list-item" onclick="setPosition(' + v.geom[0] + ',' + v.geom[1] + ');">'
                    + '<span class="label label-danger">' + v.busins_wide_cds + '</span> &minus;'
                    + '<span class="label label-success">' + v.brand_nm + '</span><br>'
                    + '<span>&nbsp;- ' + v.prcl_addrs + '</span>'
                    + '</li>';
            });
        } else if (listViewTarget === FUNC.TRNSTN_SITUTN_TRANS.CODE_STYLE || listViewTarget === FUNC.TRNSTN_SITUTN_PRICE.CODE_STYLE) {
            $.each(listViewArr, function (k, v) {
                listContents += '<li style="display: list-item" onclick="setPosition(' + v.geom[0] + ',' + v.geom[1] + ');">'
                    + '<span class="label label-success">' + v.bldng_ko_nm + '</span><br>'
                    + '<span>&nbsp;- ' + v.address + '</span>'
                    + '</li>';
            });
        } else if (listViewTarget === FUNC.IDNFTN_BLDNG.CODE_STYLE) {
            console.log(listViewArr);
            $.each(listViewArr, function (k, v) {
                listContents += '<li style="display: list-item" onclick="setPosition(' + v.geom[0] + ',' + v.geom[1] + ');">'
                    + '<span class="label label-success">' + v.building_kor + '</span><br>'
                    + '<span>&nbsp;- ' + v.address + '</span>'
                    + '</li>';
            });
        }
        else if (listViewTarget === FUNC.SUPPLY_PRESENT.CODE_STYLE) {
            $.each(listViewArr, function (k, v) {
                listContents += '<li style="display: list-item" onclick="setPosition(' + v.geom[0] + ',' + v.geom[1] + ');">'
                    + '<span class="label label-success">' + v.bldng_ko_nm + '</span><br>'
                    + '<span>&nbsp;- ' + v.address + '</span>'
                    + '</li>';
            });
        }

        $('#wiw-lsit-view-body').html(listContents);
        // listViewArr
    }

    function setPosition(x, y, zoom) {
        view.animate({
            duration: 1000,
            center: [x, y],
            zoom: zoom
        });
        console.log("x:" + x + ', y:' + y);
        for (let i = 0; i < 4; i++) {
            setTimeout(function () {
                pulseFeature([x, y]);
            }, 500 + (i * 1500));
        }

        function pulseFeature(coord) {
            let f = new ol.Feature(new ol.geom.Point(coord));
            f.setStyle(new ol.style.Style({
                image: new ol.style.Circle({
                    radius: 15,
                    points: 4,
                    fill: new ol.style.Fill({color: 'rgba(255, 0, 0, 0.2)'}),
                    stroke: new ol.style.Stroke({color: '#f00', width: 3})
                })
            }));
            map.animateFeature(f, new ol.featureAnimation.Zoom({
                fade: ol.easing.easeOut,
                duration: 3000,
                easing: ol.easing.easeOut
            }));
        }
    }

    ol.inherits(app.listViewControl, ol.control.Control);
    /******************************** List View Controller End ********************************/

    /******************************** Card View Controller End ********************************/
    let cardViewFlag = false;
    app.cardViewControl = function (opt_options) {
        let options = opt_options || {};

        let button = document.createElement('button');
        button.setAttribute('id', 'btn-card-view');
        button.setAttribute('title', '카드 리스트 보기');

        let iconUrl = "{{url_for('static', filename='images/icon/control/card_2.png') }}";
        button.innerHTML = `<img src="${iconUrl}" width="30px">`;
        // button.innerHTML = '<i class="fa fa-list-alt" aria-hidden="true"></i>';

        let window = document.getElementById("wiw-card-view");
        let cardViewAction = function() {
            if(cardViewFlag) {
                cardViewFlag = false;
                $('#btn-card-view').css('background', 'rgba(57, 152, 156, .7)');
                window.style.display = "none";
            } else {
                cardViewFlag = true;
                $('#btn-card-view').css("background", "rgba(0, 0, 0, 0.7)");
                window.style.display = "inline";
            }
        };

        button.addEventListener('click', cardViewAction, false);
        button.addEventListener('touchstart', cardViewAction, false);

        let element = document.createElement('div');
        element.className = 'ctl-card-view ol-unselectable ol-control';
        element.appendChild(button);

        hmsUi.setWindow(document.getElementById(("wiw-card-view")), button, cardViewFlag);
        ol.control.Control.call(this, {
            element: element,
            target: options.target
        });
    };

    ol.inherits(app.cardViewControl, ol.control.Control);

    /******************************** Title Controller Start ********************************/
    let mapTitle = "";
    app.titleControl = function (opt_options) {
        let options = opt_options || {};

        let div = document.createElement('div');
        div.setAttribute('id', 'label-map-title');
        div.setAttribute('class', 'text-center');
        div.innerHTML = `<p><strong>${mapTitle}</strong></p>`;

        let element = document.createElement('div');
        element.className = 'ctl-map-title ol-unselectable ol-control';
        element.appendChild(div);

        ol.control.Control.call(this, {
            element: element,
            target: options.target
        });

    };

    ol.inherits(app.titleControl, ol.control.Control);
    /******************************** Title Controller Start ********************************/

    /******************************** Legend View Controller Start ********************************/
    var legendViewFlag = false;
    var legendViewArr = [
        {color: 'rgba(208, 71, 71, 1)', value: '1차산업'},
        {color: 'rgba(97, 234, 97, 1)', value: '음식'},
        {color: 'rgba(64, 64, 218, 1)', value: '의료'},
        {color: 'rgba(255, 255, 78, 1)', value: '전자/정보통신'},
        {color: 'rgba(102, 224, 224, 1)', value: '학문/교육'},
        {color: 'rgba(255, 0, 255, 1)', value: '부동산'},
        {color: 'rgba(1255, 155, 0, 1)', value: '소매'},
        {color: 'rgba(159, 0, 255, 1)', value: '숙박'},
        {color: 'rgba(255, 0, 0, 1)', value: '관광/여가/오락'},
        {color: 'rgba(162, 162, 162, 1)', value: '생활서비스'},
        {color: 'rgba(0,0,0, 1)', value: '도매/유통/무역'}
    ];

    var legendViewTargetArr = [];
    var legendViewTarget = '';
    app.legendViewControl = function (opt_options) {
        var options = opt_options || {};

        var element = document.createElement('div');
        element.className = 'ctl-legend-view ol-unselectable ol-control ol-legend-control';
        element.setAttribute('id', 'legendViewControl');

        legendViewFlag = true;
        // legendViewTargetArr = busins_wide_code;

        var legendViewContents = "";
        legendViewContents += "<li style='list-style:none;'>테스트용 동적처리 구현 할 것</li>";
        legendViewContents += "<li style='list-style:none;'>드래그해서 밖으로 보낼 수 있음</li>";
        $.each(legendViewArr, function(k, v){
            legendViewContents += "<li style='list-style:none;'><span style='color: " + v.color + ";''>  ●  </span>"+ v.value
                + "</li>";
        });

        if (document.getElementById('ctl-legendView-div')) {
            element.removeChild(document.getElementById('ctl-legendView-div'));
        }

        var legendViewDiv = document.createElement('div');
        legendViewDiv.setAttribute('id', 'ctl-legendView-div');

        legendViewDiv.innerHTML = legendViewContents;
        element.appendChild(legendViewDiv);

        ol.control.Control.call(this, {
            element: element,
            target: options.target
        });
    };

    $(function () {
        $("#legendViewControl").draggable();
        $("#legendViewControl").resizable();
//        $("#popup").draggable();
//        $("#popup-content").draggable();
        $("#mdl-chart-radra").draggable();
        $("#mdl-content-radar").resizable({
            aspectRatio: 900 / 520,
            minHeight: 385,
            minWidth: 222
        });
        $("#mdl-chart-bar").draggable();
        $("#mdl-content-bar").resizable({
            aspectRatio: 900 / 520,
            minHeight: 385,
            minWidth: 222
        });
        $("#mdl-chart-horizontalBar").draggable();
        $("#mdl-content-horizontalBar").resizable({
            aspectRatio: 900 / 520,
            minHeight: 385,
            minWidth: 222
        });
        $("#mdl-chart-area").draggable();
        $("#mdl-content-area").resizable({
            aspectRatio: 900 / 520,
            minHeight: 385,
            minWidth: 222
        });
        $("#mdl-chart-line").draggable();
        $("#mdl-content-line").resizable({
            aspectRatio: 900 / 520,
            minHeight: 385,
            minWidth: 222
        });
        $("#mdl-chart-pie").draggable();
        $("#mdl-content-pie").resizable({
            aspectRatio: 900 / 520,
            minHeight: 385,
            minWidth: 222
        });
    });


    ol.inherits(app.legendViewControl, ol.control.Control);
    /******************************** Legend View Controller End ********************************/

//    var center = [126.991823835784, 37.5519181289032];
    var view = new ol.View({
        center: BASE_MAP.CENTER,
        zoom: BASE_MAP.ZOOM,
        minZoom: BASE_MAP.MIN_ZOOM,
        maxZoom: BASE_MAP.MAX_ZOOM,
        projection: ol.proj.get(BASE_MAP.PROJECTION)
    });
    //    {# 오픈레이어스 팝업 #}
    var container = document.getElementById('popup');
    var content = document.getElementById('popup-content');
    var closer = document.getElementById('popup-closer');

    var overlay = new ol.Overlay(({
        element: container,
        autoPan: true,
        autoPanAnimation: {
            duration: 250
        }
    }));

    function closeOverlay() {
        overlay.setPosition(undefined);
        closer.blur();
        return false;
    }

    closer.onclick = function () {
        closeOverlay();
    };

    var viewBulkContainer = document.getElementById('viewBulkPopup');
    var viewBulkContent = document.getElementById('viewBulkPopupContent');
    var viewBulkCloser = document.getElementById('viewBulkPopupCloser');

    var viewBulkOverlay = new ol.Overlay(({
        element: viewBulkContainer,
        autoPan: true,
        autoPanAnimation: {
            duration: 250
        }
    }));

    viewBulkCloser.onclick = function () {
        viewBulkOverlay.setPosition(undefined);
        viewBulkCloser.blur();
        return false;
    };

    var polygonPopupContainer = document.getElementById('polygon-popup');
    var polygonPopupContent = document.getElementById('polygon-popup-content');
    var polygonPopupCloser = document.getElementById('polygon-popup-closer');

    var polygonPopupOverlay = new ol.Overlay(({
        id : 'polygonPopupOverlay',
        title : 'polygonPopupOverlay',
        element: polygonPopupContainer,
        autoPan: true,
        autoPanAnimation: {
            duration: 250
        }
    }));

    function closePolygonPopup() {
        polygonPopupOverlay.setPosition(undefined);
        polygonPopupCloser.blur();
        return false;
    }

    polygonPopupCloser.onclick = function () {
        closePolygonPopup();
    };


    var setMarkerContainer = document.getElementById('userMarkerPopup');
    var setMarkerContent = document.getElementById('userMarkerPopupContent');
    var setMarkerCancel = document.getElementById('userMarkerCancel');

    var setMarkerOverlay = new ol.Overlay(({
        id : 'setMarkerOverlay',
        title : 'setMarkerOverlay',
        element: setMarkerContainer,
        autoPan: true,
        autoPanAnimation: {
            duration: 250
        }
    }));

    function closeSetMarkerPopup() {
        setMarkerOverlay.setPosition(undefined);
//        setMarkerOverlay.blur();
        return false;
    }

    setMarkerCancel.onclick = function(){
        closeSetMarkerPopup();
    };

    var viewMarkerContainer = document.getElementById('viewMarkerPopup');
    var viewMarkerContent = document.getElementById('viewMarkerPopupContent');
    //    var viewMarkerCloser = document.getElementById('viewMarkerPopupCloser');
    var viewMarkerCancel = document.getElementById('viewMarkerCancel');
    var viewMarkerSubmit = document.getElementById('viewMarkerSubmit');
    var viewMarkerDelete = document.getElementById('viewMarkerDelete');

    var viewMarkerOverlay = new ol.Overlay(({
        id : 'viewMarkerOverlay',
        title : 'viewMarkerOverlay',
        element: viewMarkerContainer,
        autoPan: true,
        autoPanAnimation: {
            duration: 250
        }
    }));

    var targetLayer;
    function closeViewMarkerPopup() {
        viewMarkerOverlay.setPosition(undefined);
//        viewMarkerOverlay.blur();
        return false;
    }

    viewMarkerDelete.onclick = function () {
        targetLayer.getSource().removeFeature(targetFeature);

        $.ajax({
            method: 'POST',
            url: '{{ url_for("situation.delete_marker") }}',
            data: $('#frm-viewMarker-popup').serialize(),
            dataType: 'json'
        });

        closeViewMarkerPopup();
    };

    viewMarkerCancel.onclick = function () {
        closeViewMarkerPopup();
    };

    viewMarkerSubmit.onclick = function () {
        let title = $('#viewMarkerTitle').val();
        let targetFeatureText = targetFeature.getStyle().getText();
        targetFeatureText.setText(title);

        targetFeature.set('category', $('#viewMarkerCategory').val());
        targetFeature.set('title', title);
        targetFeature.set('content', $('#viewMarkerContent').val());

        $.ajax({
            method: 'POST',
            url: '{{ url_for("situation.update_marker") }}',
            data: $('#frm-viewMarker-popup').serialize() + '&img=' + markerSelectedImg,
            dataType: 'json'
        });
        closeViewMarkerPopup();
    };

    //    {# 동적으로 레이어를 생성하기 위해 오버레이 그룹을 별도로 만듦 #}
    var dynamicLayerGroup = new ol.layer.Group({
//        title: 'Overlays',//우선 안씀
        layers: []
    });
    //    {# 베이스 맵 그룹을 포함한 맵 객체를 생성 #}

    var viewBulkControl = new app.viewBulkControl();
    var viewMarkerControl = new app.viewMarkerControl();
    var setMarkerControl = new app.setMarkerControl();

    var downloadImageControl = new app.downloadImageControl();

    var drawSquareControl = new app.drawSquareControl();
    var drawCircleControl = new app.drawCircleControl();
    var drawPolygonControl = new app.drawPolygonControl();

    var listViewControl = new app.listViewControl();
    var cardViewControl = new app.cardViewControl();

    var titleControl = new app.titleControl();

    var legendViewControl = new app.legendViewControl();
    var timeBarControl = new app.timeBarControl();
    var searchControl = new app.addrSearchControl();
    // var viewSlideControl = new app.viewSlideControl();

    let hmsTest = new HmsTest();
    var map = new ol.Map({
        controls: ol.control.defaults().extend([
//            overviewMapControl,
            fullScreenControl,
            zoomSliderControl,
            scaleLineControl,
            layerSwitcherControl,
            viewBulkControl,
            // hmsControl.getGetMarkerControl(),
            // hmsTest.getGetMarkerControl(),
            viewMarkerControl,
            setMarkerControl,
//            downloadImageControl,
            drawSquareControl,
            drawCircleControl,
            drawPolygonControl,
            searchControl,
            // listViewControl,
            // cardViewControl,
            // titleControl,
//            legendViewControl,
//            timeBarControl
        ]),
        interactions: ol.interaction.defaults().extend([
            new ol.interaction.DragRotateAndZoom()
        ]),
//        displayProjection: new ol.Projection(MAP_CONF.PROJECTION),
        layers: [
            new ol.layer.Group({
                title: '기본 지도',
                layers: layers,
            }),
            new ol.layer.Group({
                title: '레이어 지도',
                layers: hybridLayer
            }),
            dynamicLayerGroup
        ],
        logo: false,
        overlays: [overlay, polygonPopupOverlay, setMarkerOverlay, viewMarkerOverlay, viewBulkOverlay],
        target: 'map',
        view: view
    });

    var fullScreenButton = $('.ol-full-screen').children()[0];

    $($('.ol-full-screen').children()[0]).on('click', function(){
        var fullScreenStat = $(this).attr('class');

        if (fullScreenStat === 'ol-full-screen-false') {
            removeAllControl();
        } else {
            addAllControl();
        }
    });

//    mapCavans 맵 캔버스 찾기가 귀찮아서 ID Attribute 추가함
    var mapCanvas = ($('#map').children()).children().filter('canvas');
    mapCanvas.attr('id', 'mapCanvas');
//    mapCavans 맵 캔버스 찾기가 귀찮아서 ID Attribute 추가함

    var geoHeatmapLayer;

    /*** Geo_Server 관련 차후 이전
     {# geoserver url은 설정(settings.py) 에서 가져오도록 수정해야 함 #}
     var url = 'http://192.168.0.90:9090/geoserver/hms/wms';

     var mvmt_layer = new ol.layer.Tile({
        title: '',//오버레이 그룹에 나오지 않도록 하기 위해 타이틀 없앰
        source: new ol.source.TileWMS({
            url: url,
            serverType: 'geoserver',
            crossOrigin: 'anonymous'
        })
    });

     var background_layer = new ol.layer.Tile({
        title: '',
        source: new ol.source.TileWMS({
            url: url,
            serverType: 'geoserver',
            crossOrigin: 'anonymous'
        })
    });

     var update_params = function (layers, featureid) {
        mvmt_layer.getSource().updateParams({
            'layers': layers,
            'featureid': featureid
        });
    };

     function updateParams(layers, featureIds) {
        mvmt_layer.getSource().updateParams({
            'layers': layers,
            'featureid': featureIds
        });

        overlayGroup.getLayers().push(mvmt_layer);
    }

     overlayGroup.getLayers().push(background_layer);
     ***/

    var url = GEO_SERVER_URL;

    function getTSCql(string) {
        let paramArray = string.split('&');
        let paramLength = paramArray.length;

        let cql = '';
        let sdate = '';
        let edate = '';
        let transType = '';
        let houseType = '';
        for (let i=0; i < paramLength; i++) {
            let paramSet = paramArray[i].split('=');

            let targetKey = paramSet[0].substring(paramSet[0].indexOf('_') + 1);
            let andCode = " AND ";

            // 지역 코드
            if (targetKey === "cd") {cql += paramSet[0] + "=" + paramSet[1] + "" + andCode;}
            if (targetKey === "trans_type") {
                transType = paramSet[1]
                if (transType !== '4') {
                    cql += "trnstn_clsftn_code" + "=" + paramSet[1] +  "" + andCode;
                }
            }

            if(transType === '1') {
                if (targetKey === "house_kind") {cql += "house_clsftn_code" + "=" + paramSet[1] +  "" + andCode;}
                if (targetKey === 'ssale') {cql += 'sale_price' + '>=' + paramSet[1] + andCode;}
                if (targetKey === 'esale') {cql += 'sale_price' + '<=' + paramSet[1] + andCode;}
                // 노후도
                if (targetKey === "sdecrepit") {cql += 'build_yyyy' + "<=" + (Number(hmsUtil.getCurrentYear()) - paramSet[1]) +  "" + andCode;}
                if (targetKey === "edecrepit") {cql += 'build_yyyy' + ">=" + (Number(hmsUtil.getCurrentYear()) - paramSet[1]) +  "" + andCode;}

            } else if(transType === '2') {
                if (targetKey === "house_kind") {cql += "house_clsftn_code" + "=" + paramSet[1] +  "" + andCode;}
                if (targetKey === 'sdeposit') {cql += 'junse' + '>=' + paramSet[1] + andCode;}
                if (targetKey === 'edeposit') {cql += 'junse' + '<=' + paramSet[1] + andCode;}
                // 노후도
                if (targetKey === "sdecrepit") {cql += 'build_yyyy' + "<=" + (Number(hmsUtil.getCurrentYear()) - paramSet[1]) +  "" + andCode;}
                if (targetKey === "edecrepit") {cql += 'build_yyyy' + ">=" + (Number(hmsUtil.getCurrentYear()) - paramSet[1]) +  "" + andCode;}
            } else if(transType === '3') {
                if (targetKey === "house_kind") {cql += "house_clsftn_code" + "=" + paramSet[1] +  "" + andCode;}
                if (targetKey === 'sdeposit') {cql += 'deposit' + '>=' + paramSet[1] + andCode;}
                if (targetKey === 'edeposit') {cql += 'deposit' + '<=' + paramSet[1] + andCode;}
                if (targetKey === 'srent') {cql += 'mnthly_rent' + '>=' + paramSet[1] + andCode;}
                if (targetKey === 'erent') {cql += 'mnthly_rent' + '<=' + paramSet[1] + andCode;}
                // 노후도
                if (targetKey === "sdecrepit") {cql += 'build_yyyy' + "<=" + (Number(hmsUtil.getCurrentYear()) - paramSet[1]) +  "" + andCode;}
                if (targetKey === "edecrepit") {cql += 'build_yyyy' + ">=" + (Number(hmsUtil.getCurrentYear()) - paramSet[1]) +  "" + andCode;}

            } else if(transType === '4') {
                if (targetKey === 'ssale') {cql += 'supply_price' + '>=' + paramSet[1] + andCode;}
                if (targetKey === 'esale') {cql += 'supply_price' + '<=' + paramSet[1] + andCode;}
            } else {
                //TODO : 참조값을 무조건 넣는 방식으로 진행하자.
                //TODO : 서버 요청에 의해 값을 가져 오는 방식은 어떤지... 고려 할 것.
            }

            if (targetKey === "sexarea") {cql += 'exclsv_area' + ">=" + paramSet[1] +  "" + andCode;}
            if (targetKey === "eexarea") {cql += 'exclsv_area' + "<=" + paramSet[1] +  "" + andCode;}

            // 날짜
            if (targetKey === 'syear') {sdate += paramSet[1];}
            if (targetKey === 'smonth') {sdate += paramSet[1];}
            if (targetKey === 'eyear') {edate += paramSet[1];}
            if (targetKey === 'emonth') {edate += paramSet[1];}
        }

        cql += 'yyyymm>=' + String(sdate) + 'AND ';
        cql += 'yyyymm<=' + String(edate) + ' AND ';

        console.log(cql.substring(0, cql.length - 5));
        return cql.substring(0, cql.length - 5);
    }

    function getIBCql(string){
        let paramArray = string.split('&');
        let paramLength = paramArray.length;

        let cql = '';
        let sdate = '';
        let edate = '';
        let andCode = ' AND ';
        for (let i=0; i < paramLength; i++) {
            let paramSet = paramArray[i].split('=');

            let targetKey = paramSet[0].substring(paramSet[0].indexOf('_') + 1);

            if(targetKey === 'cd') {cql += paramSet[0] + "=" + paramSet[1] + "" + andCode;}
            if(targetKey === 'house_kind') {cql += "house_clsftn_code" + "=" + paramSet[1] +  "" + andCode;}
            if(targetKey === 'sexarea') {cql += "cnstrtn_area" + ">=" + paramSet[1] +  "" + andCode;}
            if(targetKey === 'eexarea') {cql += "cnstrtn_area" + "<=" + paramSet[1] +  "" + andCode;}
            if(targetKey === 'syear'){sdate += paramSet[1];}
            if(targetKey === 'smonth'){sdate += paramSet[1];}
            if(targetKey === 'eyear'){edate += paramSet[1];}
            if(targetKey === 'emonth'){edate += paramSet[1];}
        }
        cql += 'year_permission>=' + String(sdate) + ' AND ';
        cql += 'year_permission<=' + String(edate) + ' AND ';

        return cql.substring(0, cql.length - 5)
    }

    function getSPCql(string) {
        let paramArray = string.split('&');
        let paramLength = paramArray.length;

        let cql = '';
        let sdate = '';
        let edate = '';
        let andCode = ' AND ';
        for (let i=0; i < paramLength; i++) {
            let paramSet = paramArray[i].split('=');

            let targetKey = paramSet[0].substring(paramSet[0].indexOf('_') + 1);

            if(targetKey === 'cd') {cql += paramSet[0] + "=" + paramSet[1] + "" + andCode;}
//            if(targetKey === 'house_kind') {cql += "house_clsftn_code" + "=" + paramSet[1] +  "" + andCode;}
            if(targetKey === 'sexarea') {cql += "exclsv_area" + ">=" + paramSet[1] +  "" + andCode;}
            if(targetKey === 'eexarea') {cql += "exclsv_area" + "<=" + paramSet[1] +  "" + andCode;}
            if(targetKey === 'syear'){sdate += paramSet[1];}
            if(targetKey === 'smonth'){sdate += paramSet[1];}
            if(targetKey === 'eyear'){edate += paramSet[1];}
            if(targetKey === 'emonth'){edate += paramSet[1];}
        }
        cql += 'yyyymm>=' + String(sdate) + ' AND ';
        cql += 'yyyymm<=' + String(edate) + ' AND ';

        return cql.substring(0, cql.length - 5)
    }

    function getISCql(string) {
        let paramArray = string.split('&');
        let paramLength = paramArray.length;

        let cql = '';
        let andCode = ' AND ';
        for (let i=0; i < paramLength; i++) {
            let paramSet = paramArray[i].split('=');

            let targetKey = paramSet[0].substring(paramSet[0].indexOf('_') + 1);

            if(targetKey === 'cd') {cql += paramSet[0] + "=" + paramSet[1] + "" + andCode;}
        }

        return cql.substring(0, cql.length - 5)
    }

    function getBSCql(string) {
        console.log(string);
        let paramArray = string.split('&');
        let paramLength = paramArray.length;

        let cql = '';
        let andCode = ' AND ';
        let narrowCd = [];
        for (let i=0; i < paramLength; i++) {
            let paramSet = paramArray[i].split('=');

            let targetKey = paramSet[0].substring(paramSet[0].indexOf('_') + 1);

            console.log(targetKey);

            if(targetKey === 'cd') {cql += paramSet[0] + "=" + paramSet[1] + "" + andCode;}
            // if(targetKey === 'narr_cd') {cql += 'busins_narrow_cd' + "= '" + paramSet[1] + "'" + andCode;}
            if(targetKey === 'narr_cd') {narrowCd.push("'" + paramSet[1] + "'")}
        }

        cql += 'busins_narrow_cd IN (' + narrowCd.toString() + ")" + andCode;

        console.log(cql.substring(0, cql.length - 5));
        return cql.substring(0, cql.length - 5)
    }

    function setGeoHeatMap(layers, cql, visible = false, styles="") {
        heatMapLayerName = layers;

        if (hasMapOverlayByTitle(MAP.HEAT_MAP.NAME)) {
            map.removeLayer(geoHeatmapLayer);
        }

        if (codeStyle === FUNC.TRNSTN_SITUTN_TRANS.CODE_STYLE
            || codeStyle === FUNC.TRNSTN_SITUTN_PRICE.CODE_STYLE) {
            cql = getTSCql(cql);
        } else if (codeStyle === FUNC.IDNFTN_BLDNG.CODE_STYLE) {
            cql = getIBCql(cql);
        } else if (codeStyle === FUNC.SUPPLY_PRESENT.CODE_STYLE) {
            cql = getSPCql(cql);
        } else if (codeStyle === FUNC.INCOME_SITUTN.CODE_STYLE) {
            cql = getISCql(cql);
        } else if (codeStyle === FUNC.BUSINS_SITUTN.CODE_STYLE) {
            cql = getBSCql(cql);
        }

        geoHeatmapLayer = new ol.layer.Image({
            title: MAP.HEAT_MAP.NAME,
            zIndex: MAP.HEAT_MAP.ZINDEX,
            source: new ol.source.ImageWMS({
                ratio: 1,
                url: url,
                params: {
                    'VERSION': '1.1.1',
                    'CQL_FILTER': cql,
                    STYLES: styles,
                    LAYERS: layers,
                    ENV: 'radius:' + $('#htmap-radius-slider').slider('option', 'value'),
                }
            })
        });

        console.log(geoHeatmapLayer);
//        geoHeatmapLayer.redraw(true);
//        overlayGroup.getLayers().push(geoHeatmapLayer);
        map.addLayer(geoHeatmapLayer);
        geoHeatmapLayer.setVisible(visible);
        $('#htmap-radius-slider').slider("enable");
    }

    var targetFeature;
    var setMarkerLayer = new ol.layer.Vector({
        title: MAP.SET_MARKER.NAME,
        zIndex: MAP.SET_MARKER.ZINDEX
    });

    map.on('click', function (evt) {
        var coordinate = evt.coordinate;
        var feature, layer;

        map.forEachFeatureAtPixel(evt.pixel,
            function (f, l) {
                feature = f;
                layer = l;
            });

        if (feature) {
            if (viewMarkerFlag) {
                targetFeature = feature;

                $('#viewMarkerCategory').val(feature.get('category'));
                $('#viewMarkerTitle').val(feature.get('title'));
                $('#viewMarkerContent').val(feature.get('content'));
                $('#viewMarkerIdx').val(feature.get('id'));
                viewMarkerOverlay.setPosition(feature.getGeometry().getCoordinates());
            }

            if (viewBulkFlag && feature.get('group') === 'viewBulk') {
                let item = feature.get('item');

                viewBulkContent.innerHTML = '<div>' +
                    '<span>카테고리 : </span>' + item.category + '<br>' +
                    '<span>제목 : </span>' +  item.title + '<br>' +
                    '<span>컨텐츠 : </span>' +  item.content + '<br>' +
                    '<span>주소 : </span>' + item.address + '<br>' +
                    '<span>숫자형1 : </span>' + item.number1 + '<br>' +
                    '<span>숫자형2 : </span>' + item.number2 + '<br>' +
                    '<span>숫자형3 : </span>' + item.number3 + '<br>' +
                    '<span>숫자형4 : </span>' + item.number4 + '<br>' +
                    '<span>숫자형5 : </span>' + item.number5 + '<br>' +
                    '<span>문자형1 : </span>' + item.string1 + '<br>' +
                    '<span>문자형2 : </span>' + item.string2 + '<br>' +
                    '<span>문자형3 : </span>' + item.string3 + '<br>' +
                    '<span>문자형4 : </span>' + item.string4 + '<br>' +
                    '<span>문자형5 : </span>' + item.string5 + '<br>' +
                    '</div>';
                viewBulkOverlay.setPosition(coordinate);
            }
        } else {
            if (markerAvailable) {
                setMarkerOverlay.setPosition(coordinate);

                markerGeom = coordinate;

                function closeMarkerPopup() {
                    setMarkerOverlay.setPosition(undefined);
                    closer.blur();
                    return false;
                }

                $('#userMarkerSubmit').unbind('click');
                $('#userMarkerSubmit').on('click', function () {
//                    if (hasMapOverlayByTitle('마커 그리기')) {
//                        map.removeLayer(setMarkerLayer);
//                    }

                    var iconFeature = new ol.Feature({
                        geometry: new ol.geom.Point(coordinate),
                        population: 4000,
                        rainfall: 500
                    });

                    var baseSourceUrl = "{{url_for('static', filename='images/marker/') }}";
                    var iconStyle = new ol.style.Style({
                        image: new ol.style.Icon(({
                            anchor: [0.5, 0.5],
                            scale: 0.7,
                            anchorXUnits: 'fraction',
                            anchorYUnits: 'fraction',
                            src: baseSourceUrl + 'icon_64/' + markerSelectedImg
                        })),
                        text: new ol.style.Text({
                            font: 'bold 16px Calibri, sans-serif',
                            fill: new ol.style.Fill({color: '#000'}),
                            stroke: new ol.style.Stroke({
                                color: '#fff', width: 5
                            }),
                            text: $('#setMarkerTitle').val(),
                            offsetY: 30
                        })
                    });

                    iconFeature.setStyle(iconStyle);

                    var vectorSource = new ol.source.Vector({
                        features: [iconFeature]
                    });

                    setMarkerLayer.setSource(vectorSource);

                    targetLayer = setMarkerLayer;

                    closeMarkerPopup();
                    $.ajax({
                        method: 'POST',
                        url: '{{ url_for("situation.set_marker") }}',
                        data: $('#frm-setMarker').serialize() + '&lat=' + markerGeom[0] + '&log=' + markerGeom[1] + '&img=' + markerSelectedImg,
                        dataType: 'json',
                        beforeSend: function () {
                            showLoader();
                        },
                        complete: function () {
                            hideLoader();
                            numArr = [];
                        }
                    });
                });
            }
        }
    });

    function downloadImg() {
        var exportPNGElement = document.getElementById('export-png');

//    if ('download' in exportPNGElement) {
//        exportPNGElement.addEventListener('click', function (e) {
        map.once('postcompose', function (event) {
//            var img = document.getElementById('mirror');
            var img = new Image();
            var canvas = event.context.canvas;
//            var ctx = canvas.getContext('2d').drawImage(img, 0,0, img.width, img.height, 0, 0, canvas.width, canvas.height);
            var ctx = canvas.getContext('2d');

            img.onload = function () {
                ctx.drawImage(img, 100, 100);
            };

            img.setAttribute('crossOrigin', 'anonymous');
            img.crossOrigin = '';
//            img.src = canvas.toDataURL('image/png');
            img.src = canvas.toDataURL('');

//                exportPNGElement.href = canvas.toDataURL('image/png');
//            html2canvas(document.getElementById('map'), {
//                onrendered: function (canvas) {
//                    var mapCanvas = document.getElementById('mapCanvas');
//                    document.getElementById('imgTestDownloader').appendChild(canvas);
//                },
//            })
        });
        map.renderSync();
//        }, false);
    }

    function setMarkerImage(img) {
        markerSelectedImg = img;
        hmsUi.hideModal('mdl-markerImg-area');
    }

    var coords = [];
    var centroid = [];
    var mask;
    var crop;
    var feature;

    var locationDepth;
    var locationCode;

    var targetAccordion;
    var isInit = false;

    function setSelectedValueForLocationDecision(locationDepth, locationCode) {
        this.locationDepth = locationDepth;
        this.locationCode = locationCode;
    }

    function refreshAreaPolygon() {
        if (mask) {
            mask.set('inner', true);
            mask.set('active', false);
        }

        if (crop) {
            crop.set('inner', true);
            crop.set('active', false);
        }
        invisibleMap.filters_ = undefined;
        crop = undefined;
        feature = undefined;
        mask = undefined;
    }

    function setAreaPolygon(locationDepth, locationCode, type) {
        let url = '';
        if (type === 'law') {
            url = '{{ url_for("common.get_law_polygon") }}';
        } else {
            url = '{{ url_for("common.get_adm_polygon") }}';
        }

        $.ajax({
            method: 'POST',
            url: url,
            data: {locationDepth: locationDepth, locationCode: locationCode},
            dataType: 'json'
        }).done(function (data) {
            if (isInit) {
                refreshAreaPolygon();
            }

            coords = data.polygon;
            centroid = data.centroid;

            let polygons;
            if (coords.type === 'Polygon') {
                polygons = new ol.geom.Polygon(coords.coordinates);
            } else if (coords.type === 'MultiPolygon') {
                polygons = new ol.geom.MultiPolygon(coords.coordinates);
            } else {
                polygons = false;
                alert('Not matched Polygon types');
            }
            if (!feature) {
                feature = undefined;
            }
            feature = new ol.Feature({geometry: polygons});

            if (!crop) {
                crop = undefined;
            }
            crop = new ol.filter.Crop({feature: feature, inner: false});

            if (!mask) {
                mask = new ol.filter.Mask({
                    feature: feature,
                    inner: false,
                    fill: new ol.style.Fill({color: [255, 255, 255, 0.8]})
                });
            }
            invisibleMap.addFilter(crop);
            invisibleMap.addFilter(mask);

            mask.set('inner', true);
            crop.set('inner', true);
            mask.set('active', false);
            crop.set('active', false);

            isInit = true;
            setFilter(centroid, locationDepth);
        });

    }

    function setFilter(centroid, locationType) {
        doBounce(centroid.coordinates, view, function () {
        }, locationType);

        mask.set('inner', false);
        mask.fillColor_ = 'rgba(0,0,0,0.6)';
        crop.set('inner', true);

        mask.set('active', true);
        crop.set('active', false);
    }

    function doBounce(location, view, done, locationType) {
        let duration = 1000;
        let zoom = view.getZoom();
        let parts = 2;
        let called = false;

        function callback(complete) {
            --parts;
            if (called) {
                return;
            }
            if (parts === 0 || !complete) {
                called = true;
                done(complete);
            }
        }

        let zoomInfo = ZOOM.BOUNCE_AFTER;

        view.animate({
            center: location,
            duration: duration
        }, callback);
        view.animate({
            zoom: zoom - 1,
            duration: duration / 2
        }, {
            zoom: zoomInfo[locationType.toUpperCase()],
            duration: duration / 2
        }, callback);
    }

    //    {# 코드 목록을 조회하여 selectpicker에 옵션들을 세팅 #}
    function set_codes_for_selectpicker(group_code, element_id, element_type) {
        $.ajax({
            method: 'POST',
            url: '{{ url_for("common.get_codes") }}',
            data: {group_code: group_code},
            dataType: 'json'
        }).done(function (data) {
            var results = [];
            $.each(data.codes, function (i, code) {
                results.push(`<option value="${code.code}" ${code.options}>${code.name}</option>`);
            });
            $('#' + element_id).html(results.join('')).selectpicker('refresh');
        });
    }

    function set_year_for_selectpicker(element_id, start_year, end_year, term, isStart, selected_year) {
        start_year = Number(start_year);
        end_year = Number(end_year);
        term = Number(term);
        selected_year = Number(selected_year);

        let results = [];
        let diff_year = 0;

        if (isStart) {diff_year = -1}

        for (let target_year = start_year; target_year <= end_year; target_year += term) {
            if (selected_year + diff_year === target_year) {
                results.push('<option value="' + target_year + '" selected="selected">' + target_year + '</option>');
            } else {
                results.push('<option value="' + target_year + '">' + target_year + '</option>');
            }
        }

        $('#' + element_id).html(results.join('')).selectpicker('refresh');
    }

    function set_date_for_selectpicker(element_id, start_date, end_date, selected_date) {
        start_date = Number(start_date);
        end_date = Number(end_date);
        selected_date = Number(selected_date);

        let results = [];
        for (let target_date = start_date; target_date <= end_date; target_date++) {

            let zero = '';
            target_date = target_date.toString();

            if (target_date.length < 2) {
                for (let i = 0; i < 2 - target_date.length; i++)
                    zero += '0';
            }
            let formatted_target_date = zero + target_date;

            if (selected_date == target_date) {
                results.push('<option value="' + formatted_target_date + '" selected="selected">' + formatted_target_date + '</option>');
            } else {
                results.push('<option value="' + formatted_target_date + '">' + formatted_target_date + '</option>');
            }
        }
        $('#' + element_id).html(results.join('')).selectpicker('refresh');
    }

    function set_codes_for_slider(target_id, slider_id, label_id, label, unit, min, max, step, curr_value, func) {
        $('#' + target_id).html(
            '<p>' +
            '<label for="' + label_id + '"><span class="label label-default">' + label + '</span></label>' +
            //            '<a type="text" id="' + label_id + '" readonly style="border:0; color:#f6931f; font-weight:bold;"></a>' +
            '<a type="text" id="' + label_id + '" readonly style="border:0; font-weight:bold;"></a>' +
            '</p>' +
            '<div id="' + slider_id + '"></div>'
        );

        $('#' + slider_id).slider({
            create: function() {$('#' + label_id).text(curr_value + ' (' + unit + ')')},
            min: min,
            max: max,
            value: curr_value,
            step: step,
            slide: function(event, ui) {
                //TODO: 나중에 콜백 함수 쓰자.
                if(geoHeatmapLayer){
                    $('#' + label_id).text('  ' + hmsUtil.setComma(String(ui.value)) + ' (' + unit + ')');

                    geoHeatmapLayer.getSource().updateParams({
                        'env': 'radius:' + parseInt(ui.value, 10)
                    });
                } else {
                    return false;
                }
            }
        });

        $('#' + slider_id).slider("disable");

//         $('#' + label_id).val($('#' + slider_id).slider("values", 0));
    }

    function set_codes_for_range_slider(target_id, slider_id, label_id, start_id, end_id, label, unit, min, max, step, curr_min, curr_max) {
        $('#' + target_id).html(
            '<p>' +
            '<label for="' + label_id + '"><span class="label label-default">' + label + '</span></label>' +
            //            '<a type="text" id="' + label_id + '" readonly style="border:0; color:#f6931f; font-weight:bold;"></a>' +
            '<a type="text" id="' + label_id + '" readonly style="border:0; font-weight:bold;"></a>' +
            '</p>' +

            '<div id="' + slider_id + '"></div>' +
            '<input type="hidden" id="' + start_id + '" name="' + start_id + '">' +
            '<input type="hidden" id="' + end_id + '" name="' + end_id + '">'
        );

        let values = [];
        if (curr_min === undefined || curr_max === undefined ) {
            values = [min, max]
        }else {
            values = [curr_min, curr_max]
        }

        $('#' + slider_id).slider({
            range: true,
            min: min,
            max: max,
            values: values,
            step: step,
            slide: function (event, ui) {
                $('#' + label_id).text(' ' + hmsUtil.setComma(String(ui.values[0])) + ' ~ ' + hmsUtil.setComma(String(ui.values[1])) + '(' + unit + ')');
                $('#' + start_id).val(ui.values[0]);
                $('#' + end_id).val(ui.values[1]);
            }
        });

        $('#' + label_id).text(' ' + hmsUtil.setComma(String($('#' + slider_id).slider("values", 0))) + ' ~ ' +
            String(hmsUtil.setComma($('#' + slider_id).slider("values", 1))) + ' (' + unit + ')');
        $('#' + start_id).val($('#' + slider_id).slider("values", 0));
        $('#' + end_id).val($('#' + slider_id).slider("values", 1));
    }

    function resetMapLayer() {
        if (hasMapOverlayByTitle(FUNC.BUSINS_SITUTN.KOR_NAME)
            || hasMapOverlayByTitle(FUNC.SUPPLY_PRESENT.KOR_NAME)
            || hasMapOverlayByTitle(FUNC.TRNSTN_SITUTN_TRANS.KOR_NAME)
            || hasMapOverlayByTitle(FUNC.TRNSTN_SITUTN_PRICE.KOR_NAME)
            || hasMapOverlayByTitle(FUNC.IDNFTN_BLDNG.KOR_NAME)
            || hasMapOverlayByTitle(MAP.HEAT_MAP.NAME)
            || hasMapOverlayByTitle(MAP.BUBBLE_MAP.NAME)) {

            if (FUNC.BUSINS_SITUTN.MAP_LAYER !== {}) {
                map.removeLayer(FUNC.BUSINS_SITUTN.MAP_LAYER);
                FUNC.BUSINS_SITUTN.MAP_LAYER = undefined
                // FUNC.BUSINS_SITUTN.MAP_LAYER.setVisible(false);
            }

            console.log(FUNC.SUPPLY_PRESENT.MAP_LAYER);
            if (FUNC.SUPPLY_PRESENT.MAP_LAYER !== {}) {
                map.removeLayer(FUNC.SUPPLY_PRESENT.MAP_LAYER);
                FUNC.SUPPLY_PRESENT.MAP_LAYER = undefined
                // FUNC.SUPPLY_PRESENT.MAP_LAYER.setVisible(false);
            }

            if (FUNC.TRNSTN_SITUTN_TRANS.MAP_LAYER !== {}) {
                map.removeLayer(FUNC.TRNSTN_SITUTN_TRANS.MAP_LAYER);
                FUNC.TRNSTN_SITUTN_TRANS.MAP_LAYER = undefined
                // FUNC.TRNSTN_SITUTN_TRANS.MAP_LAYER.setVisible(false);
            }

            if (FUNC.TRNSTN_SITUTN_PRICE.MAP_LAYER !== {}) {
                map.removeLayer(FUNC.TRNSTN_SITUTN_PRICE.MAP_LAYER);
                FUNC.TRNSTN_SITUTN_PRICE.MAP_LAYER = undefined
                // FUNC.TRNSTN_SITUTN_PRICE.MAP_LAYER.setVisible(false);
            }

            if (FUNC.IDNFTN_BLDNG.MAP_LAYER !== {}) {
                map.removeLayer(FUNC.IDNFTN_BLDNG.MAP_LAYER);
                FUNC.IDNFTN_BLDNG.MAP_LAYER = undefined
                // FUNC.IDNFTN_BLDNG.MAP_LAYER.setVisible(false);
            }

            map.removeLayer(heatMapLayer);
            map.removeLayer(bubbleLayer);
            map.removeLayer(geoHeatmapLayer);
            map.removeControl(timeBarControl);
            map.removeControl(titleControl);
        }

        numArr = [];
        closeOverlay();

        map.removeControl(listViewControl);
    }

    function get_selected_area(params) {
        var paramArray = params.split('&');
        var paramLength = paramArray.length;

        var ret;
        for (var i = 0; i < paramLength; i++) {
            var paramSet = paramArray[i].split('=');

            if(paramSet[0] === 'sid_cd' || paramSet[0] === 'sgg_cd' || paramSet[0] === 'emd_cd'
                || paramSet[0] === 'in_sid_cd' || paramSet[0] === 'in_sgg_cd' || paramSet[0] === 'in_emd_cd') {

                if (paramSet[0] === 'in_sid_cd' || paramSet[0] === 'in_sgg_cd' || paramSet[0] === 'in_emd_cd') {
                    ret = paramSet[0].substring(3,paramSet[0].length) + "=" + paramSet[1];
                } else {
                    ret = paramArray[i];
                }
            }
        }

        return ret;
    }

    function get_low_area_cds(locationType, locationDepth, locationCode) {
        var url = '';
        if (locationType === 'law') {
            url = '{{ url_for("common.get_low_law_cds") }}';
        } else if (locationType === 'adm') {
            url = '{{ url_for("common.get_low_adm_cds") }}';
        } else {
            alert('개발자에게 문의하세요');
            console.log('Invalid locationType');
        }

        var result = [];
        $.ajax({
            url: url,
            method: 'POST',
            data: {locationType: locationType, locationDepth: locationDepth, locationCode: locationCode},
            async: false,
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
                return result;
            }
        }).done(function (data) {
            result = data.rows;
        });

        return result;
    }

    function get_target_area(target_name, locationType) {
        var $target_el = $('#' + target_name).children();

        var result = {locationDepth: undefined, locationCode: undefined};
        $.each($target_el, function (i, elements) {
            if ($(elements).is('input')) {
                result.locationDepth = $(elements).attr('locationDepth');
                result.locationCode = $(elements).val();
            }
        });

        setAreaPolygon(result.locationDepth, result.locationCode, locationType);
    }

//    {# 인구통계 검색 #}
    function srch_popltn_stats() {
        if ($('#spn-ps-area').text() === '') {
            alert('지역을 선택해 주세요.');
        } else {
            resetMapLayer();

            let form = $('#frm-west-0');
            if (set_popltn_stats_check(form)) {
                codeStyle = FUNC.POPLTN_STATS.CODE_STYLE;
                // mapTitle = FUNC.POPLTN_STATS.KOR_NAME + " 검색 결과";
                gridData = [];

                get_target_area('spn-ps-area', FUNC.POPLTN_STATS.LOCATION_TYPE);
                updateDistAreaLayer(
                    FUNC.POPLTN_STATS.LOCATION_TYPE,
                    get_low_area_cds(FUNC.POPLTN_STATS.LOCATION_TYPE, locationDepth, locationCode)
                );

                set_popltn_stats_map(form);
                set_popltn_stats_bubble(form);
                set_popltn_stats_table(form);

                setAppendedAll(true);

                // map.addControl(titleControl);
            } else {
                alert("검색 결과가 없습니다. 검색조건을 변경해 주세요.")
            }
        }
    }

        // 검색 결과 유무는 데이터 갯수로 체크
    function set_popltn_stats_check(form) {
        let dataCount = 0;

        $.ajax({
            url: '{{ url_for("situation.srch_popltn_stats") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=check',
            dataType: 'json',
            async: false,
        }).done(function (data) {
            dataCount = data.count;
        })

        return dataCount;
    }

    //    {# 인구통계 맵 #}
    function set_popltn_stats_map(form) {
        let year = $('#ps_eyear').val();
        let month = $('#ps_emonth').val();
        let selected_area = $('#spn-ps-area').text();

        $.ajax({
            url: '{{ url_for("situation.srch_popltn_stats") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=map',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
            }
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                content.innerHTML =

                '<span class="label label-success" style="display: inline-block;">' + selected_area + '</span>' +
                '<br>' + year + '년 ' + month + '월' +
                '<br>선택 연령대 인구수: ' + hmsUtil.setComma(item.total_num) + '(명)';

                overlay.setPosition(item.coordinates);
            });
        }).fail(function (data) {
            alert(data.msg);
        });
    }

//    {# 인구통계 버블 #}
    function set_popltn_stats_bubble(form) {
        $.ajax({
            url: '{{ url_for("situation.srch_popltn_stats") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=bubble',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
                numArr = [];
            }
        }).done(function (data) {
            $.each(data.rows.end_result, function (i, item) {
                numArr.push(item.total_sum);
            });
            bubbleData = data.rows.end_result;

            maxNum = Math.max.apply(null, numArr);
            minNum = Math.min.apply(null, numArr);

            setBubbleMap();

            // console.log(dynamicLayerGroup);
        }).fail(function (data) {
            alert(data.msg);
        });
    }

    function set_popltn_stats_bubbleF(form) {
        $.ajax({
            url: '{{ url_for("situation.srch_popltn_stats") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=bubble',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
                numArr = [];
            }
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                numArr.push(item.total_sum);
            });
            bubbleData = data.rows;

            maxNum = Math.max.apply(null, numArr);
            minNum = Math.min.apply(null, numArr);

            setBubbleMap();
            setGeoHeatMap('hms:trnstn_situtn', get_selected_area(form.serialize()));

            // console.log(dynamicLayerGroup);
        }).fail(function (data) {
            alert(data.msg);
        });
    }

//    {# 인구통계 테이블 #}
    function set_popltn_stats_table(form) {
        $('#pivotTitle').html(
            '<h4 style="margin-top: 0px;">< ' + FUNC.POPLTN_STATS.KOR_NAME + ' 결과 표 ></h4>'
        );

        let hmsTable;
        $.ajax({
            method: 'POST',
            url: '{{ url_for("situation.srch_popltn_stats") }}',
            data: form.serialize() + '&req_type=grid',
            dataType: 'json'
        }).done(function (data) {
            $('#pivot-table').html("<table id='pivotTables'></table>");
            console.log(data);
            hmsTable = new HmsSituationTable('pivot-table', data.cols, data.rows, FUNC.POPLTN_STATS.KOR_NAME, 'sum')
        }).complete(function () {
            hmsTable.setTableData();
            hmsTable.addDownload('pivot-download', 'btn-download', 'excel');

            $("#pivotTables").jqGrid().trigger('reloadGrid');

            hmsTable.addTimeseries('pivot-timeseries', hmsTable);
        });
    }

//    {# 인구주택총조사 검색 #}
    function srch_hshold_stats() {
        if ($('#spn-hs-area').text() == '') {
            alert('지역을 선택해 주세요.');
        } else {
            resetMapLayer();

            let form = $('#frm-west-1');
            if (set_hshold_stats_check(form)){
                codeStyle = FUNC.HSHOLD_STATS.CODE_STYLE;
                gridData = [];

                get_target_area('spn-hs-area', FUNC.HSHOLD_STATS.LOCATION_TYPE);
                updateDistAreaLayer(
                    FUNC.HSHOLD_STATS.LOCATION_TYPE,
                    get_low_area_cds(FUNC.HSHOLD_STATS.LOCATION_TYPE, locationDepth, locationCode)
                );

                set_hshold_stats_map(form);
                set_hshold_stats_bubble(form);
                set_hshold_stats_table(form);

                setAppendedAll(true);
            } else {
                alert("검색 결과가 없습니다. 검색조건을 변경해 주세요.");
            }
        }
    }

            // 검색 결과 유무는 데이터 갯수로 체크
    function set_hshold_stats_check(form) {
        let dataCount = 0;

        $.ajax({
            url: '{{ url_for("situation.srch_hshold_stats") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=check',
            dataType: 'json',
            async: false,

        }).done(function (data) {
            dataCount = data.count;
        });

        return dataCount;
    }

//    {# 인구주택총조사 맵 #}
    function set_hshold_stats_map(form) {
        var year = $('#hs_eyear').val();
        var selected_area = $('#spn-hs-area').text();

        $.ajax({
            url: '{{ url_for("situation.srch_hshold_stats") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=map',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                numArr = [];
                hideLoader();
            }
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                content.innerHTML = '<span class="label label-success" style="display: inline-block;">' + selected_area +
                    '</span><br>' + year + '년, 총 세대수: ' + hmsUtil.setComma(item.hshold_sum) + '(명)';
                overlay.setPosition(item.coordinates);
            });
        }).fail(function (data) {
            alert(data.msg);
        });
    }

//    {# 인구주택총조사 버블 #}
    function set_hshold_stats_bubble(form) {
        $.ajax({
            url: '{{ url_for("situation.srch_hshold_stats") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=bubble',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
            }
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                numArr.push(item.total_sum);
            });
            bubbleData = data.rows;
            maxNum = Math.max.apply(null, numArr);
            minNum = Math.min.apply(null, numArr);

            setBubbleMap();
            setGeoHeatMap('hms:trnstn_heatmap', get_selected_area($('#frm-west-1').serialize()));
//            setHeatMap('인구주택총조사');
        }).fail(function (data) {
            alert(data.msg);
        });

    }

//    {# 인구주택총조사 테이블 #}
    function set_hshold_stats_table(form) {
        $('#pivotTitle').html(
            '<h4 style="margin-top: 0px;">< ' + FUNC.HSHOLD_STATS.KOR_NAME + ' 결과 표 ></h4>'
        );

        $('#pivotDownload').html(
            '<div class="form-group">' +
                '<button id="download-pivotTable" class="btn btn-default pull-right" type="button">\<n></n>' +
                    '다운로드' +
                '</button>' +
            '</div>'
        );

        function setPivotTable() {
            $('#pivotTables').remove();

            var pivotTables = document.createElement('div');
            pivotTables.setAttribute('id', 'pivotTables');

            $('.ui-layout-south').append(pivotTables);

            let hs_syyyy = '';
            let hs_eyyyy = '';
            let params = form.serialize();
            $.each(params.split("&"), function(i, item){
                let param = item.split("=");

                if (param[0] === 'hs_syear') {
                    hs_syyyy += param[1]
                }
                if (param[0] === 'hs_eyear') {
                    hs_eyyyy += param[1]
                }
            });

            let term = hmsUtil.getTermArr(hs_syyyy, hs_eyyyy, 5);

            let column = [
                {'title': "시도", 'field': 'sid_ko_nm'},
                {'title': "시구군", 'field': 'sgg_ko_nm'},
                {'title': "주거유형", 'field': 'rsdnc_clsftn_cd'},
                {'title': "가구원수", 'field': 'fmly_num_cd'},
                {'title': "방개수", 'field': 'room_num_cd'}
            ];

            $.each(term, function(i ,item){
                column.push({title: item, field: '"'+item+'"'})
            });

            $('#pivotTables').tabulator({
                height: "695px",
                layout: "fitColumns",
                movableColumns: true,
                ajaxURL: '{{ url_for("situation.srch_hshold_stats") }}', //ajax URL
                ajaxParams: form.serialize() + '&req_type=grid',
                ajaxConfig: "POST",
                ajaxResponse: function (url, params, response) {
                    let targetColumn = [];
                    $.each(response.cols, function(i, item){
                        targetColumn.push({
                            title: item,
                            field: item
                        });
                    });

                    column = targetColumn;
                    $(this)[0].columns = targetColumn;

                    gridData = response.rows;
                    return response.rows
                },
                columns: column
            });

            $("#pivotTables").tabulator("setPage", 1);
        }

        setPivotTable();

        $("#download-pivotTable").click(function () {
            $("#pivotTables").tabulator("download", "csv", FUNC.HSHOLD_STATS.KOR_NAME + ".csv");
        });
    }

//    {# 인구이동 검색#}
    function srch_popltn_mvmt() {
        if($('#spn-pm-ia').text() == '' && $('#spn-pm-oa').text() == '') {
            alert('지역을 선택해 주세요.');
        } else {
            let form = $('#frm-west-2');
            if (set_popltn_mvmt_check(form)) {
                resetMapLayer();

                codeStyle = FUNC.POPLTN_MVMT.CODE_STYLE;
                gridData = [];
                get_target_area('spn-pm-ia', FUNC.POPLTN_MVMT.LOCATION_TYPE);
                updateDistAreaLayer(
                    FUNC.POPLTN_MVMT.LOCATION_TYPE,
                    get_low_area_cds(FUNC.POPLTN_MVMT.LOCATION_TYPE, locationDepth, locationCode)
                );

                set_popltn_mvmt_map(form);
                set_popltn_mvmt_bubble(form);
                set_popltn_mvmt_table(form);

                setAppendedAll(true);
            } else {
                alert("검색 결과가 없습니다. 검색조건을 변경해 주세요.");
            }
        }
    }
    //    {# 인구이동 체크 #}
    function set_popltn_mvmt_check(form){
        let dataCount = 0;

        $.ajax({
            url: '{{ url_for("situation.srch_popltn_mvmt") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=check',
            dataType: 'json',
            async: false,

        }).done(function (data) {
            dataCount = data.count;
        });

        return dataCount ? true : false;
    }

    //    {# 인구이동 맵 #}
    function set_popltn_mvmt_map(form) {
        var year = $('#pm_eyear').val();
        var month = $('#pm_emonth').val();
        var selected_area = $('#spn-pm-ia').text();

        $.ajax({
            url: '{{ url_for("situation.srch_popltn_mvmt") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=map',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
            }
        }).done(function (data) {

            $.each(data.rows, function (i, item) {
                content.innerHTML = '<span class="label label-success" style="display: inline-block;">' + selected_area +
                    '</span><br>' + year + '년 ' + month + ' 총 전입자수: ' + item.fmly_sum + '<br>(총 전입세대수: ' + item.hshold_cnt + ')';
                overlay.setPosition(item.coordinates);
            });
        }).fail(function (data) {
            alert(data.msg);
        });
    }

//    {# 인구이동 버블 #}
    function set_popltn_mvmt_bubble(form) {
        $.ajax({
            url: '{{ url_for("situation.srch_popltn_mvmt") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=bubble',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
                numArr = [];
            }
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                numArr.push(item.total_sum);
            });
            bubbleData = data.rows;
            maxNum = Math.max.apply(null, numArr);
            minNum = Math.min.apply(null, numArr);

            setBubbleMap(FUNC.POPLTN_MVMT.KOR_NAME);
        }).fail(function (data) {
            alert(data.msg);
        });
    }

//    {# 인구이동 테이블 #}
    function set_popltn_mvmt_table(form) {
        $('#pivotTitle').html(
            '<h4 style="margin-top: 0px;">< ' + FUNC.POPLTN_MVMT.KOR_NAME + ' 결과 표 ></h4>'
        );

        let hmsTable;
        $.ajax({
            method: 'POST',
            url: '{{ url_for("situation.srch_popltn_mvmt") }}',
            data: form.serialize() + '&req_type=grid',
            dataType: 'json'
        }).done(function (data) {
            $('#pivot-table').html("<table id='pivotTables'></table>");
            console.log(data);
            hmsTable = new HmsSituationTable('pivot-table', data.cols, data.rows, FUNC.POPLTN_MVMT.KOR_NAME, 'sum')
        }).complete(function () {
            let colExcept = {
                'out_sid_ko_nm': '전출 시도 코드',
                'out_sgg_ko_nm': '전출 시군구 코드',
                'out_emd_ko_nm': '전출 읍면동 코드',
                'in_sid_ko_nm': '전입 시도 코드',
                'in_sgg_ko_nm': '전입 시군구 코드',
                'in_emd_ko_nm': '전입 읍면동 코드'
            }
            hmsTable.setTableData(colExcept, colExcept);
            hmsTable.addDownload('pivot-download', 'btn-download', 'excel');

            $("#pivotTables").jqGrid().trigger('reloadGrid');
            hmsTable.addTimeseries('pivot-timeseries', hmsTable);
        });
    }

    function srch_trnstn_situtn_trans() {
        if($('#spn-tst-area').text() === '') {
            alert('지역을 선택해 주세요.');
        } else {
            resetMapLayer();

            let form = $('#frm-west-3');
            if (set_trnstn_situtn_trans_check(form)) {

                codeStyle = FUNC.TRNSTN_SITUTN_TRANS.CODE_STYLE;
                gridData = [];

                get_target_area('spn-tst-area', FUNC.TRNSTN_SITUTN_TRANS.LOCATION_TYPE);
                updateDistAreaLayer(
                    FUNC.TRNSTN_SITUTN_TRANS.LOCATION_TYPE,
                    get_low_area_cds(FUNC.TRNSTN_SITUTN_TRANS.LOCATION_TYPE, locationDepth, locationCode)
                );

                set_trnstn_situtn_trans_list(form);
                set_trnstn_situtn_trans_map(form);
                set_trnstn_situtn_trans_bubble(form);
                set_trnstn_situtn_trans_table(form);

                $('#htmap-radius-slider').slider("enable");

                setAppendedAll(true);
            } else {
                alert('검색 결과가 없습니다. 검색조건을 변경해 주세요.');
            }
        }
    }

    function set_trnstn_situtn_trans_check(form){
        let hasData = false;
        $.ajax({
            url: '{{ url_for("situation.srch_trnstn_situtn_trans") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=check',
            async: false,
            dataType: 'json',
        }).done(function (data) {
            hasData = data.hasData;
        });

        return hasData;
    }

    function set_trnstn_situtn_trans_list(form) {
        $.ajax({
            url: '{{ url_for("situation.srch_trnstn_situtn_trans") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=list',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
            }
        }).done(function (data) {
            listViewArr = data.rows;
            listViewTarget = FUNC.TRNSTN_SITUTN_TRANS.CODE_STYLE;
            map.addControl(listViewControl);
        });
    }

    function set_trnstn_situtn_trans_map(form) {
        let param = form.serializeArray();

        let paramLength = param.length;
        let transType = '';
        for (let i = 0; i < paramLength; i++) {
            if (param[i].name === 'tst_trans_type') {
                transType = param[i].value;
                break;
            }
        }

        let layer;
        if (transType !== '4'){
            layer = 'hms:trnstn_situtn_ssss'
        } else {
            layer = 'hms:trnstn_situtn_supply_ssss'
        }

        poiLayerName = layer;

        FUNC.TRNSTN_SITUTN_TRANS.MAP_LAYER = new ol.layer.Image({
            title: FUNC.TRNSTN_SITUTN_TRANS.KOR_NAME,
            zIndex: LAYER_ZINDEX.RESULT_MAP,
            source: new ol.source.ImageWMS({
                ratio: 1,
                url: url,
                params: {
                    'VERSION': '1.1.1',
                    'CQL_FILTER': getTSCql(form.serialize()),
                    STYLES: '',
                    LAYERS: layer,
                }
            })
        });

        console.log(FUNC.TRNSTN_SITUTN_TRANS.MAP_LAYER);

        map.addLayer(FUNC.TRNSTN_SITUTN_TRANS.MAP_LAYER );
        FUNC.TRNSTN_SITUTN_TRANS.MAP_LAYER .setVisible(true);

        map.on('click', function (evt) {
            if (FUNC.TRNSTN_SITUTN_TRANS.MAP_LAYER){
                let view = map.getView();
                let viewResolution = view.getResolution();
                let source = FUNC.TRNSTN_SITUTN_TRANS.MAP_LAYER .getSource();
                let url = source.getGetFeatureInfoUrl(
                    evt.coordinate, viewResolution, view.getProjection(),
                    {'INFO_FORMAT': 'application/json', 'FEATURE_COUNT': 1000});

                $.getJSON(url, function(data){
                    if(data.features.length > 0) {
                        let features = data.features;
                        let bldng_ko_nm = undefined;
                        let address = undefined;
                        let trnstn_clsftn_code = undefined;
                        let house_clsftn_code = undefined;
                        let yyyymm = [];
                        let build_yyyy = [];
                        let cnstrtn_area = [];
                        let exclsv_area = [];
                        let sale_price = [];
                        let deposit = [];
                        let mnthly_rent = [];
                        let trnstn_count = [];
                        let floor = [];
                        let featuresLength = 0;

                        $.each(features, function(i, sub_feature){
                            console.log(sub_feature);
                            let item = sub_feature.properties;
                            if (i === 0){
                                bldng_ko_nm = item.bldng_ko_nm;
                            }

                            if (item.bldng_ko_nm === bldng_ko_nm){
                                featuresLength++;
                                if (transType !== '4') {
                                    address = item.address;
                                    trnstn_clsftn_code = item.trnstn_clsftn_code;
                                    house_clsftn_code = item.house_clsftn_code;
                                    yyyymm.push(hmsUtil.getDateToKor(item.yyyymm, true));
                                    build_yyyy.push(hmsUtil.getDateToKor(item.build_yyyy));
                                    cnstrtn_area.push(item.cnstrtn_area);
                                    exclsv_area.push(item.exclsv_area);
                                    sale_price.push(hmsUtil.getNullValue(hmsUtil.setComma(item.sale_price), 0));
                                    deposit.push(hmsUtil.getNullValue(hmsUtil.setComma(item.deposit), 0));
                                    mnthly_rent.push(hmsUtil.getNullValue(hmsUtil.setComma(item.mnthly_rent), 0));
                                    trnstn_count.push(item.trnstn_count);
                                    floor.push(item.floor);
                                } else {
                                    address = item.address;
                                    yyyymm.push(hmsUtil.getDateToKor(item.yyyymm, true));
                                    cnstrtn_area.push(item.cnstrtn_area);
                                    exclsv_area.push(item.exclsv_area);
                                    trnstn_count.push(item.trnstn_count);
                                    sale_price.push(hmsUtil.getNullValue(hmsUtil.setComma(item.sale_price), 0));
                                }
                            }
                        });

                        var average = arr => arr.reduce( ( p, c ) => p + c, 0 ) / arr.length;
                        var sum = arr => arr.reduce( ( p, c ) => p + c, 0 );

                        if (transType !== '4') {
                            let resultContent = '<span><strong>단지명</strong> : </span>' + bldng_ko_nm + '<br>' +
                                '<span><strong>지번 주소</strong> : </span>' + address + '<br>' +
                                // '<span><strong>매물 종류</strong> : </span>' + trnstn_clsftn_code + '<br>' +
                                // '<span><strong>주택 구분</strong> : </span>' + house_clsftn_code + '<br>' +
                                '<span><strong>평균 거래량</strong> : </span>' + average(trnstn_count).toFixed(1) + ' (건)<br>' +
                                '<span><strong>총 거래량</strong> : </span>' + sum(trnstn_count) + ' (건)<br>';

                            resultContent +=
                                '<h4 class="text-center">< 거래량 변동 개요 ></h4>' +
                                '<div style="height: 156px; overflow: auto">' +
                                '<table class="table table-condensed" style="width: 600px;">' +
                                '<tr>' +
                                    '<th class="text-center">거래일자</th>' +
                                    '<th class="text-center">건축 년도</th>' +
                                    '<th class="text-center">계약 면적</th>' +
                                    '<th class="text-center">전용 면적</th>' +
                                    '<th class="text-center">거래량</th>' +
                                '</tr>';

                            for(var i=0; i < featuresLength; i++) {
                                resultContent +=
                                    '<tr>' +
                                        '<td class="text-center">' + yyyymm[i] + ' </td>' +
                                        '<td class="text-center">' + build_yyyy[i] + '</td>' +
                                        '<td class="text-center">' + cnstrtn_area[i] + ' (m<sup>2</sup>)</td>' +
                                        '<td class="text-center">' + exclsv_area[i] + ' (m<sup>2</sup>)</td>' +
                                    '<td class="text-center">' + trnstn_count[i] + ' 건</td>' +
                                    '</tr>';
                            }

                            resultContent += '</table></div>';
                            content.innerHTML = resultContent;
                        } else {
                            let resultContent = '<span><strong>단지명</strong> : </span>' + bldng_ko_nm + '<br>' +
                                '<span><strong>지번 주소</strong> : </span>' + address + '<br>' +
                                '<span><strong>구분</strong> : </span>' + '분양권' + '<br>' +
                                '<span><strong>평균 거래량</strong> : </span>' + average(trnstn_count).toFixed(1) + ' (건)<br>' +
                                '<span><strong>총 거래량</strong> : </span>' + sum(trnstn_count) + ' (건)<br>';

                            resultContent +=
                                '<h4 class="text-center">< 거래량 변동 개요 ></h4>' +
                                '<div style="height: 156px; overflow: auto">' +
                                '<table class="table table-condensed" style="width: 600px;">' +
                                '<tr>' +
                                    '<th class="text-center">거래일자</th>' +
                                    '<th class="text-center">계약 면적</th>' +
                                    '<th class="text-center">전용 면적</th>' +
                                    '<th class="text-center">거래량</th>' +
                                '</tr>';

                            for(var i=0; i < featuresLength; i++) {
                                resultContent +=
                                    '<tr>' +
                                    '<td class="text-center">' + yyyymm[i] + ' </td>' +
                                    '<td class="text-center">' + cnstrtn_area[i] + ' (m<sup>2</sup>)</td>' +
                                    '<td class="text-center">' + exclsv_area[i] + ' (m<sup>2</sup>)</td>' +
                                    '<td class="text-center">' + trnstn_count[i] + ' 건</td>' +
                                    '</tr>';
                            }

                            resultContent += '</table></div>';
                            content.innerHTML = resultContent;
                        }

                        overlay.setPosition(evt.coordinate);
                    }
                });
            }
        })
    }


    function set_trnstn_situtn_trans_bubble(form) {
        let param = form.serializeArray();

        let paramLength = param.length;
        let transType = '';
        for (let i = 0; i < paramLength; i++) {
            if (param[i].name === 'tst_trans_type') {
                transType = param[i].value;
                break;
            }
        }
        $.ajax({
            url: '{{ url_for("situation.srch_trnstn_situtn_trans") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=bubble',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
                numArr = [];
            }
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                numArr.push(item.total_sum);
            });
            bubbleData = data.rows;

            maxNum = Math.max.apply(null, numArr);
            minNum = Math.min.apply(null, numArr);

            setBubbleMap();
            setGeoHeatMap('hms:trnstn_situtn_heatmap_ssss', form.serialize());

            if (transType !== '4'){
                setGeoHeatMap('hms:trnstn_situtn_heatmap_ssss', form.serialize());
            } else {
                setGeoHeatMap('hms:trnstn_situtn_supply_heatmap_ssss', form.serialize());
            }
        }).fail(function (data) {

            alert(data.msg);
        });

        map.addControl(timeBarControl);

        let start = String($('#tst_syear').val()) + String($('#tst_smonth').val());
        let end = String($('#tst_eyear').val()) + String($('#tst_emonth').val());

        if (transType !== '4'){
            heatMapSlider.setHeatMapSlider(start, end, 'hms:trnstn_situtn_heatmap_ssss', form.serialize());
        } else {
            heatMapSlider.setHeatMapSlider(start, end, 'hms:trnstn_situtn_supply_heatmap_ssss', form.serialize());
        }
    }

    function set_trnstn_situtn_trans_table(form){
        $('#pivotTitle').html(
            '<h4 style="margin-top: 0px;">< ' + FUNC.TRNSTN_SITUTN_TRANS.KOR_NAME + ' 결과 표 ></h4>'
        );

        let hmsTable;
        $.ajax({
            method: 'POST',
            url: '{{ url_for("situation.srch_trnstn_situtn_trans") }}',
            data: form.serialize() + '&req_type=grid',
            dataType: 'json'
        }).done(function (data) {
            $('#pivot-table').html("<table id='pivotTables'></table>");
            console.log(data);
            hmsTable = new HmsSituationTable('pivot-table', data.cols, data.rows, FUNC.TRNSTN_SITUTN_TRANS.KOR_NAME, 'avg')
        }).complete(function () {
            hmsTable.setTableData();
            hmsTable.addDownload('pivot-download', 'btn-download', 'excel');
            // hmsTable.addDownload('pdf', 'pdf-download', 'pdf');
            // hmsTable.addDownload('csv', 'csv-download', 'csv');
            hmsTable.addTimeseries('pivot-timeseries');

            $("#pivotTables").jqGrid().trigger('reloadGrid');

            hmsTable.addTimeseries('pivot-timeseries', hmsTable);
        });
    }

    function srch_trnstn_situtn_price() {
        if($('#spn-tsp-area').text() === '') {
            alert('지역을 선택해 주세요.');
        } else {
            resetMapLayer();

            let form = $('#frm-west-4');
            if (set_trsnstn_situtn_price_check(form)) {

                codeStyle = FUNC.TRNSTN_SITUTN_PRICE.CODE_STYLE;
                gridData = [];

                get_target_area('spn-tsp-area', FUNC.TRNSTN_SITUTN_PRICE.LOCATION_TYPE);
                updateDistAreaLayer(
                    FUNC.TRNSTN_SITUTN_TRANS.LOCATION_TYPE,
                    get_low_area_cds(FUNC.TRNSTN_SITUTN_TRANS.LOCATION_TYPE, locationDepth, locationCode)
                );

                set_trnstn_situtn_price_list(form);
                set_trnstn_situtn_price_map(form);
                set_trnstn_situtn_price_bubble(form);
                set_trnstn_situtn_price_table(form);

                $('#htmap-radius-slider').slider("enable");

                setAppendedAll(true);

            } else {
                alert('검색 결과가 없습니다. 검색조건을 변경해 주세요.');
            }
        }
    }

    function set_trsnstn_situtn_price_check(form){
        let hasData = false;
        $.ajax({
            url: '{{ url_for("situation.srch_trnstn_situtn_price") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=check',
            async: false,
            dataType: 'json',
        }).done(function (data) {
            hasData = data.hasData;
        });

        return hasData;
    }

    function set_trnstn_situtn_price_list(form) {
        $.ajax({
            url: '{{ url_for("situation.srch_trnstn_situtn_price") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=list',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
            }
        }).done(function (data) {
            listViewTarget = FUNC.TRNSTN_SITUTN_PRICE.CODE_STYLE;
            listViewArr = data.rows;
            map.addControl(listViewControl);
        });
    }

    function set_trnstn_situtn_price_map(form) {
        let param = form.serializeArray();

        let paramLength = param.length;
        let transType = '';
        for (let i = 0; i < paramLength; i++) {
            if (param[i].name === 'tsp_trans_type') {
                transType = param[i].value;
                break;
            }
        }

        let layer;
        if (transType !== '4'){
            layer = 'hms:trnstn_situtn_ssss'
        } else {
            layer = 'hms:trnstn_situtn_supply_ssss'
        }

        poiLayerName = layer;

        FUNC.TRNSTN_SITUTN_PRICE.MAP_LAYER = new ol.layer.Image({
            title: FUNC.TRNSTN_SITUTN_TRANS.KOR_NAME,
            zIndex: LAYER_ZINDEX.RESULT_MAP,
            source: new ol.source.ImageWMS({
                ratio: 1,
                url: url,
                params: {
                    'VERSION': '1.1.1',
                    'CQL_FILTER': getTSCql(form.serialize()),
                    STYLES: '',
                    LAYERS: layer,
                }
            })
        });

        map.addLayer(FUNC.TRNSTN_SITUTN_PRICE.MAP_LAYER);
        FUNC.TRNSTN_SITUTN_PRICE.MAP_LAYER.setVisible(true);

        map.on('click', function (evt) {
            if (FUNC.TRNSTN_SITUTN_PRICE.MAP_LAYER) {
                let view = map.getView();
                let viewResolution = view.getResolution();
                let source = FUNC.TRNSTN_SITUTN_PRICE.MAP_LAYER.getSource();
                let url = source.getGetFeatureInfoUrl(
                    evt.coordinate, viewResolution, view.getProjection(),
                    {'INFO_FORMAT': 'application/json', 'FEATURE_COUNT': 1000});

                $.getJSON(url, function (data) {
                    if (data.features.length > 0) {
                        content.innerHTML = data.features;

                        let features = data.features;
                        let bldng_ko_nm = undefined;
                        let address = undefined;
                        let trnstn_clsftn_code = undefined;
                        let house_clsftn_code = undefined;
                        let yyyymm = [];
                        let build_yyyy = [];
                        let cnstrtn_area = [];
                        let exclsv_area = [];
                        let sale_price = [];
                        let junse = [];
                        let mnthly_rent = [];
                        let trnstn_count = [];
                        let converted_mnthly_rent = [];
                        let price_avg_per_cnstrtn_area = [];
                        let floor = [];

                        let trans_type = '';
                        $.each(features, function (i, sub_feature) {
                            console.log(sub_feature);
                            let item = sub_feature.properties;

                            if (transType !== '4') {
                                bldng_ko_nm = item.bldng_ko_nm;
                                address = item.address;
                                trnstn_clsftn_code = item.trnstn_clsftn_code;
                                house_clsftn_code = item.house_clsftn_code;
                                yyyymm.push(hmsUtil.getDateToKor(item.yyyymm, true));
                                build_yyyy.push(hmsUtil.getDateToKor(item.build_yyyy));
                                cnstrtn_area.push(item.cnstrtn_area);
                                exclsv_area.push(item.exclsv_area);
                                sale_price.push(item.sale_price);
                                junse.push(hmsUtil.getNullValue(item.junse, 0));
                                mnthly_rent.push(hmsUtil.getNullValue(hmsUtil.setComma(item.mnthly_rent), 0));
                                trnstn_count.push(item.trnstn_count);
                                converted_mnthly_rent.push(item.converted_mnthly_rent);
                                price_avg_per_cnstrtn_area.push(item.price_avg_per_cnstrtn_area);
                                floor.push(item.floor);
                            } else {
                                bldng_ko_nm = item.bldng_ko_nm;
                                address = item.address;
                                yyyymm.push(hmsUtil.getDateToKor(item.yyyymm, true));
                                cnstrtn_area.push(item.cnstrtn_area);
                                exclsv_area.push(item.exclsv_area);
                                sale_price.push(item.supply_price);
                                price_avg_per_cnstrtn_area.push(item.supply_price_avg_per_cnstrtn_area);
                            }
                        });

                        var average = arr => arr.reduce((p, c) => p + c, 0) / arr.length;
                        var quantile4 = function (arr, quantile) {
                            let sortedArr = arr.sort(function (a, b) {
                                return a - b
                            });
                            let len = arr.length;

                            var per75 = Math.floor(len * .75) - 1;
                            return sortedArr.slice(per75, len)
                        };

                        if (transType !== '4') {
                            let resultContent = '<span><strong>단지명</strong> : </span>' + bldng_ko_nm + '<br>' +
                                '<span><strong>지번 주소</strong> : </span>' + address + '<br>' +
                                '<span><strong>매물 종류</strong> : </span>' + trnstn_clsftn_code + '<br>' +
                                '<span><strong>주택 구분</strong> : </span>' + house_clsftn_code + '<br>' +
                                '<span><strong>평균 매매가</strong> : </span>' + hmsUtil.setComma(average(hmsUtil.getNullValue(sale_price, 0)).toFixed(0)) + ' (만 원)<br>' +
                                '<span><strong>평균 보증금</strong> : </span>' + hmsUtil.setComma(average(hmsUtil.getNullValue(junse, 0)).toFixed(0)) + ' (만 원)<br>' +
                                '<span><strong>평균 환산 월세</strong> : </span>' + hmsUtil.setComma(average(hmsUtil.getNullValue(converted_mnthly_rent, 0)).toFixed(0)) + ' (만 원)<br>' +
                                '<span><strong>평균 평당가</strong> : </span>' + hmsUtil.setComma(average(hmsUtil.getNullValue(price_avg_per_cnstrtn_area, 0)).toFixed(0)) + ' (만 원)<br>' +
                                '<span><strong>상위 평당가</strong> : </span>' + hmsUtil.setComma(average(quantile4(hmsUtil.getNullValue(price_avg_per_cnstrtn_area, 0))).toFixed(0)) + ' (만 원)<br>';
                            resultContent +=
                                '<h4 class="text-center">< 가격 변동 개요 ></h4>' +
                                '<div style="height: 156px; overflow: auto">' +
                                '<table class="table table-condensed" style="width: 790px;">' +
                                '<tr>' +
                                '<th class="text-center">거래일자</th>' +
                                '<th class="text-center">건축 년도</th>' +
                                '<th class="text-center">계약 면적</th>' +
                                '<th class="text-center">전용 면적</th>' +
                                //                            '<th class="text-center">층 수</th>' +
                                '<th class="text-center">매매가</th>' +
                                '<th class="text-center">보증금</th>' +
                                '<th class="text-center">월세</th>' +
                                '<th class="text-center">평당가</th>' +
                                '</tr>';
                            for (var i = 0; i < features.length; i++) {
                                resultContent +=
                                    '<tr>' +
                                    '<td class="text-center">' + yyyymm[i] + ' </td>' +
                                    '<td class="text-center">' + build_yyyy[i] + '</td>' +
                                    '<td class="text-center">' + cnstrtn_area[i] + ' (m<sup>2</sup>)</td>' +
                                    '<td class="text-center">' + exclsv_area[i] + ' (m<sup>2</sup>)</td>' +
                                    //                            '<td class="text-center">' + floor[i] + '</td>' +
                                    '<td class="text-center">' + hmsUtil.getNullValue(hmsUtil.setComma(sale_price[i]), 0) + ' 만 원</td>' +
                                    '<td class="text-center">' + hmsUtil.getNullValue(hmsUtil.setComma(junse[i]), 0) + ' 만 원</td>' +
                                    '<td class="text-center">' + hmsUtil.getNullValue(hmsUtil.setComma(converted_mnthly_rent[i]), 0) + ' 만 원</td>' +
                                    '<td class="text-center">' + hmsUtil.getNullValue(price_avg_per_cnstrtn_area[i], 0).toFixed(0) + ' 만 원</td>' +
                                    '</tr>';
                            }

                            resultContent += '</table></div>';
                            content.innerHTML = resultContent;
                        } else {
                            let resultContent = '<span><strong>단지명</strong> : </span>' + bldng_ko_nm + '<br>' +
                                '<span><strong>지번 주소</strong> : </span>' + address + '<br>' +
                                '<span><strong>구분</strong> : </span>' + '분양권' + '<br>' +
                                '<span><strong>평균 거래금액</strong> : </span>' + hmsUtil.getNullValue(hmsUtil.setComma(average(sale_price).toFixed(0)), 0) + ' (만 원)<br>' +
                                '<span><strong>평균 평당가</strong> : </span>' + hmsUtil.getNullValue(hmsUtil.setComma(average(price_avg_per_cnstrtn_area).toFixed(0)), 0) + ' (만 원)<br>' +
                                '<span><strong>상위 평당가</strong> : </span>' + hmsUtil.getNullValue(hmsUtil.setComma(average(quantile4(price_avg_per_cnstrtn_area)).toFixed(0)), 0) + ' (만 원)<br>';

                            resultContent +=
                                '<h4 class="text-center">< 가격 변동 개요 ></h4>' +
                                '<div style="height: 156px; overflow: auto">' +
                                '<table class="table table-condensed" style="width: 790px;">' +
                                '<tr>' +
                                '<th class="text-center">거래일자</th>' +
                                '<th class="text-center">계약 면적</th>' +
                                '<th class="text-center">전용 면적</th>' +
                                '<th class="text-center">거래금</th>' +
                                '<th class="text-center">평당가</th>' +
                                '</tr>';
                            for (var i = 0; i < features.length; i++) {
                                resultContent +=
                                    '<tr>' +
                                    '<td class="text-center">' + yyyymm[i] + ' </td>' +
                                    '<td class="text-center">' + cnstrtn_area[i] + ' (m<sup>2</sup>)</td>' +
                                    '<td class="text-center">' + exclsv_area[i] + ' (m<sup>2</sup>)</td>' +
                                    '<td class="text-center">' + hmsUtil.setComma(hmsUtil.getNullValue(sale_price[i], 0).toFixed(0)) + ' 만 원</td>' +
                                    '<td class="text-center">' + hmsUtil.setComma(hmsUtil.getNullValue(price_avg_per_cnstrtn_area[i], 0).toFixed(0)) + ' 만 원</td>' +
                                    '</tr>';
                            }

                            resultContent += '</table></div>';
                            content.innerHTML = resultContent;
                        }
                        overlay.setPosition(evt.coordinate);
                    }
                });
            }
        })
    }

    function set_trnstn_situtn_price_bubble(form) {
        let param = form.serializeArray();

        let paramLength = param.length;
        let transType = '';
        for (let i = 0; i < paramLength; i++) {
            if (param[i].name === 'tsp_trans_type') {
                transType = param[i].value;
                break;
            }
        }

        $.ajax({
            url: '{{ url_for("situation.srch_trnstn_situtn_price") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=bubble',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
                numArr = [];
            }
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                numArr.push(item.total_sum);
            });
            bubbleData = data.rows;
            console.dir(bubbleData);
            maxNum = Math.max.apply(null, numArr);
            minNum = Math.min.apply(null, numArr);

            setBubbleMap('avg');
            if (transType !== '4'){
                setGeoHeatMap('hms:trnstn_situtn_heatmap_ssss', form.serialize());
            } else {
                setGeoHeatMap('hms:trnstn_situtn_supply_heatmap_ssss', form.serialize());
            }
        }).fail(function (data) {
            alert(data.msg);
        });

        map.addControl(timeBarControl);
        let start = $('#tsp_syear').val() + '' + $('#tsp_smonth').val();
        let end = $('#tsp_eyear').val() + '' + $('#tsp_emonth').val();

        if (transType !== '4'){
            heatMapSlider.setHeatMapSlider(start, end, 'hms:trnstn_situtn_heatmap_ssss', form.serialize());
        } else {
            heatMapSlider.setHeatMapSlider(start, end, 'hms:trnstn_situtn_supply_heatmap_ssss', form.serialize());
        }
    }

    function set_trnstn_situtn_price_table(form){
        $('#pivotTitle').html(
            '<h4 style="margin-top: 0px;">< ' + FUNC.TRNSTN_SITUTN_PRICE.KOR_NAME + ' 결과 표 ></h4>'
        );

        let hmsTable;
        $.ajax({
            method: 'POST',
            url: '{{ url_for("situation.srch_trnstn_situtn_price") }}',
            data: form.serialize() + '&req_type=grid',
            dataType: 'json'
        }).done(function (data) {
            $('#pivot-table').html("<table id='pivotTables'></table>");
            console.log(data);
            hmsTable = new HmsSituationTable('pivot-table', data.cols, data.rows, FUNC.TRNSTN_SITUTN_PRICE.KOR_NAME, 'avg')
        }).complete(function () {
            hmsTable.setTableData();
            hmsTable.addDownload('pivot-download', 'btn-download', 'excel');
            hmsTable.addTimeseries('pivot-timeseries');

            $("#pivotTables").jqGrid().trigger('reloadGrid');

            hmsTable.addTimeseries('pivot-timeseries', hmsTable);
        });
    }

//    {# 입주물량 검색 #}
    function srch_idnfln_bldng() {
        if($('#spn-ib-area').text() === '') {
            alert('지역을 선택해 주세요.');
        } else {
            resetMapLayer();

            let form = $('#frm-west-5');
            if (set_idnftn_bldng_check(form)){
                codeStyle = FUNC.IDNFTN_BLDNG.CODE_STYLE;
                gridData = [];

                get_target_area('spn-ib-area', FUNC.IDNFTN_BLDNG.LOCATION_TYPE);
                updateDistAreaLayer(
                    FUNC.IDNFTN_BLDNG.LOCATION_TYPE,
                    get_low_area_cds(FUNC.IDNFTN_BLDNG.LOCATION_TYPE, locationDepth, locationCode)
                );

                // set_idnftn_bldng_list(form);
                // set_idnftn_bldng_map(form);
                // set_idnftn_bldng_bubble(form);
                set_idnftn_bldng_table(form);

                setAppendedAll(true);
            } else {
                alert('검색 결과가 없습니다. 검색조건을 변경해 주세요.');
            }


            setAppendedAll(true);
        }
    }

    function set_idnftn_bldng_check(form) {
        let hasData = false;
        $.ajax({
            url: '{{ url_for("situation.srch_idnfln_bldng") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=check',
            async: false,
            dataType: 'json'
        }).done(function (data) {
            hasData = data.hasData;
        });

        return hasData;
    }

    function set_idnftn_bldng_list(form) {
        $.ajax({
            url: '{{ url_for("situation.srch_idnfln_bldng") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=list',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
            }
        }).done(function (data) {
            listViewArr = data.rows;
            listViewTarget = FUNC.IDNFTN_BLDNG.CODE_STYLE;
            map.addControl(listViewControl);
        });
    }

    function set_idnftn_bldng_map(form) {
        let layer = 'hms:idntfn_bldng_ssss';
        poiLayerName = layer;

        FUNC.IDNFTN_BLDNG.MAP_LAYER = new ol.layer.Image({
            title: FUNC.IDNFTN_BLDNG.KOR_NAME,
            zIndex: LAYER_ZINDEX.RESULT_MAP,
            source: new ol.source.ImageWMS({
                ratio: 1,
                url: url,
                params: {
                    'VERSION': '1.1.1',
                    'CQL_FILTER': getIBCql(form.serialize()),
                    STYLES: '',
                    LAYERS: layer,
                }
            })
        });

        map.addLayer(FUNC.IDNFTN_BLDNG.MAP_LAYER);
        FUNC.IDNFTN_BLDNG.MAP_LAYER.setVisible(true);

        map.on('click', function (evt) {
            let view = map.getView();
            let viewResolution = view.getResolution();
            let source = FUNC.IDNFTN_BLDNG.MAP_LAYER.getSource();
            let url = source.getGetFeatureInfoUrl(
                evt.coordinate, viewResolution, view.getProjection(),
                {'INFO_FORMAT': 'application/json', 'FEATURE_COUNT': 1000});

            $.getJSON(url, function(data) {
                if(data.features.length > 0) {
                    let features = data.features;
                    let area_location_kor = undefined;
                    let building_kor = undefined;
                    let area_wide = undefined;
                    let build_wide = undefined;
                    let building_exist = undefined;
                    let area_ratio = undefined;
                    let a_floor = undefined;
                    let b_floor = undefined;
                    let permission_using_date = undefined;
                    let parking_sum = undefined;
                    let height = undefined;
                    let exclsv_area = [];
                    let count_family = [];

                    $.each(features, function (i, sub_feature) {
                        let item = sub_feature.properties;

                        if (i === 0){
                            building_kor = item.building_kor;
                        }

                        if (item.building_kor === building_kor) {
                            area_location_kor = item.area_location_kor;
                            area_wide = item.area_wide;
                            build_wide = item.build_wide;
                            building_exist = item.building_exist;
                            area_ratio = item.area_ratio;
                            a_floor = item.a_floor;
                            b_floor = item.b_floor;
                            permission_using_date = item.permission_using_date;
                            parking_sum = item.parking_sum;
                            height = item.height;
                            exclsv_area.push(item.exclsv_area);
                            count_family.push(item.count_family);
                        }
                    });

                    let resultContent = '<span><strong>건물명</strong> : </span>' + building_kor + '<br>' +
                        '<span><strong>주소</strong> : </span>' + area_location_kor + '<br>' +
                        '<span><strong>대지면적</strong> : </span>' + area_wide + '<br>' +
                        '<span><strong>건축면적</strong> : </span>' + build_wide + '<br>' +
                        '<span><strong>건폐율</strong> : </span>' + building_exist + '<br>' +
                        '<span><strong>용적률</strong> : </span>' + area_ratio + '<br>' +
                        '<span><strong>지상층</strong> : </span>' + a_floor + '<br>' +
                        '<span><strong>지하층</strong> : </span>' + b_floor + '<br>' +
                        '<span><strong>건물높이</strong> : </span>' + height + '<br>' +
                        '<span><strong>입주년도</strong> : </span>' + hmsUtil.getDateToKor(permission_using_date) + '<br>' +
                        '<span><strong>층세대수</strong> : </span>' + height + '<br>' +
                        '<span><strong>주차대수</strong> : </span>' + parking_sum + '<br>';
                    resultContent +=
                        '<h4 class="text-center">< 면적 별 세대수 ></h4>' +
                        '<div style="height: 156px; overflow: auto">' +
                        '<table class="table table-condensed" style="width: 600px;">' +
                        '<tr>' +
                        '<th class="text-center">전용 면적</th>' +
                        '<th class="text-center">세대수</th>' +
                        '</tr>';

                    for (var i = 0; i < features.length; i++) {
                        resultContent +=
                            '<tr>' +
                            '<td class="text-center">' + exclsv_area[i] + ' (m<sup>2</sup>)</td>' +
                            '<td class="text-center">' + count_family[i] + '</td>' +
                            '</tr>';
                    }

                    resultContent += '</table></div>';
                    content.innerHTML = resultContent;
                    overlay.setPosition(evt.coordinate);
                }
            });
        });
    }

    function set_idnftn_bldng_bubble(form) {
        $.ajax({
            url: '{{ url_for("situation.srch_idnfln_bldng") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=bubble',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
            }
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                numArr.push(item.total_sum);
            });
            bubbleData = data.rows;

            maxNum = Math.max.apply(null, numArr);
            minNum = Math.min.apply(null, numArr);

            bubbleData = data.rows;

            setBubbleMap();
            setGeoHeatMap('hms:idntfn_bldng_heatmap_ssss', form.serialize())
        })
    }

    function set_idnftn_bldng_table(form) {
        $('#pivotTitle').html(
            '<h4 style="margin-top: 0px;">< ' + FUNC.IDNFTN_BLDNG.KOR_NAME + ' 결과 표 ></h4>'
        );

        let hmsTable;
        $.ajax({
            method: 'POST',
            url: '{{ url_for("situation.srch_idnfln_bldng") }}',
            data: form.serialize() + '&req_type=grid',
            dataType: 'json'
        }).done(function (data) {
            $('#pivot-table').html("<table id='pivotTables'></table>");
            console.log(data);
            hmsTable = new HmsSituationTable('pivot-table', data.cols, data.rows, FUNC.IDNFTN_BLDNG.KOR_NAME, 'avg')
        }).complete(function () {
            hmsTable.setTableData();
            hmsTable.addDownload('pivot-download', 'btn-download', 'excel');

            $("#pivotTables").jqGrid().trigger('reloadGrid');

            hmsTable.addTimeseries('pivot-timeseries', hmsTable);
        });
    }

//    {# 자영업현황 검색 #}
    function srch_busins_situtn() {
        if($('#spn-bs-area').text() === '') {
            alert('지역을 선택해 주세요.');
        } else {
            resetMapLayer();

            let form = $('#frm-west-6');
            codeStyle = FUNC.BUSINS_SITUTN.CODE_STYLE;
            gridData = [];

            get_target_area('spn-bs-area', FUNC.BUSINS_SITUTN.LOCATION_TYPE);
            updateDistAreaLayer(
                FUNC.BUSINS_SITUTN.LOCATION_TYPE,
                get_low_area_cds(FUNC.BUSINS_SITUTN.LOCATION_TYPE, locationDepth, locationCode)
            );

            set_busins_situtn_map(form);
            set_busins_situtn_bubble(form);
            set_busins_situtn_table(form);

            setAppendedAll(true);
        }
    }
//    {# 자영업현황 맵 #}
    function set_busins_situtn_map(form){
        let layerName = FUNC.BUSINS_SITUTN.MAP_LAYER_NAME_FOR_GEO;
        poiLayerName = layerName;

        FUNC.BUSINS_SITUTN.MAP_LAYER = new ol.layer.Image({
            title: FUNC.BUSINS_SITUTN.KOR_NAME,
            zIndex: LAYER_ZINDEX.RESULT_MAP,
            source: new ol.source.ImageWMS({
                ratio: 1,
                url: url,
                params: {
                    'VERSION': '1.1.1',
                    'CQL_FILTER': getBSCql(form.serialize()),
                    STYLES: '',
                    LAYERS: layerName
                }
            })
        });

        map.addLayer(FUNC.BUSINS_SITUTN.MAP_LAYER);
        FUNC.BUSINS_SITUTN.MAP_LAYER.setVisible(true);

        map.on('click', function (evt){
            console.log(FUNC.BUSINS_SITUTN.MAP_LAYER);
            if (FUNC.BUSINS_SITUTN.MAP_LAYER) {
                let view = map.getView();
                let viewResolution = view.getResolution();
                let source = FUNC.BUSINS_SITUTN.MAP_LAYER.getSource();
                let url = source.getGetFeatureInfoUrl(
                    evt.coordinate, viewResolution, view.getProjection(),
                    {'INFO_FORMAT': 'application/json', 'FEATURE_COUNT': 1000}
                );

                $.getJSON(url, function(data) {
                    if(data.features.length > 0) {
                        let feature = data.features[0];
                        let properties = feature.properties;
                        console.log(feature);

                        content.innerHTML =
                            `<span><strong>상호명</strong> : </span>${properties.brand_nm}<br>` +
                            `<span><strong>주소</strong> : </span>${properties.prcl_addrs}<br>` +
                            `<span><strong>대분류</strong> : </span>${properties.busins_wide_cd}<br>` +
                            `<span><strong>중분류</strong> : </span>${properties.busins_narrow_cd}`;

                        overlay.setPosition(evt.coordinate);
                    }
                })
            }
        })
    }

//    {# 자영업현황 버블 #}
    function set_busins_situtn_bubble(form) {
        $.ajax({
            url: '{{ url_for("situation.srch_busins_situtn") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=bubble',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
                numArr = [];
            }
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                numArr.push(item.total_sum);
            });
            bubbleData = data.rows;
            maxNum = Math.max.apply(null, numArr);
            minNum = Math.min.apply(null, numArr);

            setBubbleMap();
            setGeoHeatMap('hms:busins_situtn', form.serialize(), false, "hms:heatmap");
        }).fail(function (data) {
            alert(data.msg);
        });
    }

//    {# 자영업현황 테이블 #}
    function set_busins_situtn_table(form) {
        $('#pivotTitle').html(
            '<h4 style="margin-top: 0px;">< ' + FUNC.BUSINS_SITUTN.KOR_NAME + ' 결과 표 ></h4>'
        );

        let hmsTable;
        $.ajax({
            method: 'POST',
            url: '{{ url_for("situation.srch_busins_situtn") }}',
            data: form.serialize() + '&req_type=grid',
            dataType: 'json'
        }).done(function (data) {
            $('#pivot-table').html("<table id='pivotTables'></table>");
            console.log(data);
            hmsTable = new HmsSituationTable('pivot-table', data.cols, data.rows, FUNC.BUSINS_SITUTN.KOR_NAME, 'sum')
        }).complete(function () {

            hmsTable.setTableData({
                'sid_ko_nm': '시도',
                'sgg_ko_nm': '시군구',
                'emd_ko_nm': '읍면동',
                'busins_wide_cd': '대분류',
                'busins_narrow_cd': '중분류',
                'busins_cnt': '업종수',
            },{
                'sid_ko_nm': '시도',
                'sgg_ko_nm': '시군구',
                'emd_ko_nm': '읍면동',
                'busins_wide_cd': '대분류',
                'busins_narrow_cd': '중분류',
            });
            hmsTable.addDownload('pivot-download', 'btn-download', 'excel');
            console.log(hmsTable);
            $("#pivotTables").jqGrid().trigger('reloadGrid');
        });
    }

//    {# 세대통계 검색 #}
    function srch_hshold_imgrat() {
        if($('#spn-hi-area').text() === '') {
            alert('지역을 선택해 주세요.');
        } else {
            resetMapLayer();

            let form = $('#frm-west-7');
            if (true) {
                codeStyle = FUNC.HSHOLD_IMGRAT.CODE_STYLE;
                gridData = [];

                get_target_area('spn-hi-area', FUNC.HSHOLD_IMGRAT.LOCATION_TYPE);
                updateDistAreaLayer(
                    FUNC.HSHOLD_IMGRAT.LOCATION_TYPE,
                    get_low_area_cds(FUNC.HSHOLD_IMGRAT.LOCATION_TYPE, locationDepth, locationCode)
                );

                set_hshold_imgrat_map(form);
                set_hshold_imgrat_bubble(form);
                set_hshold_imgrat_table(form);

                setAppendedAll(true);
            } else {
                alert('검색 결과가 없습니다. 검색조건을 변경해 주세요.');
            }
        }
    }

    //    {# 세대통계 맵 #}
    function set_hshold_imgrat_map(form) {
        var year = $('#hi_eyear').val();
        var month = $('#hi_emonth').val();
        var selected_area = $('#spn-hi-area').text();
        $.ajax({
            url: '{{ url_for("situation.srch_hshold_imgrat") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=map',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
            }
        }).done(function (data) {
            var cooordinates;
            var content_val;
            var sum = 0;
            $.each(data.rows, function (i, item) {
                sum += item.hshold_num;
//                content.innerHTML = '<span class="label label-success" style="display: inline-block;">' + selected_area +
//                    '</span><br>' + year + '년 ' + month + '월, 선택 연령대 인구수: ' + hmsUtil.setComma(item.hshold_num) + '(세대)';
                content_val = '<span class="label label-success" style="display: inline-block;">' + selected_area +
                    '</span><br>' + year + '년 ' + month + '월, 선택 연령대 인구수: ' + hmsUtil.setComma(item.hshold_num) + '(세대)';

                cooordinates = item.coordinates;
            });
            content_val = '<span class="label label-success" style="display: inline-block;">' + selected_area +
                    '</span><br>' + year + '년 ' + month + '월, 선택 연령대 인구수: ' + hmsUtil.setComma(sum) + '(세대)';

            content.innerHTML = content_val;
            overlay.setPosition(cooordinates);
        }).fail(function (data) {
            alert(data.msg);
        });
    }

//    {# 세대통계 버블 #}
    function set_hshold_imgrat_bubble(form) {
        $.ajax({
            url: '{{ url_for("situation.srch_hshold_imgrat") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=bubble',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
                numArr = [];
            }
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                numArr.push(item.total_sum);
            });
            bubbleData = data.rows;
            maxNum = Math.max.apply(null, numArr);
            minNum = Math.min.apply(null, numArr);

            setBubbleMap();
            // setGeoHeatMap('hms:trnstn_heatmap', get_selected_area(form.serialize()));
        }).fail(function (data) {
            alert(data.msg);
        });
    }

//    {# 세대통계 테이블 #}
    function set_hshold_imgrat_table(form) {
        $('#pivotTitle').html(
            '<h4 style="margin-top: 0px;">< ' + FUNC.HSHOLD_IMGRAT.KOR_NAME + ' 결과 표 ></h4>'
        );

        let hmsTable;
        $.ajax({
            method: 'POST',
            url: '{{ url_for("situation.srch_hshold_imgrat") }}',
            data: form.serialize() + '&req_type=grid',
            dataType: 'json'
        }).done(function (data) {
            $('#pivot-table').html("<table id='pivotTables'></table>");
            console.log(data);
            hmsTable = new HmsSituationTable('pivot-table', data.cols, data.rows, FUNC.HSHOLD_IMGRAT.KOR_NAME, 'sum')
        }).complete(function () {
            hmsTable.setTableData();
            hmsTable.addDownload('pivot-download', 'btn-download', 'excel');
            // hmsTable.addDownload('pdf', 'pdf-download', 'pdf');
            // hmsTable.addDownload('csv', 'csv-download', 'csv');
            hmsTable.addTimeseries('pivot-timeseries');

            $("#pivotTables").jqGrid().trigger('reloadGrid');

            hmsTable.addTimeseries('pivot-timeseries', hmsTable);
        });
    }

//    {# 분양현황 검색 #}
    function srchSupplyPresent() {
        if($('#spn-sp-area').text() == '') {
            alert('지역을 선택해 주세요.');
        } else {
            resetMapLayer();

            let form = $('#frm-west-8');
            if (set_supply_present_check(form)) {
                codeStyle = FUNC.SUPPLY_PRESENT.CODE_STYLE;
                gridData = [];

                get_target_area('spn-sp-area', FUNC.SUPPLY_PRESENT.LOCATION_TYPE);
                updateDistAreaLayer(
                    FUNC.SUPPLY_PRESENT.LOCATION_TYPE,
                    get_low_area_cds(FUNC.SUPPLY_PRESENT.LOCATION_TYPE, locationDepth, locationCode)
                );

                set_supply_present_list(form);
                // set_supply_present_card_list(form);
                set_supply_present_map(form);

                setGeoHeatMap('hms:supply_present_heatmap', form.serialize());
                // set_supply_present_bubble(form);
                set_supply_present_table(form);

                setAppendedAll(true);
            } else {
                alert('검색 결과가 없습니다. 검색조건을 변경해 주세요.');
            }
        }
    }

    function srchSupplyPresentPrediction(type) {
        if (type === "yearly") {
            srchSupplyPresentPredYearly();
        } else if (type === "monthly") {
            srchSupplyPresentPredMonthly();
        } else {
            throw new Error("Invalid data Format");
        }


    }

    function srchSupplyPresentPredMonthly() {
        resetMapLayer();

        FUNC.SUPPLY_PRESENT.MAP_LAYER = new ol.layer.Image({
                        title: FUNC.SUPPLY_PRESENT.KOR_NAME,
            zIndex: LAYER_ZINDEX.RESULT_MAP,
            source: new ol.source.ImageWMS({
                ratio: 1,
                url: url,
                params: {
                    'VERSION': '1.1.1',
                    // 'CQL_FILTER': getSPCql(form.serialize()),
                    STYLES: '',
                    LAYERS: 'hms:supply_mnthly',
                }
            })
        });

        map.addLayer(FUNC.SUPPLY_PRESENT.MAP_LAYER);
        FUNC.SUPPLY_PRESENT.MAP_LAYER.setVisible(true);

        map.on('click', function (evt){
            if (FUNC.SUPPLY_PRESENT.MAP_LAYER) {
                let view = map.getView();
                let viewResolution = view.getResolution();
                let source = FUNC.SUPPLY_PRESENT.MAP_LAYER.getSource();
                let url = source.getGetFeatureInfoUrl(
                    evt.coordinate, viewResolution, view.getProjection(),
                    {'INFO_FORMAT': 'application/json', 'FEATURE_COUNT': 1000});

                $.getJSON(url, function(data) {
                    $.each(features, function (i, sub_feature) {

                    })
                })
            }
        })
    }

    function srchSupplyPresentPredYearly() {
        resetMapLayer();
        FUNC.SUPPLY_PRESENT.MAP_LAYER = new ol.layer.Image({
            title: FUNC.SUPPLY_PRESENT.KOR_NAME,
            zIndex: LAYER_ZINDEX.RESULT_MAP,
            source: new ol.source.ImageWMS({
                ratio: 1,
                url: url,
                params: {
                    'VERSION': '1.1.1',
                    // 'CQL_FILTER': getSPCql(form.serialize()),
                    STYLES: '',
                    LAYERS: 'hms:supply_yearly',
                }
            })
        });

        map.addLayer(FUNC.SUPPLY_PRESENT.MAP_LAYER);
        FUNC.SUPPLY_PRESENT.MAP_LAYER.setVisible(true);
    }

    // 검색 결과 유무는 데이터 갯수로 체크
    function set_supply_present_check(form) {
        let hasData = false;

        $.ajax({
            url: '{{ url_for("situation.srch_supply_present") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=check',
            dataType: 'json',
            async: false,
        }).done(function (data) {
            hasData = data.hasData;
        });

        return hasData;
    }

    function set_supply_present_list(form) {
        $.ajax({
            url: '{{ url_for("situation.srch_supply_present") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=list',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
            }
        }).done(function (data) {
            listViewArr = data.rows;
            listViewTarget = FUNC.SUPPLY_PRESENT.CODE_STYLE;

            map.addControl(listViewControl);
        })
    }

    function set_supply_present_card_list(form) {
        $.ajax({
            url: '{{ url_for("situation.srch_supply_present") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=card_list',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
            }
        }).done(function (data) {
            let resultArr = [
            ];

            let tempObject = {};
            $.each(data.rows, function(i, item) {
                // let key = item.bldng_ko_name;
                tempObject = {[item.bldng_ko_name]: {
                    'geom': item.geom,
                    'bldng_ko_name': item.bldng_ko_name,
                    'general_unit': item.general_unit,
                    'special_unit': item.special_unit,
                    'yyyymm': item.yyyymm,
                    'move_in_yyyymm': item.move_in_yyyymm,
                    'exclsv_area': item.exclsv_area,
                    'price': item.price,
                    'price_per_supply_area': item.price_per_supply_area
                }};

                if (!hasKey(resultArr, [item.bldng_ko_name])) {
                    resultArr.push(tempObject);
                }
            });

            map.addControl(cardViewControl);
        })

        function hasKey(arr, key) {
            key = key + "";
            $.each(arr, function(i, item) {
                if (item[Object.keys(item)[0]] === key) {
                    return true;
                }
            })
        }
    }

//    {# 분양현황 맵 #}
    function set_supply_present_map(form) {
        poiLayerName = "hms:supply_present";

        let param = form.serializeArray();

        let paramLength = param.length;
        let spType = '';
        for (let i = 0; i < paramLength; i++) {
            if (param[i].name === 'sp_type') {
                spType = param[i].value;
                break;
            }
        }

        FUNC.SUPPLY_PRESENT.MAP_LAYER = new ol.layer.Image({
            title: FUNC.SUPPLY_PRESENT.KOR_NAME,
            zIndex: LAYER_ZINDEX.RESULT_MAP,
            source: new ol.source.ImageWMS({
                ratio: 1,
                url: url,
                params: {
                    'VERSION': '1.1.1',
                    'CQL_FILTER': getSPCql(form.serialize()),
                    STYLES: '',
                    LAYERS: 'hms:supply_present',
                }
            })
        });

        map.addLayer(FUNC.SUPPLY_PRESENT.MAP_LAYER);
        FUNC.SUPPLY_PRESENT.MAP_LAYER.setVisible(true);

        map.on('click', function (evt){
            if (FUNC.SUPPLY_PRESENT.MAP_LAYER) {
                let view = map.getView();
                let viewResolution = view.getResolution();
                let source = FUNC.SUPPLY_PRESENT.MAP_LAYER.getSource();
                let url = source.getGetFeatureInfoUrl(
                    evt.coordinate, viewResolution, view.getProjection(),
                    {'INFO_FORMAT': 'application/json', 'FEATURE_COUNT': 1000});

                $.getJSON(url, function(data) {
                    if(data.features.length > 0) {
                        let features = data.features;
                        let bldng_ko_name = undefined;
                        let address = undefined;
                        let yyyymm = undefined;
                        let supply_unit = [];
                        let result_announcement_yyyymm = undefined;
                        let contract_yyyymmdd_start = undefined;
                        let contract_yyyymmdd_end = undefined;
                        let supply_clsftn = [];
                        let supply_area = [];
                        let general_unit = [];
                        let special_unit = [];
                        let price = [];
                        let price_per_supply_area = [];
                        let developer = undefined;
                        let builder = undefined;
                        let homepage1 = undefined;
                        let homepage2 = undefined;

                        $.each(features, function (i, sub_feature) {
                            let item = sub_feature.properties;

                            if (i === 0) {
                                bldng_ko_name = item.bldng_ko_name;
                            }

                            if (item.bldng_ko_name === bldng_ko_name){
                                bldng_ko_name = item.bldng_ko_name;
                                yyyymm = item.yyyymm;
                                address = item.address;
                                supply_unit.push(item.supply_unit);
                                result_announcement_yyyymm = item.result_announcement_yyyymm;
                                contract_yyyymmdd_start = item.contract_yyyymmdd_start;
                                contract_yyyymmdd_end = item.contract_yyyymmdd_end;
                                supply_clsftn.push(item.supply_clsftn);
                                supply_area.push(item.supply_area);
                                general_unit.push(item.general_unit);
                                special_unit.push(item.special_unit);
                                price.push(item.price);
                                price_per_supply_area.push(item.price_per_supply_area);
                                developer = item.developer;
                                builder = item.builder;
                                homepage1 = item.homepage1;
                                homepage2 = item.homepage2;
                            }
                        });

                        var average = arr => arr.reduce((p, c) => p + c, 0) / arr.length;
                        var sum = arr => arr.reduce((p, c) => p + c, 0);

                        if (spType === '1') {
                            let resultContent = '<span><strong>단지명</strong> : </span>' + bldng_ko_name + '<br>' +
                                '<span><strong>위치</strong> : </span>' + address + '<br>' +
                                '<span><strong>분양 년월</strong> : </span>' + hmsUtil.getDateToKor(yyyymm, true) + '<br>' +
                                '<span><strong>평균 공급 세대수</strong> : </span>' + average(supply_unit).toFixed(1) + '<br>' +
                                '<span><strong>당첨자 발표일</strong> : </span>' + hmsUtil.getDateToKor(result_announcement_yyyymm, true) + '<br>' +
                                '<span><strong>계약일</strong> : </span>' + hmsUtil.getDateToKor(contract_yyyymmdd_start, true) + ' &ac; ' + hmsUtil.getDateToKor(contract_yyyymmdd_end, true) + '<br>' +
                                '<span><strong>시행사</strong> : </span>' + developer + '<br>' +
                                '<span><strong>시공사</strong> : </span>' + builder + '<br>';
                            if (homepage1 && homepage2) {
                                resultContent += '<span><strong>홈페이지</strong> : </span>' + '<a href="http://' + homepage1 + '" target="_sub">' + homepage1 + '</a>' + ' / ' + '<a href="http://' + homepage2 + '" target="_sub">' + homepage2 + '</a>' + '<br>';
                            } else if (homepage1) {
                                resultContent += '<span><strong>홈페이지</strong> : </span>' + '<a href="http://' + homepage1 + '" target="_sub">' + homepage1 + '</a>' + '<br>';
                            } else if (homepage2) {
                                resultContent += '<span><strong>홈페이지</strong> : </span>' + '<a href="http://' + homepage2 + '" target="_sub">' + homepage2 + '</a>' + '<br>';
                            } else {
                                '<span><strong>홈페이지</strong> : </span>' + '없음' + '<br>';
                                ;
                            }

                            resultContent +=
                                '<h4 class="text-center">< 공급 세대수 개요 ></h4>' +
                                '<div style="height: 156px; overflow: auto">' +
                                '<table class="table table-condensed" style="width: 600px;">' +
                                '<tr>' +
                                '<th class="text-center">주택형</th>' +
                                '<th class="text-center">공급면적</th>' +
                                '<th class="text-center">일반공급</th>' +
                                '<th class="text-center">특별공급</th>' +
                                '<th class="text-center">공급세대수</th>' +
                                '</tr>';

                            for (var i = 0; i < features.length; i++) {
                                resultContent +=
                                    '<tr>' +
                                    '<td class="text-center">' + supply_clsftn[i] + ' </td>' +
                                    '<td class="text-center">' + supply_area[i] + ' (m<sup>2</sup>)</td>' +
                                    '<td class="text-center">' + general_unit[i] + ' (세대)</td>' +
                                    '<td class="text-center">' + special_unit[i] + ' (세대)</td>' +
                                    '<td class="text-center">' + supply_unit[i] + ' (세대)</td>' +
                                    '</tr>';
                            }

                            resultContent += '</table></div>';
                            content.innerHTML = resultContent;
                        } else {
                            let resultContent = '<span><strong>단지명</strong> : </span>' + bldng_ko_name + '<br>' +
                                '<span><strong>위치</strong> : </span>' + address + '<br>' +
                                '<span><strong>분양 년월</strong> : </span>' + hmsUtil.getDateToKor(yyyymm, true) + '<br>' +
                                '<span><strong>평균 평당가</strong> : </span>' + average(price_per_supply_area).toFixed(1) + '<br>' +
                                '<span><strong>당첨자 발표일</strong> : </span>' + hmsUtil.getDateToKor(result_announcement_yyyymm, true) + '<br>' +
                                '<span><strong>계약일</strong> : </span>' + hmsUtil.getDateToKor(contract_yyyymmdd_start, true) + ' &ac; ' + hmsUtil.getDateToKor(contract_yyyymmdd_end, true) + '<br>';
                            if (homepage1 && homepage2) {
                                resultContent += '<span><strong>홈페이지</strong> : </span>' + '<a href="http://' + homepage1 + '" target="_sub">' + homepage1 + '</a>' + ' / ' + '<a href="http://' + homepage2 + '" target="_sub">' + homepage2 + '</a>' + '<br>';
                            } else if (homepage1) {
                                resultContent += '<span><strong>홈페이지</strong> : </span>' + '<a href="http://' + homepage1 + '" target="_sub">' + homepage1 + '</a>' + '<br>';
                            } else if (homepage2) {
                                resultContent += '<span><strong>홈페이지</strong> : </span>' + '<a href="http://' + homepage2 + '" target="_sub">' + homepage2 + '</a>' + '<br>';
                            } else {
                                '<span><strong>홈페이지</strong> : </span>' + '없음' + '<br>';
                            }

                            resultContent +=
                                '<h4 class="text-center">< 평균 평당가 개요 ></h4>' +
                                '<div style="height: 156px; overflow: auto">' +
                                '<table class="table table-condensed" style="width: 600px;">' +
                                '<tr>' +
                                '<th class="text-center">주택형</th>' +
                                '<th class="text-center">분양가</th>' +
                                '<th class="text-center">평당가</th>' +
                                '</tr>';

                            for (var i = 0; i < features.length; i++) {
                                resultContent +=
                                    '<tr>' +
                                    '<td class="text-center">' + supply_clsftn[i] + ' </td>' +
                                    '<td class="text-center">' + hmsUtil.setComma(hmsUtil.getNullValue(price[i], 0).toFixed(0)) + ' (원)</td>' +
                                    '<td class="text-center">' + hmsUtil.setComma(hmsUtil.getNullValue(price_per_supply_area[i], 0).toFixed(0)) + ' (원)</td>' +
                                    '</tr>';
                            }

                            resultContent += '</table></div>';
                            content.innerHTML = resultContent;
                        }
                        overlay.setPosition(evt.coordinate);
                    }
                });
            }
        })
    }


//    {# 분양현황 버블 #}
    function set_supply_present_bubble(form) {
        let param = form.serializeArray();

        let paramLength = param.length;
        let spType = '';
        for (let i = 0; i < paramLength; i++) {
            if (param[i].name === 'sp_type') {
                spType = param[i].value;
                break;
            }
        }

        $.ajax({
            url: '{{ url_for("situation.srch_supply_present") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=bubble',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
                numArr = [];
            }
        }).done(function (data) {
            //
            // console.log(data);
            // $.each(data.rows.end, function (i, item) {
            //     numArr.push(item.total_sum);
            // });
            // bubbleData = data.rows.end;
            // maxNum = Math.max.apply(null, numArr);
            // minNum = Math.min.apply(null, numArr);
            //
            // if (spType == '1') {
            //     setBubbleMap('sum');
            // } else {
            //     setBubbleMap('avg');
            // }


        }).fail(function (data) {
            alert(data.msg);
        });
    }

//    {# 분양현황 테이블 #}
    function set_supply_present_table(form) {
        // '{{ url_for("situation.srch_supply_present") }}'
        $('#pivotTitle').html(
            '<h4 style="margin-top: 0px;">< ' + FUNC.SUPPLY_PRESENT.KOR_NAME + ' 결과 표 ></h4>'
        );

        let hmsTable;
        $.ajax({
            method: 'POST',
            url: '{{ url_for("situation.srch_supply_present") }}',
            data: form.serialize() + '&req_type=grid',
            dataType: 'json'
        }).done(function (data) {
            $('#pivot-table').html("<table id='pivotTables'></table>");
            console.log(data);
            hmsTable = new HmsSituationTable('pivot-table', data.cols, data.rows, FUNC.SUPPLY_PRESENT.KOR_NAME, 'avg')
        }).complete(function () {
            hmsTable.setTableData();
            hmsTable.addDownload('pivot-download', 'btn-download', 'excel');
            // hmsTable.addDownload('pdf', 'pdf-download', 'pdf');
            // hmsTable.addDownload('csv', 'csv-download', 'csv');
            hmsTable.addTimeseries('pivot-timeseries');

            $("#pivotTables").jqGrid().trigger('reloadGrid');

            hmsTable.addTimeseries('pivot-timeseries', hmsTable);
        });
    }

//    {# 소득현황 검색 #}
    function srch_income_situtn() {
        if($('#spn-is-area').text() === '') {
            alert('지역을 선택해 주세요.');
        } else {
            resetMapLayer();

            let form = $('#frm-west-9');
            if (set_income_situtn_check(form)){
                codeStyle = FUNC.INCOME_SITUTN.CODE_STYLE;
                gridData = [];

                get_target_area('spn-is-area', FUNC.INCOME_SITUTN.LOCATION_TYPE);
                updateDistAreaLayer(FUNC.INCOME_SITUTN.LOCATION_TYPE,
                    get_low_area_cds(FUNC.INCOME_SITUTN.LOCATION_TYPE, locationDepth, locationCode)
                );

                set_income_situtn_bubble(form);
                set_income_situtn_table(form);

                setAppendedAll(true);
            } else {
                alert('검색 결과가 없습니다. 검색조건을 변경해 주세요.')
            }
        }
    }

//    {# 소득현황 체크 #}
    function set_income_situtn_check(form){
        let hasData = false;
        $.ajax({
            url: '{{ url_for("situation.srch_income_situtn") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=check',
            async: false,
            dataType: 'json'
        }).done(function (data) {
            hasData = data.hasData;
        });

        return hasData;
    }

//    {# 소득현황 버블 #}
    function set_income_situtn_bubble(form) {
        $.ajax({
            url: '{{ url_for("situation.srch_income_situtn") }}',
            method: 'POST',
            data: form.serialize() + '&req_type=bubble',
            dataType: 'json',
            beforeSend: function () {
                showLoader();
            },
            complete: function () {
                hideLoader();
                numArr = [];
            }
        }).done(function (data) {
            $.each(data.rows, function (i, item) {
                numArr.push(item.total_sum);
            });
            bubbleData = data.rows;
            maxNum = Math.max.apply(null, numArr);
            minNum = Math.min.apply(null, numArr);

            if ($('input:radio[name="is_type"]:checked').val() === '1') {
                setBubbleMap('avg');
            } else {
                setBubbleMap('sum');
            }

            setGeoHeatMap('hms:income_situtn_heatmap', form.serialize())
        }).fail(function (data) {
            alert(data.msg);
        });
    }

//    {# 소득현황 테이블 #}
    function set_income_situtn_table(form) {
        $('#pivotTitle').html(
            '<h4 style="margin-top: 0px;">< ' + FUNC.BUSINS_SITUTN.KOR_NAME + ' 결과 표 ></h4>'
        );

        let hmsTable;
        $.ajax({
            method: 'POST',
            url: '{{ url_for("situation.srch_income_situtn") }}',
            data: form.serialize() + '&req_type=grid',
            dataType: 'json'
        }).done(function (data) {
            $('#pivot-table').html("<table id='pivotTables'></table>");
            console.log(data);
            hmsTable = new HmsSituationTable('pivot-table', data.cols, data.rows, FUNC.BUSINS_SITUTN.KOR_NAME, 'sum')
        }).complete(function () {
            hmsTable.setTableData({
                'sid_ko_nm': '시도',
                'sgg_ko_nm': '시군구',
                'emd_ko_nm': '읍면동',
                'estimate_year_income': '1인 평균 연봉',
                'labor_count': '종사자 수'
            },{
                'sid_ko_nm': '시도',
                'sgg_ko_nm': '시군구',
                'emd_ko_nm': '읍면동',
            });
            hmsTable.addDownload('pivot-download', 'btn-download', 'excel');
            console.log(hmsTable);
            $("#pivotTables").jqGrid().trigger('reloadGrid');
        });
    }

    // Add slideDown animation to Bootstrap dropdown when expanding.
    $('.dropdown').on('show.bs.dropdown', function () {
        $(this).find('.dropdown-menu').first().stop(true, true).slideDown();
    });

    // Add slideUp animation to Bootstrap dropdown when collapsing.
    $('.dropdown').on('hide.bs.dropdown', function () {
        $(this).find('.dropdown-menu').first().stop(true, true).slideUp();
    });


    //    {# 선택한 지역을 검색조건으로 세팅 #}
    function set_areas(name_prefix, target_accordion, target_id, type) {
        setAreaPolygon(locationDepth, locationCode, type);

        var results = [];
        $('#div-sid-area').find('input[name$=-area]:checked').each(function () {
            results.push('<input locationDepth="sid" type="hidden" name="' + name_prefix + 'sid_cd" value="' + $(this).val() + '">');
            results.push('<span class="label label-success" style="display: inline-block;">' + $(this).parent().text() + '</span>\n');
        });
        $('#div-sgg-area').find('input[name$=-area]:checked').each(function () {
            results.push('<input locationDepth="sgg" type="hidden" name="' + name_prefix + 'sgg_cd" value="' + $(this).val() + '">');
            results.push('<span class="label label-success" style="display: inline-block;">' + $(this).parent().text() + '</span>\n');
        });
        $('#div-emd-area').find('input[name$=-area]:checked').each(function () {
            results.push('<input locationDepth="emd" type="hidden" name="' + name_prefix + 'emd_cd" value="' + $(this).val() + '">');
            results.push('<span class="label label-success" style="display: inline-block;">' + $(this).parent().text() + '</span>\n');
        });
        $('#' + target_id).html(results.join(''));
//        {# 실행 후 반드시 클릭 이벤트 오프를 해줌 #}
        $('#btn-area').button().off('click');
    }

    let sid_refresh = false;
    let sgg_refresh = false;
    let emd_refresh = false;
    function refresh_areas() {
        if(sid_refresh) {$('#div-sid-area').empty().removeClass('div-disable');}
        if(sgg_refresh) {$('#div-sgg-area').empty().removeClass('div-disable');}
        if(emd_refresh) {$('#div-emd-area').empty().removeClass('div-disable');}
    }

    //    {# 행정동 시도 지역 조회 후 세팅 #}
    function set_adm_sid_areas(input_type) {
        $.ajax({
            method: 'GET',
            url: '{{ url_for("common.get_adm_areas") }}',
            data: {},
            dataType: 'json'
        }).done(function (data) {
            let results = [];
            results.push('<div class="list-group">');
            $.each(data.items, function (i, item) {
                results.push('<a class="list-group-item" onclick="set_adm_sgg_areas(\'' + input_type + '\', \'' + item.sid_cd + '\');"> ' + item.sid_ko_nm + '<input id="sid-cd.' + item.sid_cd + '" name="' + input_type + '-area" type="' + input_type + '" class="pull-right" value="' + item.sid_cd + '" onclick = "setSelectedValueForLocationDecision(\'sid\', ' + item.sid_cd + ');" update_params(\'' + item.layers + '\', \'' + item.featureid + '\');"></a>');
            });
            results.push('</div>');
            $('#div-sid-area').html(results.join(''));
        }).fail(function (data) {
            console.log(data);
        });
    }

    //    {# 시도 코드로 행정동 시군구 지역 조회 후 세팅 #}
    function set_adm_sgg_areas(input_type, sid_cd) {
        $.ajax({
            method: 'GET',
            url: '{{ url_for("common.get_adm_areas") }}',
            data: {sid_cd: sid_cd},
            dataType: 'json'
        }).done(function (data) {
            let results = [];
            results.push('<div class="list-group">');
            $.each(data.items, function (i, item) {
                //
                results.push('<a href="#" class="list-group-item" onclick="set_adm_emd_areas(\'' + input_type + '\', \'' + item.sgg_cd + '\');"> ' + item.sgg_ko_nm + '<input id="sgg-cd.' + item.sgg_cd + '" name="' + input_type + '-area" type="' + input_type + '" class="pull-right" value="' + item.sgg_cd + '" onclick = "setSelectedValueForLocationDecision(\'sgg\', ' + item.sgg_cd + ');" update_params(\'' + item.layers + '\', \'' + item.featureid + '\');"></a>');
            });
            results.push('</div>');
            $('#div-sgg-area').html(results.join(''));
        }).fail(function (data) {
            console.log(data.msg);
        });
    }

    //    {# 시군구 코드로 행정동 읍면동 지역 조회 후 세팅 #}
    function set_adm_emd_areas(input_type, sgg_cd) {
        let $emd_div = $('#div-emd-area');

        if(codeStyle !== FUNC.HSHOLD_STATS.CODE_STYLE) {
            $.ajax({
                method: 'GET',
                url: '{{ url_for("common.get_adm_areas") }}',
                data: {sgg_cd: sgg_cd},
                dataType: 'json'
            }).done(function (data) {
                let results = [];
                results.push('<div class="list-group">');
                $.each(data.items, function (i, item) {
                    results.push('<a href="#" class="list-group-item"> ' + item.emd_ko_nm + '<input id="emd-cd.' + item.emd_cd + '" name="' + input_type + '-area" type="' + input_type + '" class="pull-right" value="' + item.emd_cd + '" onclick = "setSelectedValueForLocationDecision(\'emd\', ' + item.emd_cd + ');"update_params(\'' + item.layers + '\', \'' + item.featureid + '\');"></a>');
                });
                results.push('</div>');
                $emd_div.html(results.join(''));
            }).fail(function (data) {
                console.log(data.msg);
            });
        } else {
            emd_refresh = true;

            let result = [];

            result.push('<div class="list-group text-center" style="width: 100%; margin-top: 130px; color: #7a7070; ">');
            result.push('<span class="text-center">본 검색 기능은</span><br>');
            result.push('<span class="text-center">읍면동 단위 검색을</span><br>');
            result.push('<span class="text-center">지원하지 않습니다.</span>');
            result.push('</div>');

            $emd_div.addClass('div-disable');
            $emd_div.html(result.join(''));
        }
    }

    //    {# 법정 시도 지역 조회 후 세팅 #}
    function set_law_sid_areas(input_type) {
        $.ajax({
            method: 'GET',
            url: '{{ url_for("common.get_law_areas") }}',
            data: {},
            dataType: 'json'
        }).done(function (data) {
            let results = [];
            results.push('<div id="div-sid-area" class="list-group">');
            $.each(data.items, function (i, item) {
                results.push('<a href="#" class="list-group-item" onclick="set_law_sgg_areas(\'' + input_type + '\', \'' + item.sid_cd + '\');"> ' + item.sid_ko_nm + '<input id="sid-cd.' + item.sid_cd + '" name="' + input_type + '-area" type="' + input_type + '" class="pull-right" value="' + item.sid_cd + '" onclick = "setSelectedValueForLocationDecision(\'sid\', ' + item.sid_cd + ');" update_params(\'' + item.layers + '\', \'' + item.featureid + '\');"></a>');
            });
            results.push('</div>');
            $('#div-sid-area').html(results.join(''));
        }).fail(function (data) {
        });
//        {# 호출될 때마다 시군구, 읍면동 초기화 #}
        $('#div-sgg-area').html('');
        $('#div-emd-area').html('');
    }

    //    {# 시도 코드로 법정 시군구 지역 조회 후 세팅 #}
    function set_law_sgg_areas(input_type, sid_cd) {
        $.ajax({
            method: 'GET',
            url: '{{ url_for("common.get_law_areas") }}',
            data: {sid_cd: sid_cd},
            dataType: 'json'
        }).done(function (data) {
            let results = [];
            results.push('<div class="list-group">');
            $.each(data.items, function (i, item) {
                results.push('<a href="#" class="list-group-item" onclick="set_law_emd_areas(\'' + input_type + '\', \'' + item.sgg_cd + '\');"> ' + item.sgg_ko_nm + '<input id="sgg-cd.' + item.sgg_cd + '" name="' + input_type + '-area" type="' + input_type + '" class="pull-right" value="' + item.sgg_cd + '" onclick = "setSelectedValueForLocationDecision(\'sgg\', ' + item.sgg_cd + ');" update_params(\'' + item.layers + '\', \'' + item.featureid + '\');"></a>');
            });
            results.push('</div>');
            $('#div-sgg-area').html(results.join(''));
        }).fail(function (data) {
            console.log(data.msg);
        });
    }

    //    {# 시군구 코드로 법정 읍면동 지역 조회 후 세팅 #}
    function set_law_emd_areas(input_type, sgg_cd) {
        let $emd_div = $('#div-emd-area');
        if(codeStyle !== FUNC.HSHOLD_STATS.CODE_STYLE) {
            $.ajax({
                method: 'GET',
                url: '{{ url_for("common.get_law_areas") }}',
                data: {sgg_cd: sgg_cd},
                dataType: 'json'
            }).done(function (data) {
                let results = [];
                results.push('<div class="list-group">');
                $.each(data.items, function (i, item) {
                    results.push('<a href="#" class="list-group-item"> ' + item.emd_ko_nm + '<input id="emd-cd.' + item.emd_cd + '" name="' + input_type + '-area" type="' + input_type + '" class="pull-right" value="' + item.emd_cd + '" onclick = "setSelectedValueForLocationDecision(\'emd\', ' + item.emd_cd + ');"update_params(\'' + item.layers + '\', \'' + item.featureid + '\');"></a>');
                });
                results.push('</div>');
                $emd_div.html(results.join(''));
            }).fail(function (data) {
                console.log(data.msg);
            });
        } else {
            emd_refresh = true;
            let result = [];

            result.push('<div class="list-group text-center" style="width: 100%; margin-top: 130px;">');
            result.push('<span class="text-center">본 검색 기능은</span><br>');
            result.push('<span class="text-center">읍면동 단위 검색을</span><br>');
            result.push('<span class="text-center">지원하지 않습니다.</span>');
            result.push('</div>');

            $emd_div.addClass('div-disable');
            $emd_div.html(result.join(''));
        }
    }

    function getAreaKor(type, cd) {
        if (type === 'adm') {
            return getAdmAreaKor(cd)
        }

        if (type === 'law') {
            return getLawAreaKor(cd)
        }
    }

    function detectAreaCd(areaCd) {
        areaCd = areaCd + "";
        if (areaCd.length === 2) {
            return {sid_cd: areaCd}
        } else if (areaCd.length === 5) {
            return {sgg_cd: areaCd}
        } else if (areaCd.length === 10 || areaCd.length === 7) {
            return {emd_cd: areaCd}
        } else {
            console.log('코드 체계가 변경되었습니다.');
            return false;
        }
    }

    function getAdmAreaKor(areaCd) {
        let ret = [];

        $.ajax({
            method: 'GET',
            url: '{{ url_for("common.get_adm_area_ko_names") }}',
            data: detectAreaCd(areaCd),
            async: false,
            dataType: 'json'
        }).done(function (data) {
            ret = data.items;
        }).fail(function (data) {
            console.log(data.msg);
        });

        return ret;
    }

    function getLawAreaKor(areaCd) {
        let ret = [];
        $.ajax({
            method: 'GET',
            url: '{{ url_for("common.get_law_area_ko_names") }}',
            data: detectAreaCd(areaCd),
            async: false,
            dataType: 'json'
        }).done(function (data) {
            ret = data.items;
        }).fail(function (data) {
            console.log(data.msg);
        });

        return ret;
    }

    function setDataSource(){
        let $targetELs = $("span[id$='-source']");
        let forLength = $targetELs.length;
        for (let i = 0; i < forLength; i++) {
            let targetID = $targetELs[i].id
            let targetShortFunc = targetID.substr(0, targetID.indexOf("-"));

            let dataSource = FUNC_SHORT[targetShortFunc].DATA_SOURCE;

            $($targetELs[i]).html(`<span><small>출처: ${dataSource}</small></span>`);
        }
    }

</script>

{% endblock %}